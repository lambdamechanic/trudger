{"id":"tr-0lw","title":"Add trudger automation script","description":"Goal: deliver a root-level ./trudger script that loops over ready trudgeable bd tasks and drives Codex solve+review sessions with deterministic task closure or requires-human escalation. Scope: prompt file presence checks, bd task selection, codex exec orchestration, bd state updates, and error handling. Out of scope: parallel task processing or general task runner framework.","acceptance_criteria":"- ./trudger is executable and starts without explicit shell invocation.\n- Missing ~/.codex/prompts/trudge or ~/.codex/prompts/trudge_review causes a clear startup error.\n- Lowest-priority ready trudgeable task is selected per loop; exits 0 when none remain.\n- Codex exec and resume are invoked with /prompt:trudge <id> and /prompt:trudge_review <id>.\n- On review success, bd task is closed and trudgeable removed; on requires-human, comment/notes updated, trudgeable removed, requires-human added.\n- If neither close nor requires-human occurs after review, script exits non-zero.","status":"closed","priority":2,"issue_type":"epic","owner":"mark@ram.local","created_at":"2026-01-26T03:25:20.188896676Z","created_by":"Mark","updated_at":"2026-01-26T04:10:30.211124533Z","closed_at":"2026-01-26T04:10:30.211124533Z","close_reason":"Closed","source_repo":".","compaction_level":0}
{"id":"tr-0lw.1","title":"Scaffold ./trudger and prompt file checks","description":"OpenSpec add-trudger requirements: (1) 'The system SHALL provide a root-level executable script named ...' Scenario: WHEN a user runs ./trudger THEN the script starts without requiring an explicit shell invocation. (2) 'The script SHALL verify that ~/.codex/prompts/trudge and ~/.codex/prompts/trudge_review exist...' Scenario: GIVEN missing prompt files WHEN ./trudger starts THEN it exits with a clear error indicating the missing path.","acceptance_criteria":"Outputs: root-level ./trudger script with executable permissions and usage header; startup check for ~/.codex/prompts/trudge and ~/.codex/prompts/trudge_review. Validation/tests: run ./trudger to confirm direct execution works; simulate missing prompt file(s) and confirm clear error message and non-zero exit. Success: script is executable and fails fast with explicit missing-path error.","status":"closed","priority":2,"issue_type":"task","owner":"mark@ram.local","created_at":"2026-01-26T03:25:27.533863764Z","created_by":"Mark","updated_at":"2026-01-26T04:10:27.356595171Z","closed_at":"2026-01-26T04:10:27.356595171Z","close_reason":"Closed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-0lw.1","depends_on_id":"tr-0lw","type":"parent-child","created_at":"2026-01-26T03:25:27.534745566Z","created_by":"Mark","metadata":"","thread_id":""}]}
{"id":"tr-0lw.2","title":"Implement bd task selection loop","description":"OpenSpec requirement: The script SHALL select the lowest-priority ready bd task with the trudgeable label and process one task per outer loop iteration. Scenario: WHEN no ready tasks with label trudgeable are found THEN the script exits with status 0.","acceptance_criteria":"Outputs: bd query uses bd ready ordering for trudgeable tasks; lowest priority per bd ordering; loop handles one task at a time; exit 0 when none remain. Validation/tests: run against bd with zero trudgeable tasks to confirm exit 0; run with multiple trudgeable tasks to confirm bd ordering. Success: selection ordering matches bd ready output (open qualifies).","status":"closed","priority":2,"issue_type":"task","owner":"mark@ram.local","created_at":"2026-01-26T03:25:36.396621595Z","created_by":"Mark","updated_at":"2026-01-26T04:10:27.370709867Z","closed_at":"2026-01-26T04:10:27.370709867Z","close_reason":"Closed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-0lw.2","depends_on_id":"tr-0lw","type":"parent-child","created_at":"2026-01-26T03:25:36.397481786Z","created_by":"Mark","metadata":"","thread_id":""},{"issue_id":"tr-0lw.2","depends_on_id":"tr-0lw.1","type":"blocks","created_at":"2026-01-26T03:25:36.398715608Z","created_by":"Mark","metadata":"","thread_id":""}]}
{"id":"tr-0lw.3","title":"Wire Codex exec + review prompts","description":"OpenSpec requirement: For each selected task, the script SHALL start a Codex exec session with /prompt:trudge <bd-id> and then resume the same session with /prompt:trudge_review <bd-id>. Scenario: WHEN a task is selected THEN the script invokes codex exec with /prompt:trudge <bd-id> AND codex exec resume --last with /prompt:trudge_review <bd-id>.","acceptance_criteria":"Outputs: codex exec invocation and resume of same session for review (resume --last or equivalent). Validation/tests: verify codex exec called with /prompt:trudge <id> and resume with /prompt:trudge_review <id>; failures abort immediately. Success: two-step Codex flow runs per task with correct prompts; non-zero on exec failure.","status":"closed","priority":2,"issue_type":"task","owner":"mark@ram.local","created_at":"2026-01-26T03:25:42.271318250Z","created_by":"Mark","updated_at":"2026-01-26T04:10:27.377459994Z","closed_at":"2026-01-26T04:10:27.377459994Z","close_reason":"Closed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-0lw.3","depends_on_id":"tr-0lw","type":"parent-child","created_at":"2026-01-26T03:25:42.272414531Z","created_by":"Mark","metadata":"","thread_id":""},{"issue_id":"tr-0lw.3","depends_on_id":"tr-0lw.1","type":"blocks","created_at":"2026-01-26T03:25:42.273789681Z","created_by":"Mark","metadata":"","thread_id":""}]}
{"id":"tr-0lw.4","title":"Apply bd updates after Codex review","description":"OpenSpec requirements: (1) When review indicates acceptance, close bd task and remove trudgeable. Scenario: WHEN Codex review reports acceptance criteria satisfied THEN the bd task is closed and trudgeable removed. (2) When review indicates human input required, add bd comment, update notes, remove trudgeable, add requires-human. Scenario: WHEN Codex review reports that human input is required THEN task receives comment/notes update AND trudgeable removed AND requires-human added. (3) After review, verify task was closed or labeled requires-human (with trudgeable removed) and exit non-zero if neither. Scenario: WHEN review completes without closing or requires-human THEN script exits non-zero.","acceptance_criteria":"Outputs: on review completion, inspect bd task; if closed, remove trudgeable; if requires-human label present, add comment/notes, remove trudgeable, add requires-human. Validation/tests: simulate review success and verify bd task is closed; simulate requires-human response and verify labels/comment/notes; simulate missing close or requires-human and verify non-zero exit. Success: bd state reflects review outcome; script errors if neither close nor requires-human.","status":"closed","priority":2,"issue_type":"task","owner":"mark@ram.local","created_at":"2026-01-26T03:25:52.312225142Z","created_by":"Mark","updated_at":"2026-01-26T04:10:27.384901343Z","closed_at":"2026-01-26T04:10:27.384901343Z","close_reason":"Closed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-0lw.4","depends_on_id":"tr-0lw","type":"parent-child","created_at":"2026-01-26T03:25:52.313358701Z","created_by":"Mark","metadata":"","thread_id":""},{"issue_id":"tr-0lw.4","depends_on_id":"tr-0lw.1","type":"blocks","created_at":"2026-01-26T03:55:10.150781719Z","created_by":"Mark","metadata":"","thread_id":""},{"issue_id":"tr-0lw.4","depends_on_id":"tr-0lw.2","type":"blocks","created_at":"2026-01-26T03:25:52.314904619Z","created_by":"Mark","metadata":"","thread_id":""},{"issue_id":"tr-0lw.4","depends_on_id":"tr-0lw.3","type":"blocks","created_at":"2026-01-26T03:25:52.316193734Z","created_by":"Mark","metadata":"","thread_id":""}]}
{"id":"tr-0lw.5","title":"Validate trudger behavior with mock tasks","description":"OpenSpec scenarios covered: WHEN no ready trudgeable tasks are found THEN script exits 0; GIVEN missing prompt files WHEN ./trudger starts THEN clear error; WHEN task selected THEN codex exec and resume prompts invoked; WHEN review outcome applied THEN bd state updates or non-zero exit if missing.","acceptance_criteria":"Outputs: documented run evidence (logs/notes) for task selection, prompt checks, codex flow, and bd updates. Validation/tests: run a real codex session with a mock trudgeable task; confirm exit 0 when none remain; confirm missing prompts error; confirm bd updates on success/requires-human. Success: all scenarios in add-trudger change demonstrate expected behavior.","status":"closed","priority":2,"issue_type":"task","owner":"mark@ram.local","created_at":"2026-01-26T03:25:58.000611480Z","created_by":"Mark","updated_at":"2026-01-26T04:10:27.392355885Z","closed_at":"2026-01-26T04:10:27.392355885Z","close_reason":"Closed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-0lw.5","depends_on_id":"tr-0lw","type":"parent-child","created_at":"2026-01-26T03:25:58.001959141Z","created_by":"Mark","metadata":"","thread_id":""},{"issue_id":"tr-0lw.5","depends_on_id":"tr-0lw.1","type":"blocks","created_at":"2026-01-26T03:25:58.004012021Z","created_by":"Mark","metadata":"","thread_id":""},{"issue_id":"tr-0lw.5","depends_on_id":"tr-0lw.2","type":"blocks","created_at":"2026-01-26T03:25:58.006003714Z","created_by":"Mark","metadata":"","thread_id":""},{"issue_id":"tr-0lw.5","depends_on_id":"tr-0lw.3","type":"blocks","created_at":"2026-01-26T03:25:58.008106675Z","created_by":"Mark","metadata":"","thread_id":""},{"issue_id":"tr-0lw.5","depends_on_id":"tr-0lw.4","type":"blocks","created_at":"2026-01-26T03:25:58.010160509Z","created_by":"Mark","metadata":"","thread_id":""}]}
{"id":"tr-131","title":"Add trudger.yml configuration + hooks","description":"OpenSpec: openspec/changes/add-trudger-config\n\nGoals:\n- Read ~/.config/trudger.yml (warn if missing) to configure:\n  - Codex invocation command line\n  - Next-task selection command\n  - Optional hooks when a task completes or needs human approval\n  - Optional label names (trudgeable / requires-human) used only when hooks are not configured\n- Remove TRUDGER_* environment-variable configuration.\n\nScope:\n- Update ./trudger behavior to be config-driven.\n- Update tests to cover config + hooks.\n- Update docs as needed to explain configuration.\n\nOut of scope:\n- Changing bd or Codex behavior.\n- Changing prompt contents beyond existing $ARGUMENTS substitution.","acceptance_criteria":"- Config file: trudger reads ~/.config/trudger.yml on startup; if missing, prints a warning and continues with defaults.\n- No env config: TRUDGER_* environment variables are not used for configuration.\n- Task selection: uses configured next-task command (first whitespace-delimited token of stdout) or defaults to bd ready selection with optional trudgeable filtering.\n- Codex invocation: uses configured Codex command line for solve, and the same with `resume --last` for review.\n- Hooks: if configured, executes hooks as `<command> <task_id> <extra args...>` for completed and requires-human outcomes.\n- Labels optional: trudgeable/requires-human labels are configurable and optional; default label behavior applies only when hooks are not configured.\n- Verification: after review, trudger exits non-zero if neither closed nor requires-human condition is detected.\n- Validation: `bats tests/trudger_test.bats` passes; `openspec validate add-trudger-config --strict --no-interactive` passes.","status":"closed","priority":2,"issue_type":"epic","owner":"mwotton@gmail.com","created_at":"2026-01-27T09:26:35.595618681Z","created_by":"Mark Wotton","updated_at":"2026-01-27T10:00:18.545671438Z","closed_at":"2026-01-27T10:00:18.545671438Z","close_reason":"Closed","source_repo":".","compaction_level":0,"labels":["trudgeable"]}
{"id":"tr-131.1","title":"Load ~/.config/trudger.yml + defaults","description":"OpenSpec refs:\n- openspec/changes/add-trudger-config/specs/trudger/spec.md\n  - Requirement: Trudger configuration file\n    - Scenario: Config missing\n    - Scenario: Env vars ignored\n\nWork:\n- Define config keys + defaults needed to drive trudger behavior (Codex command, next-task command, hooks, labels, review loop limit, log path).\n- Implement reading ~/.config/trudger.yml at startup; if missing, emit a warning (stderr) and continue with defaults.\n- Implement YAML parsing sufficient for the chosen schema.\n\nExpected outputs:\n- ./trudger loads config and exposes values to the rest of the script.\n- Missing config produces a clear warning without failing.\n\nValidation/tests:\n- Add bats coverage for missing config warning + default behavior.\n\nSuccess:\n- `trudger` runs with no config (warns once) and preserves default behavior.","acceptance_criteria":"- Config loader exists and is used by ./trudger.\n- Missing ~/.config/trudger.yml prints a warning but exits 0 when no tasks.\n- Tests demonstrate warning + defaults.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-27T09:26:35.637292067Z","created_by":"Mark Wotton","updated_at":"2026-01-28T02:26:17.660059069Z","closed_at":"2026-01-28T02:26:17.660059069Z","close_reason":"Completed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-131.1","depends_on_id":"tr-131","type":"parent-child","created_at":"2026-01-27T09:26:35.638996521Z","created_by":"Mark Wotton","metadata":"","thread_id":""}]}
{"id":"tr-131.2","title":"Remove TRUDGER_* configuration env vars","description":"OpenSpec refs:\n- openspec/changes/add-trudger-config/specs/trudger/spec.md\n  - Requirement: Trudger configuration file\n    - Scenario: Env vars ignored\n\nWork:\n- Remove TRUDGER_LOG / TRUDGER_NEXT_CMD / TRUDGER_REVIEW_LOOPS (and any other TRUDGER_* config) as configuration inputs.\n- Ensure any remaining TRUDGER_* values are internal-only state, not user config.\n\nExpected outputs:\n- ./trudger behavior is driven by config file defaults/values, not TRUDGER_* env vars.\n\nValidation/tests:\n- Add a bats test that sets TRUDGER_NEXT_CMD/TRUDGER_REVIEW_LOOPS and verifies behavior does not change unless config changes.\n\nSuccess:\n- Env vars no longer affect configuration.","acceptance_criteria":"- No TRUDGER_* env vars are read for configuration.\n- Tests cover at least one env var being ignored.","notes":"2026-01-28: Updated bats env-var test to set TRUDGER_REVIEW_LOOPS=0 alongside TRUDGER_NEXT_CMD; verified config ignores env vars. Ran: bats tests/trudger_test.bats, shellcheck trudger tests/fixtures/bin/*.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-27T09:26:35.692454937Z","created_by":"Mark Wotton","updated_at":"2026-01-28T02:44:21.885636925Z","closed_at":"2026-01-28T02:44:21.885636925Z","close_reason":"Completed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-131.2","depends_on_id":"tr-131","type":"parent-child","created_at":"2026-01-27T09:26:35.694228582Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-131.2","depends_on_id":"tr-131.1","type":"blocks","created_at":"2026-01-27T09:26:35.696546147Z","created_by":"Mark Wotton","metadata":"","thread_id":""}]}
{"id":"tr-131.3","title":"Configure Codex invocation via config","description":"OpenSpec refs:\n- openspec/changes/add-trudger-config/specs/trudger/spec.md\n  - Requirement: Codex prompt execution\n    - Scenario: Configured Codex command\n\nWork:\n- Read `codex_command` from config.\n- Use it for the solve step, and use the same command line with `resume --last` appended for the review step.\n\nExpected outputs:\n- ./trudger invokes Codex via the configured command string for both solve and review.\n\nValidation/tests:\n- Add bats coverage asserting the configured codex command is used (fixture codex log).\n\nSuccess:\n- Codex invocations match the configured command line for both phases.","acceptance_criteria":"- Configurable `codex_command` drives solve + review invocations.\n- Tests assert the command used.","notes":"2026-01-28: Verified codex_command from config drives solve and review (appends resume --last). Ran: bats tests/trudger_test.bats; TRUDGER_TEST_RUN_CODEX=1 bats -f 'uses configured codex command for solve and review' tests/trudger_test.bats; shellcheck trudger tests/fixtures/bin/*.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-27T09:26:35.750301428Z","created_by":"Mark Wotton","updated_at":"2026-01-28T02:58:16.300919686Z","closed_at":"2026-01-28T02:58:16.300919686Z","close_reason":"Completed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-131.3","depends_on_id":"tr-131","type":"parent-child","created_at":"2026-01-27T09:26:35.751906268Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-131.3","depends_on_id":"tr-131.1","type":"blocks","created_at":"2026-01-27T09:26:35.754284489Z","created_by":"Mark Wotton","metadata":"","thread_id":""}]}
{"id":"tr-131.4","title":"Configure next-task selection via config","description":"OpenSpec refs:\n- openspec/changes/add-trudger-config/specs/trudger/spec.md\n  - Requirement: Task selection\n    - Scenario: Custom next-task command\n\nWork:\n- Read `next_task_command` from config.\n- Execute it to select the next task id, using the first whitespace-delimited token of stdout.\n- If `next_task_command` is not configured, use the default bd-ready query, filtering by the configured trudgeable label when set.\n\nExpected outputs:\n- ./trudger selects tasks using the configured command and parsing rules.\n\nValidation/tests:\n- Add bats coverage for:\n  - Custom command returning an id\n  - Custom command returning empty -> exits 0 (no task)\n  - Default bd selection still works with label filtering\n\nSuccess:\n- Task selection follows config rules and is covered by tests.","acceptance_criteria":"- next-task selection uses `next_task_command` when set, otherwise defaults.\n- Tests cover parsing + fallback behavior.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-27T09:26:35.807784351Z","created_by":"Mark Wotton","updated_at":"2026-01-28T03:15:10.353568707Z","closed_at":"2026-01-28T03:15:10.353568707Z","close_reason":"Completed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-131.4","depends_on_id":"tr-131","type":"parent-child","created_at":"2026-01-27T09:26:35.809509331Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-131.4","depends_on_id":"tr-131.1","type":"blocks","created_at":"2026-01-27T09:26:35.811929987Z","created_by":"Mark Wotton","metadata":"","thread_id":""}]}
{"id":"tr-131.5","title":"Add completion hook (on_completed) + fallback label behavior","description":"OpenSpec refs:\n- openspec/changes/add-trudger-config/specs/trudger/spec.md\n  - Requirement: Task closure on success\n    - Scenario: Completion hook configured\n    - Scenario: No completion hook\n\nWork:\n- Add config for optional completion hook.\n- Execute the hook as `<command> <task_id> <extra args...>` when a task is closed.\n- If no completion hook is configured, remove the configured trudgeable label when it is set.\n\nExpected outputs:\n- ./trudger runs completion hook with task id as first argument.\n- Default label removal occurs only when hook is not configured.\n\nValidation/tests:\n- Add bats coverage using a fixture hook script to assert argv ordering.\n\nSuccess:\n- Closed tasks trigger the hook (or fallback label removal) per config.","acceptance_criteria":"- on_completed hook is invoked as `<cmd> <task_id> <extras>` when configured.\n- Fallback label removal works when hook is absent.\n- Tests cover both paths.","notes":"2026-01-28: Verified on_completed hook runs as <cmd> <task_id> <extras> and skips label removal; fallback label removal works when no hook. Ran: bats tests/trudger_test.bats; TRUDGER_TEST_RUN_CODEX=1 bats tests/trudger_test.bats; shellcheck trudger tests/fixtures/bin/*.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-27T09:26:35.867079473Z","created_by":"Mark Wotton","updated_at":"2026-01-28T03:25:19.055159742Z","closed_at":"2026-01-28T03:25:19.055159742Z","close_reason":"Completed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-131.5","depends_on_id":"tr-131","type":"parent-child","created_at":"2026-01-27T09:26:35.868861189Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-131.5","depends_on_id":"tr-131.1","type":"blocks","created_at":"2026-01-27T09:26:35.871236880Z","created_by":"Mark Wotton","metadata":"","thread_id":""}]}
{"id":"tr-131.6","title":"Add requires-human hook (on_requires_human) + optional labels","description":"OpenSpec refs:\n- openspec/changes/add-trudger-config/specs/trudger/spec.md\n  - Requirement: Requires-human escalation\n    - Scenario: Requires-human hook configured\n    - Scenario: No requires-human hook\n\nWork:\n- Add config for optional requires-human hook.\n- Execute the hook as `<command> <task_id> <extra args...>` when requires-human is detected.\n- If no hook is configured, apply label updates using configured label names (both optional).\n\nExpected outputs:\n- ./trudger can operate with labels disabled (no trudgeable/requires-human labels configured) when hooks are configured.\n\nValidation/tests:\n- Add bats coverage for:\n  - Hook invocation and argv ordering\n  - Label fallback behavior when hook is absent\n  - Behavior when label names are unset/empty\n\nSuccess:\n- Requires-human handling matches the configured hook/label strategy and is tested.","acceptance_criteria":"- on_requires_human hook is invoked as `<cmd> <task_id> <extras>` when configured.\n- Label fallback behavior works when hook is absent.\n- Labels can be disabled via config when hooks are present.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-27T09:26:35.925853480Z","created_by":"Mark Wotton","updated_at":"2026-01-28T03:31:59.775714186Z","closed_at":"2026-01-28T03:31:59.775714186Z","close_reason":"Completed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-131.6","depends_on_id":"tr-131","type":"parent-child","created_at":"2026-01-27T09:26:35.927792355Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-131.6","depends_on_id":"tr-131.1","type":"blocks","created_at":"2026-01-27T09:26:35.930450739Z","created_by":"Mark Wotton","metadata":"","thread_id":""}]}
{"id":"tr-131.7","title":"Update bats tests for config-driven behavior","description":"OpenSpec refs:\n- openspec/changes/add-trudger-config/specs/trudger/spec.md\n  - Requirement: Trudger configuration file (scenarios: Config missing, Env vars ignored)\n  - Requirement: Task selection (scenario: Custom next-task command)\n  - Requirement: Codex prompt execution (scenario: Configured Codex command)\n  - Requirement: Task closure on success (scenarios: Completion hook configured / No completion hook)\n  - Requirement: Requires-human escalation (scenarios: Requires-human hook configured / No requires-human hook)\n  - Requirement: Codex update verification (scenario: Missing update is an error)\n\nWork:\n- Update `tests/trudger_test.bats` and fixtures to use config file instead of TRUDGER_* env vars.\n- Add new fixtures/scripts as needed to assert hook argv ordering and next-task command behavior.\n\nExpected outputs:\n- New/updated bats tests covering config loading, codex command, task selection, hooks, and verification.\n\nValidation/tests:\n- `bats tests/trudger_test.bats`\n\nSuccess:\n- Test suite passes and covers the new config-driven acceptance criteria.","acceptance_criteria":"- Bats tests updated/added to cover config + hooks.\n- All tests pass locally.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-27T09:26:35.984747492Z","created_by":"Mark Wotton","updated_at":"2026-01-28T03:36:57.719086798Z","closed_at":"2026-01-28T03:36:57.719086798Z","close_reason":"Completed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-131.7","depends_on_id":"tr-131","type":"parent-child","created_at":"2026-01-27T09:26:35.986638153Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-131.7","depends_on_id":"tr-131.2","type":"blocks","created_at":"2026-01-27T09:26:35.989317341Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-131.7","depends_on_id":"tr-131.3","type":"blocks","created_at":"2026-01-27T09:26:35.991873342Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-131.7","depends_on_id":"tr-131.4","type":"blocks","created_at":"2026-01-27T09:26:35.994566446Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-131.7","depends_on_id":"tr-131.5","type":"blocks","created_at":"2026-01-27T09:26:35.997203746Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-131.7","depends_on_id":"tr-131.6","type":"blocks","created_at":"2026-01-27T09:26:35.999708932Z","created_by":"Mark Wotton","metadata":"","thread_id":""}]}
{"id":"tr-131.8","title":"Run quality gates + update docs","description":"OpenSpec refs:\n- openspec/changes/add-trudger-config/specs/trudger/spec.md\n  - Requirement: Trudger configuration file\n\nWork:\n- Update README/install guidance to document ~/.config/trudger.yml and available config keys.\n- Run validation commands and record results in the PR/notes.\n\nExpected outputs:\n- Docs clearly describe configuration and defaults.\n\nValidation/tests:\n- `openspec validate add-trudger-config --strict --no-interactive`\n- `bats tests/trudger_test.bats`\n\nSuccess:\n- Validation passes; docs match implemented behavior.","acceptance_criteria":"- Docs updated to describe config and defaults.\n- openspec + bats validation passes.","notes":"Validation:\\n- openspec validate add-trudger-config --strict --no-interactive (pass)\\n- bats tests/trudger_test.bats (pass)","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-27T09:26:36.054519306Z","created_by":"Mark Wotton","updated_at":"2026-01-28T03:41:19.360356219Z","closed_at":"2026-01-28T03:41:19.360356219Z","close_reason":"Completed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-131.8","depends_on_id":"tr-131","type":"parent-child","created_at":"2026-01-27T09:26:36.056245843Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-131.8","depends_on_id":"tr-131.7","type":"blocks","created_at":"2026-01-27T09:26:36.058726235Z","created_by":"Mark Wotton","metadata":"","thread_id":""}]}
{"id":"tr-140","title":"Consolidate specs and update trudger purpose section","description":"OpenSpec refs:\n- Requirement: Configuration loading/validation/parsing/unknown keys\n- Requirement: Hook execution semantics\n- Requirement: Task selection, review hooks, and status verification\n\nExpected outputs:\n- Remove duplicate spec copies under completed changes; keep a single canonical spec source.\n- Update `openspec/specs/trudger/spec.md` Purpose section to describe the generic task system (with br/bd as examples), removing label-specific language.\n- Ensure canonical spec reflects the added/modified requirements from this change.\n\nValidation/tests:\n- `openspec validate refactor-trudger-config-and-docs --strict --no-interactive` should pass once all spec/docs updates are done.\n\nSuccess criteria:\n- Spec sources are consolidated and purpose text matches the current system behavior.\n\nNotes:\n- This task is blocked on archiving `add-trudger-config-flag` (per change proposal dependency).","acceptance_criteria":"Acceptance criteria: (1) Duplicate spec copies under completed changes are removed. (2) Purpose section is updated to describe the generic task system. (3) Canonical spec still contains the added/modified requirements for this change.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T05:26:50.124425450Z","created_by":"mark","updated_at":"2026-01-29T09:19:35.934116782Z","closed_at":"2026-01-29T09:19:35.934046891Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-140","depends_on_id":"tr-2mc","type":"parent-child","created_at":"2026-01-29T05:26:50.149750531Z","created_by":"mark"}]}
{"id":"tr-1bh","title":"Rust core task loop (no re-exec)","description":"OpenSpec refs:\n- openspec/changes/refactor-trudger-rust-native/specs/trudger/spec.md Requirement: Rust in-process loop (Scenario: No re-exec between tasks)\n- openspec/specs/trudger/spec.md Requirement: Task selection (Scenarios: No selectable tasks; Task not ready is skipped)\n- openspec/specs/trudger/spec.md Requirement: Agent prompt execution (Scenario: solve + review)\n- openspec/specs/trudger/spec.md Requirement: Task show output handling (Scenario: Show output is prompt-only)\n- openspec/specs/trudger/spec.md Requirement: Agent update verification (Scenario: Missing status after review)\n\nWork:\n- Implement the outer task loop in Rust without re-exec.\n- Execute commands.next_task, commands.task_status, commands.task_update_in_progress, commands.task_show per config.\n- Run agent solve and review prompts using `agent_command` and `agent_review_command`; provide task context via `TRUDGER_*` env vars; treat task_show output as prompt-only.\n- Enforce task status checks after review and skip-not-ready logic with TRUDGER_SKIP_NOT_READY_LIMIT semantics.\n\nExpected outputs:\n- Rust implementation processes tasks one per iteration and idles/exits correctly.\n\nValidation/tests:\n- Integration tests for next_task exit=1 => exit 0, skip-not-ready behavior, prompt handling via env vars, and missing-status error.","acceptance_criteria":"1. Rust implementation uses an in-process loop without re-exec between tasks. (OpenSpec: Rust in-process loop scenario.)\n2. commands.next_task exit=1 results in exit 0 with no work; empty output treated as no task. (OpenSpec: Task selection scenario.)\n3. Task not ready is skipped with retry up to TRUDGER_SKIP_NOT_READY_LIMIT. (OpenSpec: Task selection scenario.)\n4. Agent solve + review use `agent_command` and `agent_review_command`, with task context via `TRUDGER_*` env vars; task_show output is not parsed for control flow. (OpenSpec: Agent prompt execution + Task show output handling scenarios.)\n5. Missing status after review yields non-zero error. (OpenSpec: Agent update verification scenario.)\n6. Integration tests cover next_task exit handling, skip-not-ready, env var prompt handling, and missing-status error.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T04:43:34.015518897Z","created_by":"mark","updated_at":"2026-02-05T02:55:01.568931579Z","closed_at":"2026-02-05T02:55:01.568914818Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1bh","depends_on_id":"tr-3j8","type":"parent-child","created_at":"2026-02-04T04:43:34.019612475Z","created_by":"mark"},{"issue_id":"tr-1bh","depends_on_id":"tr-7vm","type":"blocks","created_at":"2026-02-04T04:43:34.021194198Z","created_by":"mark"}]}
{"id":"tr-1bt","title":"Route ERR trap through quit path","description":"OpenSpec refs:\n- openspec/specs/trudger/spec.md Requirement: Error exit logging\n  - Scenario: Unhandled error triggers quit\n\nExpected outputs:\n- ERR trap exits via quit path (no quit log without exit).\n- Quit logging is consistent between explicit exits and unhandled errors.\n\nValidation/tests:\n- Add bats coverage that forces an ERR trap path by making commands.task_status or commands.task_show fail.\n- Assert non-zero exit + quit reason logged.\n- bats tests/trudger_test.bats\n\nAcceptance criteria:\n- A failing commands.task_status or commands.task_show triggers the ERR trap and non-zero exit.\n- A quit reason log entry is emitted only when the script exits.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-31T05:32:43.965561298Z","created_by":"mark","updated_at":"2026-02-05T00:55:54.261747490Z","closed_at":"2026-02-05T00:55:54.261731237Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1bt","depends_on_id":"tr-2v7","type":"parent-child","created_at":"2026-01-31T05:32:43.970075426Z","created_by":"mark"}]}
{"id":"tr-1cs","title":"Refactor Trudger command contract (env vars + review command)","description":"OpenSpec change: openspec/changes/refactor-trudger-command-contract.\\n\\nGoals:\\n- Move task context to TRUDGER_* env vars (no positional task args).\\n- Remove / prompt substitution; pass prompt content via TRUDGER_PROMPT/TRUDGER_REVIEW_PROMPT.\\n- Require agent_review_command separate from agent_command.\\n- Rename Codex-specific requirements to agent-neutral wording.\\n\\nScope:\\n- Shell + Rust implementations, config parsing/validation, docs, sample configs, and tests.","acceptance_criteria":"1. Commands and hooks receive task context via TRUDGER_* env vars with no positional task args. (OpenSpec: Command execution environment scenario.)\n2. Config validation requires agent_command and agent_review_command; codex_command is rejected. (OpenSpec: Configuration validation requirement.)\n3. Agent solve + review use agent_command/agent_review_command with the relevant prompt env var set (TRUDGER_PROMPT for solve, TRUDGER_REVIEW_PROMPT for review) and no prompt substitution. (OpenSpec: Agent prompt execution scenarios.)\n4. Task show output is provided via TRUDGER_TASK_SHOW without parsing. (OpenSpec: Task show output handling scenario.)\n5. Hooks execute with TRUDGER_TASK_ID and other context via env vars (no positional args). (OpenSpec: Hook execution semantics scenario.)\n6. Post-review status verification remains enforced. (OpenSpec: Agent update verification scenario.)\n7. Validation runs: bats tests + openspec validate refactor-trudger-command-contract --strict --no-interactive.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-02-04T06:06:46.799230534Z","created_by":"mark","updated_at":"2026-02-05T01:25:03.174871576Z","closed_at":"2026-02-05T01:25:03.174854175Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-1e1","title":"Test sample configs with br","description":"Add coverage for both sample configs, including robot-triage using bv stub, and ensure br workflow works in tests.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-28T13:21:40.335760004Z","created_by":"mark","updated_at":"2026-01-28T13:22:30.666716310Z","closed_at":"2026-01-28T13:22:30.666653281Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-1e5","title":"Investigate --robot-next selecting in_progress task","description":"Running ../trudger/trudger from /home/mark/lambdalabs/tooltest returns: 'Task tooltest-ev5 is not ready (status: in_progress)'. Expected robot-next to avoid in_progress tasks; investigate config or trudger selection logic.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T02:16:58.269747706Z","created_by":"mark","updated_at":"2026-01-29T03:52:28.331064395Z","closed_at":"2026-01-29T03:52:28.331019276Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-1g8","title":"Execute config commands without eval; evaluate shell at execution time","description":"Replace eval-based parsing with safer execution; ensure shell syntax is handled at execution time; document behavior.","acceptance_criteria":"Criteria: all configured commands execute via bash -lc at runtime (no eval/argv parsing); task id passed as $1 with extra args appended; shell constructs are supported; docs describe bash -lc execution.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-30T02:50:13.442722398Z","created_by":"mark","updated_at":"2026-01-30T07:47:02.167411464Z","closed_at":"2026-01-30T07:47:02.167366719Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1g8","depends_on_id":"tr-1xw","type":"blocks","created_at":"2026-01-30T02:50:13.855706673Z","created_by":"mark"},{"issue_id":"tr-1g8","depends_on_id":"tr-26e","type":"parent-child","created_at":"2026-01-30T02:50:13.448458399Z","created_by":"mark"}]}
{"id":"tr-1hl","title":"Ensure sample configuration files are present","description":"OpenSpec refs:\n- Requirement: Sample config files — Scenario: sample configs available in repo\n\nExpected outputs:\n- `sample_configuration/trudgeable-with-hooks.yml` exists (legacy/default behavior).\n- `sample_configuration/robot-triage.yml` exists (`bv --robot-triage` task selection).\n\nValidation/tests:\n- Repository contents verified (manual or via test fixture references).\n\nSuccess criteria:\n- Both sample config files are present and usable for copy/adaptation.","acceptance_criteria":"Acceptance criteria: (1) sample_configuration/trudgeable-with-hooks.yml exists in the repo. (2) sample_configuration/robot-triage.yml exists in the repo.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T06:05:15.132814137Z","created_by":"mark","updated_at":"2026-01-29T10:11:13.785284184Z","closed_at":"2026-01-29T10:11:13.785239433Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1hl","depends_on_id":"tr-jyr","type":"parent-child","created_at":"2026-01-29T06:05:15.162082088Z","created_by":"mark"}]}
{"id":"tr-1id","title":"Update docs + sample configs for env-var contract","description":"OpenSpec refs:\\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Command execution environment\\n  - Scenario: Command environment provided\\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Hook execution semantics\\n  - Scenario: Hook receives env vars\\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Agent prompt execution (Prompt context via env vars)\\n\\nWork:\\n- Update docs and sample configs for agent_command + agent_review_command.\\n- Document TRUDGER_* env vars and removal of prompt substitution/positional args.\\n\\nExpected outputs:\\n- README and sample_configuration/*.yml reflect new keys and env-var contract.\\n\\nValidation/tests:\\n- Manual doc review for spec alignment.\\n","acceptance_criteria":"1. README documents agent_command + agent_review_command and TRUDGER_* env vars, including TRUDGER_PROMPT/TRUDGER_REVIEW_PROMPT and TRUDGER_TASK_SHOW. (OpenSpec: Command execution environment + Agent prompt execution scenarios.)\n2. sample_configuration/*.yml use agent_command + agent_review_command and do not rely on positional args or prompt substitution.\n3. Manual doc review confirms alignment with the env-var contract.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T06:07:46.671273012Z","created_by":"mark","updated_at":"2026-02-04T10:36:03.531372888Z","closed_at":"2026-02-04T10:36:03.531355775Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1id","depends_on_id":"tr-1cs","type":"parent-child","created_at":"2026-02-04T06:07:46.675628192Z","created_by":"mark"},{"issue_id":"tr-1id","depends_on_id":"tr-vgj","type":"blocks","created_at":"2026-02-04T06:07:46.677557916Z","created_by":"mark"}]}
{"id":"tr-1nf","title":"Rust binary scaffold + startup checks","description":"OpenSpec refs:\n- openspec/changes/refactor-trudger-rust-native/specs/trudger/spec.md Requirement: Rust entrypoint (Scenario: Rust entrypoint is executable)\n- openspec/specs/trudger/spec.md Requirement: Prompt file presence (Scenario: Prompt file missing)\n- openspec/specs/trudger/spec.md Requirement: Configuration loading (Scenario: Missing config file)\n\nWork:\n- Create Cargo crate/binary named 'trudger' (release output target/release/trudger).\n- Implement CLI flags -c/--config and -h/--help consistent with shell behavior.\n- On startup, verify prompt files exist and config path exists (respecting -c); on missing config, emit bootstrap instructions.\n\nExpected outputs:\n- Runnable Rust binary with matching CLI flags and startup checks.\n\nValidation/tests:\n- Manual run shows binary executes and --help prints usage.\n- Missing prompt or config file errors are clear and non-zero.","acceptance_criteria":"1. Cargo binary named 'trudger' builds and runs (release output target/release/trudger).\n2. -c/--config and -h/--help flags behave consistently with shell usage.\n3. Missing prompt file yields a clear error naming the path and non-zero exit. (OpenSpec: Prompt file presence scenario.)\n4. Missing config file yields a clear error naming the path, includes bootstrap instructions for sample configs, and exits non-zero. (OpenSpec: Configuration loading scenario.)\n5. Running the release binary without shell invocation succeeds. (OpenSpec: Rust entrypoint scenario.)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T04:43:01.700377729Z","created_by":"mark","updated_at":"2026-02-04T06:26:55.602317816Z","closed_at":"2026-02-04T06:26:55.602226261Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1nf","depends_on_id":"tr-3j8","type":"parent-child","created_at":"2026-02-04T04:43:01.726396685Z","created_by":"mark"}]}
{"id":"tr-1o8","title":"Reset task status on interruption","description":"When a run stops without succeeding or is interrupted, invoke the reset_task command so the task returns to open and we avoid stale in_progress markers. Also update sample configurations to document/enable the reset_task behavior.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-30T03:41:08.539472996Z","created_by":"mark","updated_at":"2026-02-05T01:46:44.409373069Z","closed_at":"2026-02-05T01:46:44.409356829Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-1ta","title":"Align task selection and review hooks with spec","description":"OpenSpec refs:\n- Requirement: Task selection — Scenario: No selectable tasks\n- Requirement: Task selection — Scenario: Task not ready is skipped\n- Requirement: Task closure on success — Scenario: Task closed after successful review\n- Requirement: Requires-human escalation — Scenario: Task still open after review\n- Requirement: Codex update verification — Scenario: Missing status after review\n\nExpected outputs:\n- `commands.next_task` empty or exit 1 => script exits 0.\n- Not-ready task is skipped and retried up to `TRUDGER_SKIP_NOT_READY_LIMIT` before idling.\n- After review, task status must be non-empty; missing status => non-zero exit.\n- Status closed => run `hooks.on_completed`; otherwise run `hooks.on_requires_human`.\n- One task is processed per outer loop iteration.\n\nValidation/tests:\n- Covered by new/updated BATS cases in the \"Extend tests\" task.\n\nSuccess criteria:\n- Task selection and review hook behavior matches OpenSpec scenarios.","acceptance_criteria":"Acceptance criteria: (1) Empty/exit-1 commands.next_task results in exit status 0. (2) Not-ready tasks are skipped with retries up to TRUDGER_SKIP_NOT_READY_LIMIT. (3) Missing/empty status after review exits non-zero. (4) Closed status triggers hooks.on_completed; non-closed triggers hooks.on_requires_human. (5) Only one task is processed per outer loop iteration.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T05:26:01.798809820Z","created_by":"mark","updated_at":"2026-01-29T08:12:31.296294951Z","closed_at":"2026-01-29T08:12:31.296251276Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1ta","depends_on_id":"tr-2ef","type":"waits-for","created_at":"2026-01-29T05:26:01.829273666Z","created_by":"mark"},{"issue_id":"tr-1ta","depends_on_id":"tr-2mc","type":"parent-child","created_at":"2026-01-29T05:26:01.824145961Z","created_by":"mark"}]}
{"id":"tr-1uo","title":"Run validation and quality gates","description":"OpenSpec refs:\n- openspec/changes/update-trudger-logging-and-parsing/tasks.md steps 1.8-1.10\n\nExpected outputs:\n- shellcheck passes for trudger + test fixtures.\n- bats test suite passes.\n- openspec validate update-trudger-logging-and-parsing passes in strict mode.\n\nValidation/tests:\n- shellcheck trudger tests/trudger_test.bats tests/fixtures/bin/br tests/fixtures/bin/bv tests/fixtures/bin/agent\n- bats tests/trudger_test.bats\n- openspec validate update-trudger-logging-and-parsing --strict --no-interactive\n\nAcceptance criteria:\n- All validation commands succeed with exit code 0.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T05:33:00.013244236Z","created_by":"mark","updated_at":"2026-02-05T01:50:31.191020202Z","closed_at":"2026-02-05T01:50:31.191003396Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1uo","depends_on_id":"tr-1bt","type":"blocks","created_at":"2026-01-31T05:33:00.062089821Z","created_by":"mark"},{"issue_id":"tr-1uo","depends_on_id":"tr-29x","type":"blocks","created_at":"2026-01-31T05:33:00.057581876Z","created_by":"mark"},{"issue_id":"tr-1uo","depends_on_id":"tr-2v7","type":"parent-child","created_at":"2026-01-31T05:33:00.043840994Z","created_by":"mark"},{"issue_id":"tr-1uo","depends_on_id":"tr-34q","type":"blocks","created_at":"2026-01-31T05:33:00.066196113Z","created_by":"mark"},{"issue_id":"tr-1uo","depends_on_id":"tr-3ay","type":"blocks","created_at":"2026-01-31T05:33:00.053152486Z","created_by":"mark"},{"issue_id":"tr-1uo","depends_on_id":"tr-3ii","type":"blocks","created_at":"2026-01-31T05:33:00.048493633Z","created_by":"mark"}]}
{"id":"tr-1v2","title":"Reconcile OpenSpec change status vs implemented code","status":"open","priority":4,"issue_type":"task","created_at":"2026-02-06T15:37:29.190829737Z","created_by":"mark","updated_at":"2026-02-06T15:50:49.774174230Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-1xw","title":"Restore $ARGUMENTS to task id (not task_show JSON)","description":"Pass task id to prompts, update prompts/docs/tests to match, and keep task_show usage internal.","acceptance_criteria":"Criteria: $ARGUMENTS is task id only; prompt embeds task_show output; prompts no longer instruct the agent to run task_show; README/prompt docs updated to match.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-30T02:50:13.348677410Z","created_by":"mark","updated_at":"2026-01-30T06:20:20.233615712Z","closed_at":"2026-01-30T06:20:20.233552092Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["human_required"],"dependencies":[{"issue_id":"tr-1xw","depends_on_id":"tr-26e","type":"parent-child","created_at":"2026-01-30T02:50:13.354523751Z","created_by":"mark"}]}
{"id":"tr-26e","title":"Fix trudger task context, command execution, and logging","description":"Align task context and command execution with env-var contract and agent-agnostic configuration.\n\nNotes (2026-01-30 updated 2026-02-04):\n- Remove $ARGUMENTS and prompt substitution; provide prompt content via TRUDGER_PROMPT/TRUDGER_REVIEW_PROMPT.\n- Task context is provided via TRUDGER_TASK_ID/TRUDGER_TASK_SHOW/TRUDGER_TASK_STATUS/TRUDGER_CONFIG_PATH (no positional task args).\n- Execute all configured commands via bash -lc (no argv parsing).\n- Log full command strings; sanitize only to keep logs intact (no secret redaction).\n- commands.next_task is required when no manual task IDs; if manual IDs provided, missing next_task is a warning only; empty string counts as missing.\n- Use agent_command + agent_review_command (no codex_command).","notes":"Decisions (2026-01-30):\n- $ARGUMENTS is task id only.\n- Trudger embeds task_show output into the prompt body; agents must not fetch task details themselves.\n- Execute all configured commands via bash -lc (no argv parsing).\n- Log full command strings; sanitize only to keep logs intact (no secret redaction).\n- commands.next_task is required when no manual task IDs; if manual IDs provided, missing next_task is a warning only; empty string counts as missing.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-30T02:50:13.248637539Z","created_by":"mark","updated_at":"2026-02-05T04:04:47.434387090Z","closed_at":"2026-02-05T04:04:47.434368874Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-29x","title":"Standardize logging semantics and sanitization","description":"OpenSpec refs:\n- openspec/specs/trudger/spec.md Requirement: Execution logging\n  - Scenario: Command logging includes full command\n  - Scenario: Log values include control characters\n\nExpected outputs:\n- Command start/exit and quit reasons are logged as single-line entries.\n- Control characters (\\n, \\r, \\t) are escaped in logged values.\n- Full command strings + args are included in logs without redaction.\n- Exit-code log lines include the command label and task id (when available).\n\nValidation/tests:\n- Add/extend bats coverage for log output and control-char escaping.\n- Ensure exit-code lines include label + task id (can be separate from full command line).\n- bats tests/trudger_test.bats\n\nAcceptance criteria:\n- Log entries remain single-line even when values contain control characters.\n- Logs include full command strings and arguments.\n- Exit-code log lines include label and task id (when available), even if logged on a separate line.","notes":"Completed: logging now sanitizes full entries, start/exit lines include full command+args and exit lines include label+task; tests updated.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-31T05:32:37.517344637Z","created_by":"mark","updated_at":"2026-02-04T02:09:44.071342779Z","closed_at":"2026-02-04T02:09:44.071287092Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-29x","depends_on_id":"tr-2v7","type":"parent-child","created_at":"2026-01-31T05:32:37.550086125Z","created_by":"mark"}]}
{"id":"tr-2c7","title":"Adopt env-var command + hook contract","description":"OpenSpec refs:\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Command execution environment\n  - Scenario: Command environment provided\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Task show output handling\n  - Scenario: Show output is prompt-only\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Hook execution semantics\n  - Scenario: Hook receives env vars\n\nWork:\n- Update command/hook execution to pass task context via TRUDGER_* env vars.\n- Remove positional task args for commands and hooks.\n- Set TRUDGER_TASK_ID only after a task is selected (not for commands.next_task).\n- After commands.task_show, set TRUDGER_TASK_SHOW and keep it available for subsequent commands/hooks.\n- After each commands.task_status, set TRUDGER_TASK_STATUS to the latest value.\n- Always set TRUDGER_CONFIG_PATH.\n\nExpected outputs:\n- Commands and hooks run with env vars only; no positional task id.\n\nValidation/tests:\n- Tests assert env vars are present and positional args are empty.","acceptance_criteria":"1. commands.next_task runs without TRUDGER_TASK_ID set; once a task is selected, TRUDGER_TASK_ID is set for subsequent commands/hooks. (OpenSpec: Command execution environment scenario.)\n2. TRUDGER_TASK_SHOW is set after commands.task_show and preserved for subsequent commands/hooks without parsing. (OpenSpec: Task show output handling scenario.)\n3. TRUDGER_TASK_STATUS reflects the most recent commands.task_status result and is available to hooks after review. (OpenSpec: Command execution environment scenario.)\n4. TRUDGER_CONFIG_PATH is always set. (OpenSpec: Command execution environment scenario.)\n5. Only relevant env vars are set for each command; unused prompt env vars are unset. (OpenSpec: Command execution environment + Agent prompt execution scenarios.)\n6. No positional task id arguments are passed to commands/hooks. (OpenSpec: Command execution environment + Hook execution semantics scenarios.)\n7. Tests verify env var presence/timing, absence of irrelevant env vars, and no positional args.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T06:07:10.112306839Z","created_by":"mark","updated_at":"2026-02-04T10:22:03.782439685Z","closed_at":"2026-02-04T10:22:03.782422791Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2c7","depends_on_id":"tr-1cs","type":"parent-child","created_at":"2026-02-04T06:07:10.116533761Z","created_by":"mark"},{"issue_id":"tr-2c7","depends_on_id":"tr-30q","type":"blocks","created_at":"2026-02-04T06:07:10.118381841Z","created_by":"mark"}]}
{"id":"tr-2ef","title":"Add shared command helper and hook argument substitution","description":"OpenSpec refs:\n- Requirement: Hook execution semantics — Scenario: Hook uses $1 substitution\n- Requirement: Hook execution semantics — Scenario: Hook without substitution\n\nExpected outputs:\n- Shared helper for executing task/hook commands (next_task, task_show, task_update_in_progress, hooks).\n- Hook commands containing `$1` or `${1}` run via a shell with task id as $1.\n- Hook commands without substitution receive task id as first argument.\n\nValidation/tests:\n- Covered by new/updated BATS cases in the \"Extend tests\" task.\n\nSuccess criteria:\n- Hook execution matches spec and the helper is used consistently for task/hook commands.","acceptance_criteria":"Acceptance criteria: (1) Hook command with / executes via shell with task id available as . (2) Hook command without substitution receives task id as first argument. (3) Helper is used for all task/hook command invocations.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T05:25:49.562064640Z","created_by":"mark","updated_at":"2026-01-29T07:55:42.385464533Z","closed_at":"2026-01-29T07:55:42.385399163Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2ef","depends_on_id":"tr-2mc","type":"parent-child","created_at":"2026-01-29T05:25:49.571031781Z","created_by":"mark"}]}
{"id":"tr-2fd","title":"Rust hook execution + outcome handling","description":"OpenSpec refs:\n- openspec/changes/refactor-trudger-rust-native/specs/trudger/spec.md Requirement: Rust hook execution parity (Scenarios: Hook uses `$1` substitution in Rust; Hook without substitution in Rust)\n- openspec/specs/trudger/spec.md Requirement: Hook execution semantics (Scenarios: Hook uses `$1` substitution; Hook without substitution)\n- openspec/specs/trudger/spec.md Requirement: Task closure on success (Scenario: Task closed after successful review)\n- openspec/specs/trudger/spec.md Requirement: Requires-human escalation (Scenario: Task still open after review)\n\nWork:\n- Implement hook execution in Rust with `$1`/`${1}` substitution detection and shell invocation when present.\n- If no substitution token, pass task id as first argument.\n- Invoke on_completed when status == closed; invoke on_requires_human otherwise.\n\nExpected outputs:\n- Hook commands receive task id per spec and are executed in the right outcome path.\n\nValidation/tests:\n- Tests for both substitution paths and outcome-based hook invocation.","acceptance_criteria":"1. Hook commands containing `$1` or `${1}` are executed via a shell with task id available as `$1`. (OpenSpec: Rust hook execution parity scenario; Hook execution semantics scenario.)\n2. Hook commands without `$1`/`${1}` receive task id as argv[1]. (OpenSpec: Rust hook execution parity scenario; Hook execution semantics scenario.)\n3. on_completed executes only when status == closed; on_requires_human executes otherwise. (OpenSpec: Task closure on success; Requires-human escalation scenarios.)\n4. Tests cover both substitution behaviors and both outcome paths.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T04:43:56.740262629Z","created_by":"mark","updated_at":"2026-02-05T03:04:17.840310553Z","closed_at":"2026-02-05T03:04:17.840293614Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2fd","depends_on_id":"tr-1bh","type":"blocks","created_at":"2026-02-04T04:43:56.770366340Z","created_by":"mark"},{"issue_id":"tr-2fd","depends_on_id":"tr-3j8","type":"parent-child","created_at":"2026-02-04T04:43:56.765494530Z","created_by":"mark"}]}
{"id":"tr-2mc","title":"Refactor Trudger config parsing, docs, and test helpers","description":"Goals:\n- Align config parsing/validation with spec using yq, required keys, null handling, unknown key warnings, and missing-config bootstrap messaging.\n- Standardize hook execution and task selection/review behaviors to match the updated spec.\n- Reduce duplication by consolidating specs, refactoring tests/fixtures, and updating docs/prompts.\n\nScope:\n- Code: `trudger` script + shared command execution helper.\n- Tests/fixtures: `tests/trudger_test.bats`, `tests/fixtures/bin/*`.\n- Docs/specs: `README.md`, `prompts/*.md`, `openspec/specs/trudger/spec.md`, and removal of duplicate spec copies under `openspec/changes/`.\n\nOpenSpec refs:\n- ADDED: Configuration loading (Scenario: Missing config file)\n- ADDED: Configuration validation (Scenario: Required config value missing)\n- ADDED: Configuration parsing (Scenario: Null config value)\n- ADDED: Unknown config keys (Scenario: Unknown config key)\n- ADDED: Hook execution semantics (Scenario: Hook uses $1 substitution; Scenario: Hook without substitution)\n- MODIFIED: Task selection (Scenario: No selectable tasks; Scenario: Task not ready is skipped)\n- MODIFIED: Task closure on success (Scenario: Task closed after successful review)\n- MODIFIED: Requires-human escalation (Scenario: Task still open after review)\n- MODIFIED: Codex update verification (Scenario: Missing status after review)","acceptance_criteria":"Acceptance criteria: (1) All added/modified OpenSpec requirements listed in the epic are implemented in trudger and reflected in docs/tests. (2) Tests cover each referenced scenario and pass. (3) openspec validate refactor-trudger-config-and-docs --strict --no-interactive succeeds.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-29T05:24:30.328999195Z","created_by":"mark","updated_at":"2026-01-30T01:55:11.583693463Z","closed_at":"2026-01-30T01:55:11.583627637Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-2v7","title":"Update trudger logging, parsing, and reexec behavior","description":"Goals:\n- Implement OpenSpec change update-trudger-logging-and-parsing for logging, parse errors, prompt context, and reexec handling.\n\nScope:\n- YAML parse failure handling with clear error.\n- Prompt context via env vars (TRUDGER_PROMPT/TRUDGER_REVIEW_PROMPT/ TRUDGER_TASK_SHOW) and no prompt substitution.\n- Logging semantics (single-line, escaped control chars, full command text).\n- Error trap exits via quit path.\n- Reexec path resolution + logging.\n- Tests and validation updates.\n\nOut of scope:\n- Changing task selection or hook behavior beyond env-var contract.\n\nAcceptance criteria:\n- Spec deltas in openspec/changes/update-trudger-logging-and-parsing are implemented.\n- Tests cover parse failure, env-var prompt context, logging/error handling, and reexec path logging.\n- shellcheck, bats, and openspec validate all pass.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-31T05:31:35.090103295Z","created_by":"mark","updated_at":"2026-02-04T08:49:29.813374118Z","closed_at":"2026-02-04T08:49:29.813296291Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-2vc","title":"Refactor: split src/main.rs into modules (run/doctor/tmux/logging)","description":"`src/main.rs` is currently a ~3k LOC monolith that mixes:\n- CLI parsing and config bootstrap\n- logging\n- shell command execution (`bash -lc`)\n- tmux integration\n- main run loop state machine\n- doctor mode\n- unit tests\n\nRefactor into focused modules to make changes safer to land for release polish.\n\nSuggested module split (names flexible):\n- `src/cli.rs`: `Cli`, `CliCommand`, parsing helpers\n- `src/logger.rs`: `Logger`, `sanitize_log_value`\n- `src/shell.rs`: command execution + env wiring (`CommandEnv`, `run_shell_command_*`)\n- `src/tmux.rs`: `TmuxState`, `build_tmux_name`\n- `src/run_loop.rs`: `RuntimeState` + `run_loop` state machine\n- `src/doctor.rs`: doctor mode helpers + checks\n- `src/main.rs`: small wiring layer\n\nKeep behavior identical; this is purely a clarity/structure refactor.","acceptance_criteria":"Done when:\n- `src/main.rs` contains no logic beyond wiring (mode selection + calling into modules). All non-trivial behavior lives in modules.\n- The unit tests currently defined in `src/main.rs` are moved into dedicated test module file(s) (for example `src/unit_tests.rs`), with `src/main.rs` only containing a `#[cfg(test)] mod ...;` declaration (no inline test bodies).\n- No behavior changes: all existing unit tests continue to pass.\n- Quality gates pass: `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, `cargo test`.\n- No new public API surface beyond what the binary needs (`pub(crate)` preferred).","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-06T08:55:56.329439763Z","created_by":"mark","updated_at":"2026-02-06T10:15:30.527269873Z","closed_at":"2026-02-06T10:15:30.527253793Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2vc","depends_on_id":"tr-obz","type":"parent-child","created_at":"2026-02-06T09:13:42.433037743Z","created_by":"mark"}]}
{"id":"tr-2vh","title":"Rust tests + validation","description":"OpenSpec refs:\n- openspec/changes/refactor-trudger-rust-native/specs/trudger/spec.md Requirements: Rust entrypoint; Rust configuration parsing; Rust in-process loop; Rust hook execution parity; Rust logging parity (all scenarios)\n- openspec/specs/trudger/spec.md Requirements exercised by Rust implementation: Prompt file presence; Configuration loading/validation/unknown keys; Task selection; Agent prompt execution; Task show output handling; Task closure on success; Requires-human escalation; Agent update verification\n\nWork:\n- Add tests for config parsing (nulls, invalid YAML, unknown keys), hook substitution semantics, and log formatting/escaping.\n- Add integration tests for task loop behavior (next_task exit handling, skip-not-ready, missing status).\n- Smoke run with sample_configuration/*.yml using target/release/trudger.\n\nExpected outputs:\n- Test suite and smoke run cover the Rust-specific requirements and core task loop behavior.\n\nValidation/tests:\n- cargo test\n- Smoke run with sample_configuration/*.yml using release binary","acceptance_criteria":"1. Tests cover Rust entrypoint execution, config parsing (nulls, invalid YAML, unknown keys), in-process loop behavior, env-var command contract, hook semantics, and log formatting/escaping. (OpenSpec: Rust requirements + scenarios.)\n2. Integration tests exercise task selection exit semantics, skip-not-ready, env-var prompt handling, and missing-status error. (OpenSpec: Task selection, Agent prompt execution, Agent update verification scenarios.)\n3. cargo test passes.\n4. Smoke run using sample_configuration/*.yml with target/release/trudger succeeds.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T04:44:33.308741208Z","created_by":"mark","updated_at":"2026-02-05T03:20:11.527622587Z","closed_at":"2026-02-05T03:20:11.527590929Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2vh","depends_on_id":"tr-1bh","type":"blocks","created_at":"2026-02-04T04:44:33.317986828Z","created_by":"mark"},{"issue_id":"tr-2vh","depends_on_id":"tr-1nf","type":"blocks","created_at":"2026-02-04T04:44:33.314728358Z","created_by":"mark"},{"issue_id":"tr-2vh","depends_on_id":"tr-2fd","type":"blocks","created_at":"2026-02-04T04:44:33.319490302Z","created_by":"mark"},{"issue_id":"tr-2vh","depends_on_id":"tr-37d","type":"blocks","created_at":"2026-02-04T04:44:33.320964180Z","created_by":"mark"},{"issue_id":"tr-2vh","depends_on_id":"tr-3j8","type":"parent-child","created_at":"2026-02-04T04:44:33.312951854Z","created_by":"mark"},{"issue_id":"tr-2vh","depends_on_id":"tr-7vm","type":"blocks","created_at":"2026-02-04T04:44:33.316441286Z","created_by":"mark"}]}
{"id":"tr-2xy","title":"Centralize base config in tests","description":"OpenSpec refs:\n- Requirement: Configuration loading — Scenario: Missing config file\n- Requirement: Configuration validation — Scenario: Required config value missing\n- Requirement: Configuration parsing — Scenario: Null config value\n\nExpected outputs:\n- Centralized base config setup in `tests/trudger_test.bats` with all required keys.\n- Tests reuse the shared base config to reduce duplication and keep required fields in sync.\n\nValidation/tests:\n- BATS suite passes with shared base config.\n\nSuccess criteria:\n- Test fixtures stay aligned with required config fields and are easier to maintain.","acceptance_criteria":"Acceptance criteria: (1) Base config includes all required keys and non-empty values. (2) Tests reuse the shared base config rather than re-declaring required fields.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T05:26:14.048626175Z","created_by":"mark","updated_at":"2026-01-29T09:03:15.335203958Z","closed_at":"2026-01-29T09:03:15.335159913Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2xy","depends_on_id":"tr-2mc","type":"parent-child","created_at":"2026-01-29T05:26:14.073885268Z","created_by":"mark"},{"issue_id":"tr-2xy","depends_on_id":"tr-365","type":"waits-for","created_at":"2026-01-29T05:26:14.079065130Z","created_by":"mark"}]}
{"id":"tr-2zt","title":"Update tests to use --config and sample configs","description":"OpenSpec refs:\n- Requirement: Config flag override — Scenario: provided config path used\n- Requirement: Sample config files — Scenario: sample configs available in repo\n\nExpected outputs:\n- Tests that need config use `-c/--config` with files in `sample_configuration/`.\n- Inline config definitions in tests are replaced with sample configs where appropriate.\n\nValidation/tests:\n- `bats tests/trudger_test.bats` passes after updates.\n\nSuccess criteria:\n- Tests consistently rely on the config flag and sample configs, reducing duplication.","acceptance_criteria":"Acceptance criteria: (1) Tests that load config use -c/--config. (2) Sample config files are used instead of inline YAML where possible.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T06:06:02.179922292Z","created_by":"mark","updated_at":"2026-01-30T02:08:59.123375307Z","closed_at":"2026-01-30T02:08:59.123330480Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2zt","depends_on_id":"tr-1hl","type":"waits-for","created_at":"2026-01-29T06:06:02.187221461Z","created_by":"mark"},{"issue_id":"tr-2zt","depends_on_id":"tr-jyr","type":"parent-child","created_at":"2026-01-29T06:06:02.184031544Z","created_by":"mark"},{"issue_id":"tr-2zt","depends_on_id":"tr-rg8","type":"waits-for","created_at":"2026-01-29T06:06:02.185632425Z","created_by":"mark"}]}
{"id":"tr-305","title":"probe task","description":"probe","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-29T06:03:28.181049417Z","created_by":"mark","updated_at":"2026-01-29T06:03:42.322989858Z","source_repo":".","deleted_at":"2026-01-29T06:03:42.322981732Z","deleted_by":"mark","delete_reason":"delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"tr-30q","title":"Update config schema for agent_command + agent_review_command","description":"OpenSpec refs:\\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Configuration validation\\n  - Scenario: Required config value missing\\n\\nWork:\\n- Update config schema/validation to require agent_command and agent_review_command.\\n- Remove codex_command from required keys (treat as invalid/unknown as appropriate).\\n\\nExpected outputs:\\n- Config validation errors name missing agent_command/agent_review_command.\\n\\nValidation/tests:\\n- Unit or bats tests for missing required keys.\\n\\nSuccess criteria:\\n- Missing agent_command or agent_review_command yields clear non-zero error.","acceptance_criteria":"1. Config validation requires agent_command and agent_review_command; missing values are named in the error. (OpenSpec: Configuration validation scenario.)\n2. If codex_command is present, validation fails with a clear migration error (not just an unknown-key warning).\n3. Tests cover missing agent_command/agent_review_command and codex_command presence.","notes":"Verified current implementation: Rust config validation in src/config.rs requires agent_command/agent_review_command and includes a unit test rejecting codex_command. However, the Bash script  still reads/validates codex_command and bats tests are still codex_command-based. Acceptance criteria 1–3 are not met end-to-end until the shell config validation and tests are updated to the new keys (or clarified to be Rust-only).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T06:06:58.682623056Z","created_by":"mark","updated_at":"2026-02-04T09:46:41.396729037Z","closed_at":"2026-02-04T09:46:41.396711792Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["human_required"],"dependencies":[{"issue_id":"tr-30q","depends_on_id":"tr-1cs","type":"parent-child","created_at":"2026-02-04T06:06:58.707565020Z","created_by":"mark"}],"comments":[{"id":3,"issue_id":"tr-30q","author":"Mark Wotton","text":"Do you want this task to update the Bash  config validation and bats tests to use / (and fail on ), or is the Rust-only validation sufficient for now? I can proceed either way.","created_at":"2026-02-04T09:33:04Z"}]}
{"id":"tr-31i","title":"Add shared queue helpers and update fixtures","description":"OpenSpec refs:\n- Requirement: Task selection — Scenario: No selectable tasks\n- Requirement: Task selection — Scenario: Task not ready is skipped\n\nExpected outputs:\n- Shared queue/fixture helper(s) for `tests/fixtures/bin/*`.\n- Fixtures updated to use shared helpers to simulate task queues consistently.\n\nValidation/tests:\n- BATS suite passes with fixture helper updates.\n\nSuccess criteria:\n- Fixture behavior is consistent and queue setup logic is no longer duplicated.","acceptance_criteria":"Acceptance criteria: (1) Fixture bins use shared queue/fixture helpers. (2) Queue helpers can represent ready/open vs not-ready tasks used in task selection scenarios.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T05:26:23.141924426Z","created_by":"mark","updated_at":"2026-01-29T09:08:46.236169425Z","closed_at":"2026-01-29T09:08:46.236107779Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-31i","depends_on_id":"tr-2mc","type":"parent-child","created_at":"2026-01-29T05:26:23.166862367Z","created_by":"mark"},{"issue_id":"tr-31i","depends_on_id":"tr-2xy","type":"waits-for","created_at":"2026-01-29T05:26:23.172009220Z","created_by":"mark"}]}
{"id":"tr-34q","title":"Use resolved reexec path and log it","description":"OpenSpec refs:\n- openspec/specs/trudger/spec.md Requirement: Reexec path resolution\n  - Scenario: Reexec uses resolved path\n\nExpected outputs:\n- Resolve executable path using `command -v \"$0\"` when available; otherwise fall back to `$0`.\n- Exec using the resolved path (if found) and log the path actually used.\n\nValidation/tests:\n- Add bats coverage that inspects the log for the reexec path used.\n- bats tests/trudger_test.bats\n\nAcceptance criteria:\n- Reexec uses `command -v \"$0\"` when it resolves to a path; else uses `$0`.\n- Log entry records the reexec path used.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T05:32:50.964076986Z","created_by":"mark","updated_at":"2026-02-05T01:00:40.252191040Z","closed_at":"2026-02-05T01:00:40.252175530Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-34q","depends_on_id":"tr-2v7","type":"parent-child","created_at":"2026-01-31T05:32:50.968361896Z","created_by":"mark"}]}
{"id":"tr-34r","title":"Run BATS test suite","description":"OpenSpec refs:\n- Requirement: Config flag override — Scenario: provided config path used; Scenario: missing config path errors\n- Requirement: Sample config files — Scenario: sample configs available in repo\n\nExpected outputs:\n- `bats tests/trudger_test.bats` completes successfully.\n\nValidation/tests:\n- Run `bats tests/trudger_test.bats`.\n\nSuccess criteria:\n- Test suite exits 0 with all tests passing.","acceptance_criteria":"Acceptance criteria: (1) bats tests/trudger_test.bats exits 0 with all tests passing.","notes":"Acceptance criteria verified: bats tests/trudger_test.bats exits 0 with all tests passing (2026-01-30). Unable to close because dependencies are still open: tr-2zt, tr-htz.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T06:06:27.727815244Z","created_by":"mark","updated_at":"2026-01-30T02:16:33.824136890Z","closed_at":"2026-01-30T02:16:33.824074563Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-34r","depends_on_id":"tr-2zt","type":"waits-for","created_at":"2026-01-29T06:06:27.733638122Z","created_by":"mark"},{"issue_id":"tr-34r","depends_on_id":"tr-htz","type":"waits-for","created_at":"2026-01-29T06:06:27.735325410Z","created_by":"mark"},{"issue_id":"tr-34r","depends_on_id":"tr-jyr","type":"parent-child","created_at":"2026-01-29T06:06:27.732010018Z","created_by":"mark"}]}
{"id":"tr-35l","title":"Tests: add Rust coverage for manual -t task flow and tmux name builder","description":"Add missing Rust unit tests that cover two release-critical surfaces:\n\n1) Manual task flow (`trudger -t ...`)\n- Ensure manual tasks bypass `commands.next_task`.\n- Ensure not-ready manual tasks fail fast with a clear Quit reason.\n- Ensure ready manual tasks still execute solve/review + hooks correctly.\n\n2) tmux pane title formatting (`build_tmux_name`)\n- Validate base-name trimming behavior (`: fg` / `: codex`).\n- Validate COMPLETED/NEEDS_HUMAN segments and phase suffixes (SOLVING/REVIEWING/ERROR).\n\nThese tests should be “honest”: drive behavior through the same command execution paths used in production (fixture binaries are fine), not by bypassing core logic.","acceptance_criteria":"Done when:\n- New unit test(s) cover manual `-t` tasks (both ready and not-ready cases) and assert the expected Quit code/reason and that `next-task` is not invoked.\n- New unit test(s) cover `build_tmux_name` formatting for at least: base trimming, completed list, needs-human list, and phase suffixes.\n- Quality gates pass: `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, `cargo test`.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-06T08:55:56.296813191Z","created_by":"mark","updated_at":"2026-02-06T10:49:07.234523848Z","closed_at":"2026-02-06T10:49:07.234508029Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-35l","depends_on_id":"tr-2vc","type":"blocks","created_at":"2026-02-06T09:33:26.672651523Z","created_by":"mark"},{"issue_id":"tr-35l","depends_on_id":"tr-obz","type":"parent-child","created_at":"2026-02-06T09:13:53.202035151Z","created_by":"mark"}]}
{"id":"tr-365","title":"Implement yq-based config loading and validation","description":"OpenSpec refs:\n- Requirement: Configuration loading — Scenario: Missing config file\n- Requirement: Configuration validation — Scenario: Required config value missing\n- Requirement: Configuration parsing — Scenario: Null config value\n- Requirement: Unknown config keys — Scenario: Unknown config key\n\nExpected outputs:\n- `trudger` loads `~/.config/trudger.yml` via `yq`.\n- Missing config file => non-zero exit with bootstrap instructions for sample configs.\n- Missing/empty required keys => non-zero exit naming the field.\n- Null required values => non-zero exit naming the field.\n- Unknown top-level keys => warning + continue startup.\n- Missing `yq` => non-zero exit with clear install/use guidance.\n\nValidation/tests:\n- Covered by new/updated BATS cases in the \"Extend tests\" task.\n\nSuccess criteria:\n- Config parsing/validation matches OpenSpec and errors are explicit and actionable.","acceptance_criteria":"Acceptance criteria: (1) Missing config file prints bootstrap instructions and exits non-zero. (2) Missing/empty required key errors with the field name. (3) Null required value errors with the field name. (4) Unknown top-level key logs a warning and continues. (5) Missing yq errors clearly and exits non-zero.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T05:24:58.550086753Z","created_by":"mark","updated_at":"2026-01-29T06:18:35.252988311Z","closed_at":"2026-01-29T06:18:35.252943644Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-365","depends_on_id":"tr-2mc","type":"parent-child","created_at":"2026-01-29T05:24:58.554800546Z","created_by":"mark"}]}
{"id":"tr-37d","title":"Rust logging parity","description":"OpenSpec refs:\\n- openspec/changes/refactor-trudger-rust-native/specs/trudger/spec.md Requirement: Rust logging parity (Scenario: Rust log format matches shell)\\n- openspec/changes/update-trudger-logging-and-parsing/specs/trudger/spec.md Requirement: Execution logging (Scenarios: Command logging includes full command; Log values include control characters)\\n- openspec/changes/update-trudger-logging-and-parsing/specs/trudger/spec.md Requirement: Error exit logging (Scenario: Unhandled error triggers quit)\\n\\nWork:\\n- Implement log_path handling and log entry format identical to shell implementation.\\n- Escape control characters in logged values and include full command strings/args.\\n- Ensure quit reasons are logged via the same path before exit.\\n\\nExpected outputs:\\n- Rust logs match shell format and escaping rules.\\n\\nValidation/tests:\\n- Tests compare Rust log lines against expected shell-format fixtures.\\n","acceptance_criteria":"1. When log_path is set, Rust logs use the same single-line format and control-character escaping as the shell implementation. (OpenSpec: Rust logging parity scenario.)\\n2. Command start/exit logs include full command strings/args and escape control characters. (OpenSpec: Execution logging scenarios.)\\n3. Quit reasons are logged via the quit path before exit. (OpenSpec: Error exit logging scenario.)\\n4. Tests validate log formatting and escaping against a known fixture.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T04:44:18.521759395Z","created_by":"mark","updated_at":"2026-02-05T03:14:37.880459965Z","closed_at":"2026-02-05T03:14:37.880443618Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-37d","depends_on_id":"tr-1bh","type":"blocks","created_at":"2026-02-04T04:44:18.552051220Z","created_by":"mark"},{"issue_id":"tr-37d","depends_on_id":"tr-3j8","type":"parent-child","created_at":"2026-02-04T04:44:18.547077833Z","created_by":"mark"}]}
{"id":"tr-3ay","title":"Use env var prompt context (no substitution)","description":"OpenSpec refs:\n- openspec/changes/update-trudger-logging-and-parsing/specs/trudger/spec.md Requirement: Prompt context via env vars\n  - Scenario: Task show output contains special characters\n\nExpected outputs:\n- Prompt templates are not substituted by Trudger.\n- Task show output is passed via TRUDGER_TASK_SHOW without mutation.\n- Agent commands receive TRUDGER_PROMPT/TRUDGER_REVIEW_PROMPT with prompt content.\n\nValidation/tests:\n- bats: \"task_show preserves ampersands and backslashes via TRUDGER_TASK_SHOW\" in tests/trudger_test.bats\n- bats tests/trudger_test.bats\n\nAcceptance criteria:\n- Agent commands receive prompt content via TRUDGER_PROMPT/TRUDGER_REVIEW_PROMPT.\n- TRUDGER_TASK_SHOW includes special characters exactly as returned.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-31T05:32:29.510262158Z","created_by":"mark","updated_at":"2026-02-05T00:50:10.399712059Z","closed_at":"2026-02-05T00:50:10.399695979Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-3ay","depends_on_id":"tr-2v7","type":"parent-child","created_at":"2026-01-31T05:32:29.514529962Z","created_by":"mark"}]}
{"id":"tr-3do","title":"Align docs and prompts with config + hook behavior","description":"OpenSpec refs:\n- Requirement: Configuration loading — Scenario: Missing config file\n- Requirement: Configuration validation — Scenario: Required config value missing\n- Requirement: Configuration parsing — Scenario: Null config value\n- Requirement: Unknown config keys — Scenario: Unknown config key\n- Requirement: Hook execution semantics — Scenario: Hook uses $1 substitution; Scenario: Hook without substitution\n- Requirement: Task selection — Scenario: No selectable tasks; Scenario: Task not ready is skipped\n- Requirement: Task closure on success — Scenario: Task closed after successful review\n- Requirement: Requires-human escalation — Scenario: Task still open after review\n- Requirement: Codex update verification — Scenario: Missing status after review\n\nExpected outputs:\n- `README.md` and `prompts/*.md` updated to document config path, required keys, `yq` dependency, unknown key warnings, hook semantics, review hook outcomes, status validation, and task selection behavior.\n\nValidation/tests:\n- Manual doc review for alignment with spec (no automated tests).\n\nSuccess criteria:\n- Docs accurately reflect the updated spec-driven behavior and config requirements.","acceptance_criteria":"Acceptance criteria: (1) README/prompts mention ~/.config/trudger.yml, required keys, and the yq dependency. (2) Docs explain unknown key warnings and hook argument/substitution rules. (3) Docs describe task selection outcomes and review hook behavior (completed vs requires human).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T05:26:39.110993238Z","created_by":"mark","updated_at":"2026-01-29T09:14:09.574087980Z","closed_at":"2026-01-29T09:14:09.574042590Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-3do","depends_on_id":"tr-1ta","type":"waits-for","created_at":"2026-01-29T05:26:39.118214886Z","created_by":"mark"},{"issue_id":"tr-3do","depends_on_id":"tr-2mc","type":"parent-child","created_at":"2026-01-29T05:26:39.115214224Z","created_by":"mark"},{"issue_id":"tr-3do","depends_on_id":"tr-365","type":"waits-for","created_at":"2026-01-29T05:26:39.116680550Z","created_by":"mark"}]}
{"id":"tr-3hr","title":"Require commands.next_task in config","description":"Validate commands.next_task; produce migration error if missing; update docs/tests.","acceptance_criteria":"Criteria: commands.next_task is required when no manual task IDs; missing/empty next_task errors with migration guidance; when manual IDs provided, missing/empty next_task logs warning only; empty strings count as missing.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-30T02:50:13.654540883Z","created_by":"mark","updated_at":"2026-02-04T02:02:43.133324974Z","closed_at":"2026-02-04T02:02:43.133280567Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-3hr","depends_on_id":"tr-1xw","type":"blocks","created_at":"2026-01-30T02:50:14.015579874Z","created_by":"mark"},{"issue_id":"tr-3hr","depends_on_id":"tr-26e","type":"parent-child","created_at":"2026-01-30T02:50:13.660206521Z","created_by":"mark"}]}
{"id":"tr-3ii","title":"Handle invalid YAML config parse errors","description":"OpenSpec refs:\n- openspec/specs/trudger/spec.md Requirement: Configuration parsing\n  - Scenario: Config parse failure\n\nExpected outputs:\n- Detect invalid YAML during config load.\n- Exit non-zero with an error that includes the config path.\n- Do not fall through to missing-key validation on parse failure.\n\nValidation/tests:\n- bats: \"invalid yaml prints parse error\" in tests/trudger_test.bats\n- bats tests/trudger_test.bats\n\nAcceptance criteria:\n- Running trudger with an invalid YAML config exits non-zero.\n- Error output includes the config path and a parse-failure message.\n- No subsequent validation errors are emitted after parse failure.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-31T05:32:22.181649511Z","created_by":"mark","updated_at":"2026-02-05T00:47:20.762383928Z","closed_at":"2026-02-05T00:47:20.762367610Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-3ii","depends_on_id":"tr-2v7","type":"parent-child","created_at":"2026-01-31T05:32:22.185682973Z","created_by":"mark"}]}
{"id":"tr-3j8","title":"Refactor Trudger Rust Implementation (side-by-side)","description":"OpenSpec change: openspec/changes/refactor-trudger-rust-native.\\n\\nGoals:\\n- Add a Rust-native Trudger binary built via Cargo (release output under target/release) alongside the shell script.\\n- Implement native YAML config parsing (no yq/jq) in Rust.\\n- Use an in-process task loop (no re-exec).\\n- Match hook execution semantics and log format parity with the shell implementation.\\n\\nScope:\\n- Rust CLI, config parsing/validation, task loop, hook execution, logging, and tests/validation.","acceptance_criteria":"1. Rust binary exists under target/release (e.g., target/release/trudger) and is executable. (OpenSpec: Rust entrypoint requirement, scenario: Rust entrypoint is executable.)\n2. Rust config parsing uses native YAML, treats nulls as errors, and does not rely on yq/jq. (OpenSpec: Rust configuration parsing requirement and scenarios.)\n3. Config validation requires `agent_command` and `agent_review_command` (no `codex_command`). (OpenSpec: Configuration validation requirement.)\n4. Rust implementation uses an in-process loop with no re-exec between tasks. (OpenSpec: Rust in-process loop requirement.)\n5. Hook execution semantics match shell via `TRUDGER_*` env vars with no positional task args. (OpenSpec: Rust hook execution parity requirement and scenarios.)\n6. Rust log format matches shell log format and escaping rules when log_path is set. (OpenSpec: Rust logging parity requirement and scenario.)\n7. Validation runs: cargo test + smoke run with sample_configuration/*.yml using the release binary.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-02-04T04:42:30.713355361Z","created_by":"mark","updated_at":"2026-02-05T01:21:08.015263648Z","closed_at":"2026-02-05T01:21:08.015245899Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-3j8","depends_on_id":"tr-2v7","type":"blocks","created_at":"2026-02-04T05:05:48.112930995Z","created_by":"mark"}]}
{"id":"tr-3ul","title":"Document config flag and sample configs","description":"OpenSpec refs:\n- Requirement: Config flag override — Scenario: provided config path used\n- Requirement: Sample config files — Scenario: sample configs available in repo\n\nExpected outputs:\n- `README.md` documents `-c/--config` usage and that it overrides the default path.\n- `README.md` references both sample configuration files and their purposes.\n\nValidation/tests:\n- Manual doc review for alignment with OpenSpec behavior.\n\nSuccess criteria:\n- Docs clearly instruct how to use the flag and where to find sample configs.","acceptance_criteria":"Acceptance criteria: (1) README explains -c/--config override behavior. (2) README lists both sample configuration files and intended usage.","notes":"Ready to close: README documents -c/--config override and sample configs; bats tests passed (bats tests/trudger_test.bats). bd close failed with parent-blocked (tr-jyr).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T06:05:52.433639948Z","created_by":"mark","updated_at":"2026-01-30T01:58:46.172910001Z","closed_at":"2026-01-30T01:58:46.172859046Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-3ul","depends_on_id":"tr-1hl","type":"waits-for","created_at":"2026-01-29T06:05:52.441561070Z","created_by":"mark"},{"issue_id":"tr-3ul","depends_on_id":"tr-jyr","type":"parent-child","created_at":"2026-01-29T06:05:52.438003805Z","created_by":"mark"},{"issue_id":"tr-3ul","depends_on_id":"tr-rg8","type":"waits-for","created_at":"2026-01-29T06:05:52.439767840Z","created_by":"mark"}]}
{"id":"tr-3vq","title":"Sanitize log output for quit reasons and commands","description":"Strip control characters and avoid leaking secrets; align log_transition usage with new sanitization.","acceptance_criteria":"Criteria: log output escapes/strips control characters to prevent corruption; full command strings remain logged with no redaction; quit reasons sanitized with the same control-char handling.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-30T02:50:13.550357230Z","created_by":"mark","updated_at":"2026-01-31T13:36:27.586265731Z","closed_at":"2026-01-31T13:36:27.586222352Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-3vq","depends_on_id":"tr-1g8","type":"blocks","created_at":"2026-01-30T02:50:13.954216109Z","created_by":"mark"},{"issue_id":"tr-3vq","depends_on_id":"tr-26e","type":"parent-child","created_at":"2026-01-30T02:50:13.556065749Z","created_by":"mark"}]}
{"id":"tr-5xj","title":"Release polish + doctor foundations","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-02-05T13:18:10.371756465Z","created_by":"mark","updated_at":"2026-02-06T15:36:10.105496948Z","closed_at":"2026-02-06T15:36:10.105480126Z","close_reason":"All child tasks completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["human_required"]}
{"id":"tr-5xj.1","title":"Respect review_loop_limit; mark human+blocked on exhaustion","description":"Use review_loop_limit to rerun solve/review until closed or limit reached. On limit reached, mark needs-human and blocked (likely via hooks/config) and move on. Add/adjust tests.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T13:18:26.141892877Z","created_by":"mark","updated_at":"2026-02-06T06:59:48.596649059Z","closed_at":"2026-02-06T06:59:48.596632399Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-5xj.1","depends_on_id":"tr-5xj","type":"parent-child","created_at":"2026-02-05T13:18:26.141892877Z","created_by":"mark"}]}
{"id":"tr-5xj.2","title":"Make log_path optional in config/validation","description":"Allow missing/empty log_path (Logger::new(None)), update validation, docs, and tests accordingly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T13:18:29.185563887Z","created_by":"mark","updated_at":"2026-02-06T07:20:20.890887118Z","closed_at":"2026-02-06T07:20:20.890870413Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-5xj.2","depends_on_id":"tr-5xj","type":"parent-child","created_at":"2026-02-05T13:18:29.185563887Z","created_by":"mark"}]}
{"id":"tr-5xj.3","title":"Document reset_task + sample config conformance tests","description":"Ensure README example includes commands.reset_task and add automated conformance tests for sample configs (load_config + required keys).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T13:18:33.037109299Z","created_by":"mark","updated_at":"2026-02-06T08:15:06.387870841Z","closed_at":"2026-02-06T08:15:06.387854080Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-5xj.3","depends_on_id":"tr-5xj","type":"parent-child","created_at":"2026-02-05T13:18:33.037109299Z","created_by":"mark"}]}
{"id":"tr-5xj.4","title":"Add doctor scratch-db hook + sample config reset from issues.jsonl","description":"Introduce hooks.on_doctor_setup for doctor mode scratch DB setup. trudger doctor creates a temp scratch dir, runs the setup hook from the invocation CWD with TRUDGER_DOCTOR_SCRATCH_DIR set, then cleans up the scratch dir (fail hard if cleanup fails). Sample configs include an example setup hook.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T13:18:40.544926104Z","created_by":"mark","updated_at":"2026-02-06T03:29:45.985056180Z","closed_at":"2026-02-06T03:29:45.985037972Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-5xj.4","depends_on_id":"tr-5xj","type":"parent-child","created_at":"2026-02-05T13:18:40.544926104Z","created_by":"mark"}]}
{"id":"tr-5xj.5","title":"Implement trudger doctor checks using scratch DB","description":"Add a doctor subcommand that runs configured commands against the scratch DB, verifying command availability, task_show/status/update/reset/hook behavior and ready/closed parsing. Depends on new scratch-db hook.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T13:18:44.389599864Z","created_by":"mark","updated_at":"2026-02-06T07:56:19.207713360Z","closed_at":"2026-02-06T07:56:19.207679146Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-5xj.5","depends_on_id":"tr-5xj","type":"parent-child","created_at":"2026-02-05T13:18:44.389599864Z","created_by":"mark"},{"issue_id":"tr-5xj.5","depends_on_id":"tr-5xj.4","type":"blocks","created_at":"2026-02-05T13:19:02.338654120Z","created_by":"mark"}]}
{"id":"tr-5xj.6","title":"Warn on unknown nested config keys (commands/hooks)","description":"Extend config linting to flag unknown keys under commands/hooks (typo detection). Decide whether warnings are emitted at load_config or via doctor.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T13:18:47.720216276Z","created_by":"mark","updated_at":"2026-02-06T08:31:50.785939473Z","closed_at":"2026-02-06T08:31:50.785920471Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-5xj.6","depends_on_id":"tr-5xj","type":"parent-child","created_at":"2026-02-05T13:18:47.720216276Z","created_by":"mark"}]}
{"id":"tr-5xj.7","title":"Decide packaging/tests for Rust canonical vs bash wrapper","description":"Clarify release stance: install Rust binary instead of bash wrapper, and adjust tests accordingly (minimize bash coverage if Rust is canonical).","status":"closed","priority":4,"issue_type":"task","created_at":"2026-02-05T13:18:57.755439205Z","created_by":"mark","updated_at":"2026-02-06T15:36:10.036788179Z","closed_at":"2026-02-06T15:36:10.036769739Z","close_reason":"Decided: Rust binary installed via cargo install; legacy bash moved to historical/","source_repo":".","compaction_level":0,"original_size":0,"labels":["human_required"],"dependencies":[{"issue_id":"tr-5xj.7","depends_on_id":"tr-5xj","type":"parent-child","created_at":"2026-02-05T13:18:57.755439205Z","created_by":"mark"}]}
{"id":"tr-5xj.8","title":"Refactor CLI args: subcommands + -t manual tasks","description":"Implement refactor-trudger-cli-args: add subcommand parsing (doctor) and move manual task ids to -t/--task with repeated+comma-separated support; reject positional task ids with migration hint.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-06T02:42:57.705766681Z","created_by":"mark","updated_at":"2026-02-06T03:29:46.106461831Z","closed_at":"2026-02-06T03:29:46.106445385Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-5xj.8","depends_on_id":"tr-5xj","type":"parent-child","created_at":"2026-02-06T02:42:57.705766681Z","created_by":"mark"}]}
{"id":"tr-5xj.9","title":"Complete Rust migration (shim + install + tests)","description":"Implement openspec/changes/complete-trudger-rust-migration/: make Rust binary the default runtime, convert repo-root ./trudger to a thin shim, update install/docs/tests/tooling.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-06T05:27:57.000630933Z","created_by":"mark","updated_at":"2026-02-06T15:36:10.070835056Z","closed_at":"2026-02-06T15:36:10.070818040Z","close_reason":"Implemented: rust is default (shim + cargo install docs), legacy bash moved to historical, CI/hooks updated","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-5xj.9","depends_on_id":"tr-5xj","type":"parent-child","created_at":"2026-02-06T05:27:57.000630933Z","created_by":"mark"},{"issue_id":"tr-5xj.9","depends_on_id":"tr-5xj.7","type":"blocks","created_at":"2026-02-06T05:28:03.650440050Z","created_by":"mark"}]}
{"id":"tr-7vm","title":"Rust config parsing + validation","description":"OpenSpec refs:\n- openspec/changes/refactor-trudger-rust-native/specs/trudger/spec.md Requirement: Rust configuration parsing (Scenarios: null value; parse failure; no yq/jq)\n- openspec/specs/trudger/spec.md Requirement: Configuration validation (Scenario: Required config value missing)\n- openspec/specs/trudger/spec.md Requirement: Unknown config keys (Scenario: Unknown config key)\n\nWork:\n- Implement native YAML parsing into typed schema.\n- Validate required fields and nulls; emit clear error naming field.\n- Warn on unknown top-level keys to stderr and continue.\n- Ensure no yq/jq invocation for config loading in Rust.\n\nExpected outputs:\n- Config loads via serde/serde_yaml with explicit validation and warnings.\n\nValidation/tests:\n- Unit tests for missing required fields, nulls, invalid YAML, and unknown keys.","acceptance_criteria":"1. Rust config parsing uses native YAML and does not call yq/jq. (OpenSpec: Rust configuration parsing scenario: no yq/jq.)\n2. Null required values error with field name. (OpenSpec: Rust configuration parsing scenario: null config value.)\n3. Invalid YAML errors non-zero with config path in message. (OpenSpec: Rust configuration parsing scenario: parse failure.)\n4. Missing required fields error with field name, including `agent_command` and `agent_review_command`. (OpenSpec: Configuration validation scenario.)\n5. Unknown top-level keys emit warnings to stderr and continue. (OpenSpec: Unknown config keys scenario.)\n6. Unit tests cover nulls, missing fields, invalid YAML, and unknown keys.","notes":"Blocked from closing because parent tr-3j8 is parent-blocked. Implementation and tests appear complete, but close is skipped by beads. Need guidance on whether to leave open or change dependency/parent status.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T04:43:16.029202057Z","created_by":"mark","updated_at":"2026-02-05T02:47:59.898795090Z","closed_at":"2026-02-05T02:47:59.898778337Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-7vm","depends_on_id":"tr-1nf","type":"blocks","created_at":"2026-02-04T04:43:16.035054985Z","created_by":"mark"},{"issue_id":"tr-7vm","depends_on_id":"tr-3j8","type":"parent-child","created_at":"2026-02-04T04:43:16.033348475Z","created_by":"mark"}],"comments":[{"id":2,"issue_id":"tr-7vm","author":"Mark Wotton","text":"Closure blocked: beads reports parent tr-3j8 is parent-blocked. Should I leave this task open until the parent unblocks, or update dependencies so it can close?","created_at":"2026-02-04T06:33:35Z"}]}
{"id":"tr-bpp","title":"Add regression tests for env-var prompt context, command exec, log sanitization, and required next_task","description":"Cover updated semantics and failure modes in Bats for env-var contract and agent commands.\n\nExpected outputs:\n- Tests cover TRUDGER_PROMPT/TRUDGER_REVIEW_PROMPT and TRUDGER_TASK_SHOW usage.\n- Tests cover commands execution without positional task args (env vars only).\n- Tests cover log sanitization and commands.next_task missing/empty behavior for manual vs non-manual flows.\n\nValidation/tests:\n- bats tests/trudger_test.bats\n\nAcceptance criteria:\n- Tests assert env-var prompt context (no $ARGUMENTS/$TASK_SHOW substitution).\n- TRUDGER_TASK_SHOW preserves special characters.\n- Commands run via configured command strings and use env vars for task context.\n- Log sanitization of control chars is covered.\n- commands.next_task missing/empty behavior covered.","acceptance_criteria":"Criteria: tests cover $ARGUMENTS = task id (not task_show JSON), prompt embeds task_show output, bash -lc command execution for shell syntax, log sanitization of control chars (no redaction), and commands.next_task missing/empty behavior for manual vs non-manual flows.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-30T02:50:13.754574217Z","created_by":"mark","updated_at":"2026-02-05T01:36:20.376660965Z","closed_at":"2026-02-05T01:36:20.376644571Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-bpp","depends_on_id":"tr-1g8","type":"blocks","created_at":"2026-01-30T02:50:14.179179391Z","created_by":"mark"},{"issue_id":"tr-bpp","depends_on_id":"tr-1xw","type":"blocks","created_at":"2026-01-30T02:50:14.085429740Z","created_by":"mark"},{"issue_id":"tr-bpp","depends_on_id":"tr-26e","type":"parent-child","created_at":"2026-01-30T02:50:13.760613144Z","created_by":"mark"},{"issue_id":"tr-bpp","depends_on_id":"tr-3hr","type":"blocks","created_at":"2026-01-30T02:50:14.369436767Z","created_by":"mark"},{"issue_id":"tr-bpp","depends_on_id":"tr-3vq","type":"blocks","created_at":"2026-01-30T02:50:14.262303050Z","created_by":"mark"}]}
{"id":"tr-eeu","title":"Rust tmux updates (rough parity)","description":"OpenSpec refs:\\n- openspec/changes/refactor-trudger-rust-native/tasks.md item 1.6 (tmux updates with roughly equivalent semantics)\\n- openspec/specs/trudger/spec.md (tmux behavior implied by current shell implementation)\\n\\nWork:\\n- Implement tmux pane title updates in Rust when running under tmux.\\n- Match shell semantics roughly (SOLVING/REVIEWING/ERROR phases, completed/needs-human summaries), but exact parity is not required.\\n- No-op when not in tmux or tmux is unavailable.\\n\\nExpected outputs:\\n- tmux pane title updates during task processing with roughly equivalent semantics.\\n\\nValidation/tests:\\n- Manual verification in a tmux session (no automated test required).\\n","acceptance_criteria":"1. When running inside tmux, Rust updates the pane title during SOLVING/REVIEWING/ERROR phases. (Rough parity with shell behavior.)\n2. Completed and needs-human summaries are included in the title when present (format may differ).\n3. When not in tmux, no tmux commands are executed.\n4. Manual verification in tmux confirms updates occur without errors.","notes":"Verified: tmux pane titles update during SOLVING/REVIEWING/ERROR with completed/needs-human summaries when present; no tmux commands run when TMUX not set. Manual tmux verification done on 2026-02-05; no errors observed. Tests: cargo test.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T05:09:59.217065183Z","created_by":"mark","updated_at":"2026-02-05T04:12:04.313303139Z","closed_at":"2026-02-05T04:12:04.313283852Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-eeu","depends_on_id":"tr-1bh","type":"blocks","created_at":"2026-02-04T05:09:59.221096990Z","created_by":"mark"},{"issue_id":"tr-eeu","depends_on_id":"tr-3j8","type":"parent-child","created_at":"2026-02-04T05:09:59.219762911Z","created_by":"mark"}],"comments":[{"id":4,"issue_id":"tr-eeu","author":"Mark Wotton","text":"Manual tmux verification is still required. Can you run trudger inside a tmux session and confirm pane titles update for SOLVING/REVIEWING/ERROR and include completed/needs-human summaries without errors? Please share result.","created_at":"2026-02-05T03:22:53Z"},{"id":5,"issue_id":"tr-eeu","author":"Mark Wotton","text":"Manual tmux verification (2026-02-05): started a tmux session and ran trudger with 3 manual tasks. Observed pane title updates via tmux display-message during SOLVING/REVIEWING phases. Titles included completed and needs-human summaries, e.g. 'COMPLETED [task1] NEEDS_HUMAN [task2] SOLVING task3'. No tmux errors surfaced; title restored after completion.","created_at":"2026-02-05T04:09:37Z"}]}
{"id":"tr-gk1","title":"Run OpenSpec validation for the change","description":"OpenSpec refs:\n- All added/modified requirements in `openspec/changes/refactor-trudger-config-and-docs/specs/trudger/spec.md`.\n\nExpected outputs:\n- `openspec validate refactor-trudger-config-and-docs --strict --no-interactive` runs cleanly.\n\nValidation/tests:\n- Run the validation command and capture a zero exit status.\n\nSuccess criteria:\n- No OpenSpec validation errors or warnings.","acceptance_criteria":"Acceptance criteria: (1) openspec validate refactor-trudger-config-and-docs --strict --no-interactive exits 0 with no errors.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T05:27:14.167430530Z","created_by":"mark","updated_at":"2026-01-29T09:28:20.349419646Z","closed_at":"2026-01-29T09:28:20.349375662Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-gk1","depends_on_id":"tr-140","type":"waits-for","created_at":"2026-01-29T05:27:14.201633362Z","created_by":"mark"},{"issue_id":"tr-gk1","depends_on_id":"tr-2mc","type":"parent-child","created_at":"2026-01-29T05:27:14.198199128Z","created_by":"mark"},{"issue_id":"tr-gk1","depends_on_id":"tr-3do","type":"waits-for","created_at":"2026-01-29T05:27:14.199895517Z","created_by":"mark"},{"issue_id":"tr-gk1","depends_on_id":"tr-u0t","type":"waits-for","created_at":"2026-01-29T05:27:14.203315388Z","created_by":"mark"}]}
{"id":"tr-htz","title":"Add BATS coverage for --config override","description":"OpenSpec refs:\n- Requirement: Config flag override — Scenario: provided config path used\n- Requirement: Config flag override — Scenario: missing config path errors\n\nExpected outputs:\n- BATS test verifying `--config` uses the provided file.\n- BATS test verifying `-c` missing path errors non-zero with clear message.\n\nValidation/tests:\n- `bats tests/trudger_test.bats` includes these scenarios.\n\nSuccess criteria:\n- Both OpenSpec scenarios have explicit BATS coverage.","acceptance_criteria":"Acceptance criteria: (1) BATS test asserts --config loads the provided file. (2) BATS test asserts missing -c/--config path errors non-zero with clear message.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T06:06:15.366718098Z","created_by":"mark","updated_at":"2026-01-30T02:14:32.836212759Z","closed_at":"2026-01-30T02:14:32.836167966Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-htz","depends_on_id":"tr-2zt","type":"waits-for","created_at":"2026-01-29T06:06:15.401873864Z","created_by":"mark"},{"issue_id":"tr-htz","depends_on_id":"tr-jyr","type":"parent-child","created_at":"2026-01-29T06:06:15.397076124Z","created_by":"mark"},{"issue_id":"tr-htz","depends_on_id":"tr-rg8","type":"waits-for","created_at":"2026-01-29T06:06:15.399675607Z","created_by":"mark"}]}
{"id":"tr-jyr","title":"Add config flag and sample configs for trudger","description":"Goals:\n- Provide a deterministic config override via `-c/--config` so tests and alternate workflows can bypass `~/.config/trudger.yml`.\n- Ship sample configuration files for legacy hooks and `bv --robot-triage` task selection.\n- Document flag usage and sample config locations.\n\nScope:\n- Code: `trudger` CLI flag parsing and config-path handling.\n- Docs: `README.md` updates.\n- Samples/tests: `sample_configuration/*.yml`, `tests/` updates.\n\nOpenSpec refs:\n- ADDED: Config flag override (Scenario: provided config path used; Scenario: missing config path errors)\n- ADDED: Sample config files (Scenario: sample configs available in repo)\n\nDependencies:\n- Depends on `update-trudger-config-bootstrap` and `refactor-trudger-config-and-docs` (see proposal).","acceptance_criteria":"Acceptance criteria: (1) -c/--config loads the provided file and ignores ~/.config/trudger.yml; missing path exits non-zero with a clear error. (2) sample_configuration/trudgeable-with-hooks.yml and sample_configuration/robot-triage.yml exist in the repo. (3) README documents the flag and sample config locations.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-29T06:02:53.980894557Z","created_by":"mark","updated_at":"2026-01-29T10:01:55.878731725Z","closed_at":"2026-01-29T10:01:55.878686569Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-jyr","depends_on_id":"tr-2mc","type":"waits-for","created_at":"2026-01-29T06:02:53.985076367Z","created_by":"mark"}],"comments":[{"id":1,"issue_id":"tr-jyr","author":"Mark Wotton","text":"Review complete: acceptance criteria verified (config override, sample configs present, README updated) and bats suite passed. Unable to close because dependency tr-2mc is still in_progress.","created_at":"2026-01-29T09:33:18Z"}]}
{"id":"tr-kxd","title":"Externalize task commands and bootstrap config","description":"Convert Trudger to a config-driven task runner: require config bootstrap, externalize task selection/show/update commands, and preserve hook-based completion/escalation without direct bd usage.\n\nScope\n- Add command expectations for next/show/update in config (commands.*), pass task id as first arg.\n- Ensure next_task exit semantics (1=done, other non-zero=error).\n- Use show output as free-form text for Codex, ignore update output.\n- Update samples/tests/README accordingly.","acceptance_criteria":"- Missing ~/.config/trudger.yml prints curl bootstrap instructions for sample configs and exits non-zero.\n- Trudger never invokes bd directly; all task ops run via configured commands.\n- commands.next_task exit 1 yields exit 0; other non-zero exits are errors.\n- commands.task_show output is passed to Codex unparsed; commands.task_update_in_progress output is ignored.\n- Sample configs and tests reflect new commands.* contract.\n- bats tests pass.","status":"closed","priority":2,"issue_type":"epic","owner":"mwotton@gmail.com","created_at":"2026-01-28T09:21:15.567006719Z","created_by":"Mark Wotton","updated_at":"2026-01-29T03:27:11.790631824Z","closed_at":"2026-01-29T03:27:11.790567578Z","close_reason":"done","source_repo":".","compaction_level":0}
{"id":"tr-kxd.1","title":"Update trudger to use commands.next_task with exit semantics","description":"Implements update-trudger-config-bootstrap: Requirement 'Task selection' scenarios (custom next-task, exit code 1 => exit 0, other non-zero => error). Ensure task id is passed as first arg to other commands/hooks. Update error handling for next_task exit codes.","acceptance_criteria":"- next_task_command is sourced from commands.next_task.\n- Exit code 1 from next_task exits 0.\n- Non-zero (non-1) from next_task exits non-zero with clear error.\n- First token of stdout is used as task id and is passed as arg1 to other commands/hooks.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-28T09:21:27.458152850Z","created_by":"Mark Wotton","updated_at":"2026-01-29T02:00:13.889587947Z","closed_at":"2026-01-29T02:00:13.889525038Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-kxd.1","depends_on_id":"tr-kxd","type":"parent-child","created_at":"2026-01-29T01:53:39Z","created_by":"import"}]}
{"id":"tr-kxd.2","title":"Add commands.task_show + commands.task_update_in_progress support","description":"Implements update-trudger-config-bootstrap: Requirements 'Task show command' and 'Task update command'. Replace direct bd show/update usage with configured commands. Show output is treated as free-form and passed to Codex without parsing; update output ignored.","acceptance_criteria":"- commands.task_show is required and executed as <command> <task_id> <extra args>.\n- commands.task_update_in_progress is required and executed before solve; output is ignored.\n- No bd invocations remain in trudger.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-28T09:22:13.087195272Z","created_by":"Mark Wotton","updated_at":"2026-01-29T02:28:57.484030745Z","closed_at":"2026-01-29T02:28:57.483986038Z","close_reason":"Completed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-kxd.2","depends_on_id":"tr-kxd","type":"parent-child","created_at":"2026-01-28T09:22:13.088373805Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-kxd.2","depends_on_id":"tr-kxd.1","type":"blocks","created_at":"2026-01-28T09:23:47.149182145Z","created_by":"import","metadata":"","thread_id":""}]}
{"id":"tr-kxd.3","title":"Update sample configs for commands.*","description":"Implements update-trudger-config-bootstrap: Requirement 'Configured task commands' and task selection semantics. Add commands.next_task, commands.task_show, commands.task_update_in_progress to sample configs using bd/bv as appropriate. Ensure next_task exit behavior is consistent with config commands.","acceptance_criteria":"- sample_configuration/trudgeable-with-hooks.yml includes commands.next_task/task_show/task_update_in_progress using bd.\n- sample_configuration/robot-triage.yml includes commands.next_task/task_show/task_update_in_progress using bv/bd equivalents.\n- Comment headers explain command usage.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-28T09:22:23.974540484Z","created_by":"Mark Wotton","updated_at":"2026-01-29T03:15:39.294325776Z","closed_at":"2026-01-29T03:15:39.294280857Z","close_reason":"Completed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-kxd.3","depends_on_id":"tr-kxd","type":"parent-child","created_at":"2026-01-28T09:22:23.975704167Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-kxd.3","depends_on_id":"tr-kxd.1","type":"blocks","created_at":"2026-01-28T09:23:47.150495678Z","created_by":"import","metadata":"","thread_id":""}]}
{"id":"tr-kxd.4","title":"Update tests for commands.* and next_task exit semantics","description":"Implements update-trudger-config-bootstrap scenarios for commands.task_show/task_update_in_progress and next_task exit codes. Update test fixtures to use configured commands and ensure failure paths are covered.","acceptance_criteria":"- tests use commands.* in config.\n- coverage for next_task exit 1 (idle) vs non-zero error.\n- tests assert that show output is passed to Codex and update output is ignored (as applicable).","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-28T09:22:38.877194587Z","created_by":"Mark Wotton","updated_at":"2026-01-29T03:23:30.828847112Z","closed_at":"2026-01-29T03:23:30.828785372Z","close_reason":"Completed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-kxd.4","depends_on_id":"tr-kxd","type":"parent-child","created_at":"2026-01-28T09:22:38.878375851Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-kxd.4","depends_on_id":"tr-kxd.1","type":"blocks","created_at":"2026-01-28T09:23:47.151578293Z","created_by":"import","metadata":"","thread_id":""},{"issue_id":"tr-kxd.4","depends_on_id":"tr-kxd.2","type":"blocks","created_at":"2026-01-28T09:23:47.152629887Z","created_by":"import","metadata":"","thread_id":""},{"issue_id":"tr-kxd.4","depends_on_id":"tr-kxd.3","type":"blocks","created_at":"2026-01-28T09:23:47.153677318Z","created_by":"import","metadata":"","thread_id":""}]}
{"id":"tr-kxd.5","title":"Update README for commands.* contract","description":"Implements update-trudger-config-bootstrap documentation updates: describe commands.next_task/task_show/task_update_in_progress, exit code semantics, and requirement to pass task id as first arg.","acceptance_criteria":"- README documents commands.* keys, required status, and exit semantics.\n- Sample config snippets updated to match.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-28T09:22:51.062564796Z","created_by":"Mark Wotton","updated_at":"2026-01-29T03:36:39.685704837Z","closed_at":"2026-01-29T03:36:39.685659295Z","close_reason":"done","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-kxd.5","depends_on_id":"tr-kxd","type":"parent-child","created_at":"2026-01-28T09:22:51.063699822Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-kxd.5","depends_on_id":"tr-kxd.2","type":"blocks","created_at":"2026-01-28T09:23:47.154769707Z","created_by":"import","metadata":"","thread_id":""},{"issue_id":"tr-kxd.5","depends_on_id":"tr-kxd.3","type":"blocks","created_at":"2026-01-28T09:23:47.155819942Z","created_by":"import","metadata":"","thread_id":""}]}
{"id":"tr-mh0","title":"Implement config bootstrap for trudger","description":"Implement update-trudger-config-bootstrap proposal once approved: require config file, print curl bootstrap, remove in-script defaults, update tests/docs.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-28T05:53:41.832324503Z","created_by":"Mark Wotton","updated_at":"2026-01-28T06:05:42.624502730Z","closed_at":"2026-01-28T06:05:42.624502730Z","close_reason":"Completed","source_repo":".","compaction_level":0}
{"id":"tr-njl","title":"Tests for env-var contract + review command","description":"OpenSpec refs:\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Command execution environment\n  - Scenario: Command environment provided\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Agent prompt execution\n  - Scenarios: Agent solve + review; Prompt context via env vars\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Task show output handling\n  - Scenario: Show output is prompt-only\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Hook execution semantics\n  - Scenario: Hook receives env vars\n\nWork:\n- Update tests to assert env-var contract and review command usage.\n- Add fixtures for TRUDGER_PROMPT/TRUDGER_REVIEW_PROMPT and TRUDGER_TASK_SHOW.\n- Add coverage for missing prompt file error.\n\nExpected outputs:\n- Tests cover env-var prompt context, no positional args, and missing prompt file handling.\n\nValidation/tests:\n- bats tests/trudger_test.bats","acceptance_criteria":"1. Tests assert TRUDGER_PROMPT/TRUDGER_REVIEW_PROMPT are set only for the relevant command and TRUDGER_TASK_SHOW is passed to agent commands. (OpenSpec: Agent prompt execution + Task show output handling scenarios.)\n2. Tests assert no positional task id args are passed to commands/hooks. (OpenSpec: Command execution environment + Hook execution semantics scenarios.)\n3. Tests assert review uses agent_review_command. (OpenSpec: Agent solve + review scenario.)\n4. Tests cover missing prompt file error.\n5. bats tests/trudger_test.bats passes.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T06:08:04.364863480Z","created_by":"mark","updated_at":"2026-02-05T01:57:34.680517481Z","closed_at":"2026-02-05T01:57:34.680501277Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-njl","depends_on_id":"tr-1cs","type":"parent-child","created_at":"2026-02-04T06:08:04.370105793Z","created_by":"mark"},{"issue_id":"tr-njl","depends_on_id":"tr-1id","type":"blocks","created_at":"2026-02-04T06:08:04.375077176Z","created_by":"mark"},{"issue_id":"tr-njl","depends_on_id":"tr-vgj","type":"blocks","created_at":"2026-02-04T06:08:04.372704858Z","created_by":"mark"}]}
{"id":"tr-obz","title":"Release Polish: Rust clarity, dedup, and logging hardening","description":"Follow-ups from wide-ranging Rust review: reduce main.rs complexity, remove high-risk duplication, improve log failure visibility, and strengthen unit test coverage for key flows.","acceptance_criteria":"Done when:\n- All child tasks under `tr-obz` are closed.\n- CI is green (Rust + shell).\n- Release branch is in a shippable state (no known correctness regressions vs current behavior).","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-02-06T09:10:29.101586379Z","created_by":"mark","updated_at":"2026-02-06T14:37:04.423513188Z","closed_at":"2026-02-06T14:37:04.423497601Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-obz.1","title":"Refactor: dedupe shell command runner (capture vs inherit)","description":"`run_shell_command_capture` and `run_shell_command_status` share a lot of logic (logging start/exit, bash -lc wiring, args rendering, env injection). Refactor to a shared internal helper so behavior stays consistent and future changes are less error-prone.\n\nConstraints:\n- Keep log line formats identical (existing fixtures depend on them).\n- Preserve current bash invocation semantics, including how args are passed and how empty commands are handled.","acceptance_criteria":"Done when:\n- There is a single internal implementation for running `bash -lc` commands, with capture vs inherit controlled via parameters.\n- Capture vs inherit stdio semantics are preserved (capture returns stdout; inherit passes stdin/stdout/stderr through unchanged).\n- Log output remains byte-for-byte compatible with current format (fixture-based tests remain unchanged or are updated only if strictly necessary).\n- Quality gates pass: `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, `cargo test`.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-06T09:14:03.710039410Z","created_by":"mark","updated_at":"2026-02-06T10:26:25.495165217Z","closed_at":"2026-02-06T10:26:25.495149708Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-obz.1","depends_on_id":"tr-2vc","type":"blocks","created_at":"2026-02-06T09:33:26.589028068Z","created_by":"mark"},{"issue_id":"tr-obz.1","depends_on_id":"tr-obz","type":"parent-child","created_at":"2026-02-06T09:14:03.710039410Z","created_by":"mark"}]}
{"id":"tr-obz.2","title":"Refactor: simplify doctor mode command runners","description":"Doctor mode has several near-duplicate helpers (next_task/task_show/task_status/task_update/reset_task/hook) and a clippy suppression for too-many-arguments.\n\nRefactor doctor-mode code to share common plumbing (env building + bash invocation) and pass a context struct instead of long arg lists.\n\nGoal: make doctor checks easier to extend without copy/paste and without clippy allows.","acceptance_criteria":"Done when:\n- Doctor-mode helpers share common command-running plumbing (no copy/paste env + bash invocation).\n- `doctor_run_hook` no longer needs `#[allow(clippy::too_many_arguments)]` and `cargo clippy --all-targets -- -D warnings` passes.\n- Doctor mode behavior is unchanged and covered by existing tests (`cargo test` passes).\n- Code readability improves (fewer repeated parameter lists, clearer control flow).","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-06T09:14:23.274124957Z","created_by":"mark","updated_at":"2026-02-06T14:24:37.838682731Z","closed_at":"2026-02-06T14:24:37.838609201Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-obz.2","depends_on_id":"tr-obz","type":"parent-child","created_at":"2026-02-06T09:14:23.274124957Z","created_by":"mark"},{"issue_id":"tr-obz.2","depends_on_id":"tr-obz.1","type":"blocks","created_at":"2026-02-06T09:33:26.555011846Z","created_by":"mark"}]}
{"id":"tr-obz.3","title":"Logging: make log_transition failures visible (without spam)","description":"`Logger::log_transition` currently swallows file open/write errors, which can silently disable logging when `log_path` is set.\n\nChange logging behavior so failures are visible to the user but non-fatal and non-spammy (warn once, then disable logging). This should improve debuggability without breaking normal runs.","acceptance_criteria":"Done when:\n- If `log_path` is configured but the log file cannot be created/opened/appended, Trudger prints a single warning to stderr (includes the path and OS error) and continues.\n- The warning is emitted at most once per process; subsequent `log_transition` calls do not repeatedly attempt failing I/O (logging is disabled after first failure).\n- Automated coverage asserts warn-once behavior without requiring exact warning text.\n- When the log file is writable, log output format is unchanged.\n- Quality gates pass: `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, `cargo test`.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-06T09:14:40.644255140Z","created_by":"mark","updated_at":"2026-02-06T11:05:38.089194975Z","closed_at":"2026-02-06T11:05:38.089174828Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-obz.3","depends_on_id":"tr-2vc","type":"blocks","created_at":"2026-02-06T09:33:26.630524531Z","created_by":"mark"},{"issue_id":"tr-obz.3","depends_on_id":"tr-obz","type":"parent-child","created_at":"2026-02-06T09:14:40.644255140Z","created_by":"mark"}]}
{"id":"tr-obz.4","title":"Testing: enforce 100% Rust coverage (lines + regions)","description":"Raise Rust coverage to 100% for both lines and regions (LLVM source-based coverage).\n\nUse `cargo llvm-cov` as the source of truth for metrics (regions + lines). Add a repeatable local command and a CI gate so coverage regressions fail fast.\n\nNote: region coverage is stricter than line coverage; expect to add tests for error paths and branchy logic.","acceptance_criteria":"Done when:\n- Running `cargo llvm-cov --all-targets --fail-under-lines 100 --fail-under-regions 100` succeeds locally.\n- CI includes a coverage step that runs the same coverage command and fails the job if coverage drops below 100% lines or regions.\n- Coverage scope is documented (what is included/excluded, and why).\n- Test-only modules (compiled only under `cfg(test)`) may be excluded from coverage via `--ignore-filename-regex`, with justification.\n- `src/main.rs` may be excluded from coverage only if it is wiring-only and very small (<= 200 LOC).\n- Any exclusions use `--ignore-filename-regex` with justification.\n- Quality gates pass: `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, `cargo test`.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-06T09:21:49.065467947Z","created_by":"mark","updated_at":"2026-02-06T14:02:20.166250019Z","closed_at":"2026-02-06T14:02:20.166175542Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-obz.4","depends_on_id":"tr-35l","type":"blocks","created_at":"2026-02-06T09:33:26.713257523Z","created_by":"mark"},{"issue_id":"tr-obz.4","depends_on_id":"tr-obz","type":"parent-child","created_at":"2026-02-06T09:21:49.065467947Z","created_by":"mark"},{"issue_id":"tr-obz.4","depends_on_id":"tr-obz.3","type":"blocks","created_at":"2026-02-06T09:33:26.756442272Z","created_by":"mark"}]}
{"id":"tr-rg8","title":"Implement -c/--config override and missing-path error","description":"OpenSpec refs:\n- Requirement: Config flag override — Scenario: provided config path used\n- Requirement: Config flag override — Scenario: missing config path errors\n\nExpected outputs:\n- `trudger` accepts `-c/--config` and uses the provided path instead of `~/.config/trudger.yml`.\n- When the provided path is missing, the script exits non-zero with a clear error.\n- Default config path is ignored entirely when the flag is present.\n\nValidation/tests:\n- Covered by new/updated BATS cases in the \"Add BATS coverage for --config override\" task.\n\nSuccess criteria:\n- Flag behavior matches both OpenSpec scenarios.","acceptance_criteria":"Acceptance criteria: (1) -c/--config loads the provided file and ignores ~/.config/trudger.yml. (2) Missing config path exits non-zero with a clear error message.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T06:04:19.295557677Z","created_by":"mark","updated_at":"2026-01-29T10:06:42.192169662Z","closed_at":"2026-01-29T10:06:42.192092904Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-rg8","depends_on_id":"tr-jyr","type":"parent-child","created_at":"2026-01-29T06:04:19.299819864Z","created_by":"mark"}]}
{"id":"tr-syd","title":"Implement bd → br migration","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-28T09:31:47.493832783Z","created_by":"Mark Wotton","updated_at":"2026-01-28T09:45:55.959195754Z","closed_at":"2026-01-28T09:45:55.958945425Z","close_reason":"Completed","source_repo":".","compaction_level":0}
{"id":"tr-u0t","title":"Extend tests for config, hook, and helper behavior","description":"OpenSpec refs:\n- Configuration loading, validation, parsing, and unknown keys scenarios\n- Hook execution semantics scenarios\n- Task selection scenarios\n- Review hook invocation and status verification scenarios\n\nExpected outputs:\n- BATS coverage for missing config, missing/empty fields, null fields, unknown key warnings, and missing `yq`.\n- BATS coverage for hook `$1` substitution vs argument-prepend behavior.\n- BATS coverage for task selection, review hook invocation, and missing-status error behavior.\n- Tests updated to use shared config and fixture helpers where applicable.\n\nValidation/tests:\n- Run BATS suite locally (or CI) and ensure it passes.\n\nSuccess criteria:\n- Each OpenSpec scenario above has at least one test, and the full test suite passes.","acceptance_criteria":"Acceptance criteria: (1) Every referenced scenario has at least one BATS test. (2) Test suite passes with updated config/fixture helpers.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T05:27:03.099886189Z","created_by":"mark","updated_at":"2026-01-29T09:26:43.365577130Z","closed_at":"2026-01-29T09:26:43.365515652Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-u0t","depends_on_id":"tr-1ta","type":"waits-for","created_at":"2026-01-29T05:27:03.133086027Z","created_by":"mark"},{"issue_id":"tr-u0t","depends_on_id":"tr-2ef","type":"waits-for","created_at":"2026-01-29T05:27:03.131685925Z","created_by":"mark"},{"issue_id":"tr-u0t","depends_on_id":"tr-2mc","type":"parent-child","created_at":"2026-01-29T05:27:03.124885065Z","created_by":"mark"},{"issue_id":"tr-u0t","depends_on_id":"tr-2xy","type":"waits-for","created_at":"2026-01-29T05:27:03.134599917Z","created_by":"mark"},{"issue_id":"tr-u0t","depends_on_id":"tr-31i","type":"waits-for","created_at":"2026-01-29T05:27:03.136049596Z","created_by":"mark"},{"issue_id":"tr-u0t","depends_on_id":"tr-365","type":"waits-for","created_at":"2026-01-29T05:27:03.130134138Z","created_by":"mark"}]}
{"id":"tr-vgj","title":"Use agent_command + agent_review_command with env-var prompts","description":"OpenSpec refs:\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Agent prompt execution\n  - Scenario: Agent solve + review\n  - Scenario: Prompt context via env vars\n\nWork:\n- Invoke agent_command for solve and agent_review_command for review.\n- Load prompt files; error if missing before any agent command runs.\n- Pass prompt content via TRUDGER_PROMPT/TRUDGER_REVIEW_PROMPT for both agent commands.\n- Remove $ARGUMENTS/$TASK_SHOW substitution.\n\nExpected outputs:\n- Agent commands receive prompt content and task context via env vars.\n\nValidation/tests:\n- Tests assert correct env vars are set and review uses agent_review_command.","acceptance_criteria":"1. agent_command runs for solve and agent_review_command runs for review. (OpenSpec: Agent prompt execution scenario.)\n2. Only the relevant prompt env var is set: TRUDGER_PROMPT for solve, TRUDGER_REVIEW_PROMPT for review; the other is unset. (OpenSpec: Prompt context via env vars scenario.)\n3. Missing prompt files cause a clear error before any agent command runs. (OpenSpec: Prompt file presence scenario.)\n4. Tests confirm env vars and correct command selection.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T06:07:22.635361266Z","created_by":"mark","updated_at":"2026-02-04T10:31:26.804363437Z","closed_at":"2026-02-04T10:31:26.804347215Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-vgj","depends_on_id":"tr-1cs","type":"parent-child","created_at":"2026-02-04T06:07:22.639491083Z","created_by":"mark"},{"issue_id":"tr-vgj","depends_on_id":"tr-2c7","type":"blocks","created_at":"2026-02-04T06:07:22.641348129Z","created_by":"mark"}]}

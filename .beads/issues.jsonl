{"id":"tr-0lw","title":"Add trudger automation script","description":"Goal: deliver a root-level ./trudger script that loops over ready trudgeable bd tasks and drives Codex solve+review sessions with deterministic task closure or requires-human escalation. Scope: prompt file presence checks, bd task selection, codex exec orchestration, bd state updates, and error handling. Out of scope: parallel task processing or general task runner framework.","acceptance_criteria":"- ./trudger is executable and starts without explicit shell invocation.\n- Missing ~/.codex/prompts/trudge or ~/.codex/prompts/trudge_review causes a clear startup error.\n- Lowest-priority ready trudgeable task is selected per loop; exits 0 when none remain.\n- Codex exec and resume are invoked with /prompt:trudge <id> and /prompt:trudge_review <id>.\n- On review success, bd task is closed and trudgeable removed; on requires-human, comment/notes updated, trudgeable removed, requires-human added.\n- If neither close nor requires-human occurs after review, script exits non-zero.","status":"closed","priority":2,"issue_type":"epic","owner":"mark@ram.local","created_at":"2026-01-26T03:25:20.188896676Z","created_by":"Mark","updated_at":"2026-01-26T04:10:30.211124533Z","closed_at":"2026-01-26T04:10:30.211124533Z","close_reason":"Closed","source_repo":".","compaction_level":0}
{"id":"tr-0lw.1","title":"Scaffold ./trudger and prompt file checks","description":"OpenSpec add-trudger requirements: (1) 'The system SHALL provide a root-level executable script named ...' Scenario: WHEN a user runs ./trudger THEN the script starts without requiring an explicit shell invocation. (2) 'The script SHALL verify that ~/.codex/prompts/trudge and ~/.codex/prompts/trudge_review exist...' Scenario: GIVEN missing prompt files WHEN ./trudger starts THEN it exits with a clear error indicating the missing path.","acceptance_criteria":"Outputs: root-level ./trudger script with executable permissions and usage header; startup check for ~/.codex/prompts/trudge and ~/.codex/prompts/trudge_review. Validation/tests: run ./trudger to confirm direct execution works; simulate missing prompt file(s) and confirm clear error message and non-zero exit. Success: script is executable and fails fast with explicit missing-path error.","status":"closed","priority":2,"issue_type":"task","owner":"mark@ram.local","created_at":"2026-01-26T03:25:27.533863764Z","created_by":"Mark","updated_at":"2026-01-26T04:10:27.356595171Z","closed_at":"2026-01-26T04:10:27.356595171Z","close_reason":"Closed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-0lw.1","depends_on_id":"tr-0lw","type":"parent-child","created_at":"2026-01-26T03:25:27.534745566Z","created_by":"Mark","metadata":"","thread_id":""}]}
{"id":"tr-0lw.2","title":"Implement bd task selection loop","description":"OpenSpec requirement: The script SHALL select the lowest-priority ready bd task with the trudgeable label and process one task per outer loop iteration. Scenario: WHEN no ready tasks with label trudgeable are found THEN the script exits with status 0.","acceptance_criteria":"Outputs: bd query uses bd ready ordering for trudgeable tasks; lowest priority per bd ordering; loop handles one task at a time; exit 0 when none remain. Validation/tests: run against bd with zero trudgeable tasks to confirm exit 0; run with multiple trudgeable tasks to confirm bd ordering. Success: selection ordering matches bd ready output (open qualifies).","status":"closed","priority":2,"issue_type":"task","owner":"mark@ram.local","created_at":"2026-01-26T03:25:36.396621595Z","created_by":"Mark","updated_at":"2026-01-26T04:10:27.370709867Z","closed_at":"2026-01-26T04:10:27.370709867Z","close_reason":"Closed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-0lw.2","depends_on_id":"tr-0lw","type":"parent-child","created_at":"2026-01-26T03:25:36.397481786Z","created_by":"Mark","metadata":"","thread_id":""},{"issue_id":"tr-0lw.2","depends_on_id":"tr-0lw.1","type":"blocks","created_at":"2026-01-26T03:25:36.398715608Z","created_by":"Mark","metadata":"","thread_id":""}]}
{"id":"tr-0lw.3","title":"Wire Codex exec + review prompts","description":"OpenSpec requirement: For each selected task, the script SHALL start a Codex exec session with /prompt:trudge <bd-id> and then resume the same session with /prompt:trudge_review <bd-id>. Scenario: WHEN a task is selected THEN the script invokes codex exec with /prompt:trudge <bd-id> AND codex exec resume --last with /prompt:trudge_review <bd-id>.","acceptance_criteria":"Outputs: codex exec invocation and resume of same session for review (resume --last or equivalent). Validation/tests: verify codex exec called with /prompt:trudge <id> and resume with /prompt:trudge_review <id>; failures abort immediately. Success: two-step Codex flow runs per task with correct prompts; non-zero on exec failure.","status":"closed","priority":2,"issue_type":"task","owner":"mark@ram.local","created_at":"2026-01-26T03:25:42.271318250Z","created_by":"Mark","updated_at":"2026-01-26T04:10:27.377459994Z","closed_at":"2026-01-26T04:10:27.377459994Z","close_reason":"Closed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-0lw.3","depends_on_id":"tr-0lw","type":"parent-child","created_at":"2026-01-26T03:25:42.272414531Z","created_by":"Mark","metadata":"","thread_id":""},{"issue_id":"tr-0lw.3","depends_on_id":"tr-0lw.1","type":"blocks","created_at":"2026-01-26T03:25:42.273789681Z","created_by":"Mark","metadata":"","thread_id":""}]}
{"id":"tr-0lw.4","title":"Apply bd updates after Codex review","description":"OpenSpec requirements: (1) When review indicates acceptance, close bd task and remove trudgeable. Scenario: WHEN Codex review reports acceptance criteria satisfied THEN the bd task is closed and trudgeable removed. (2) When review indicates human input required, add bd comment, update notes, remove trudgeable, add requires-human. Scenario: WHEN Codex review reports that human input is required THEN task receives comment/notes update AND trudgeable removed AND requires-human added. (3) After review, verify task was closed or labeled requires-human (with trudgeable removed) and exit non-zero if neither. Scenario: WHEN review completes without closing or requires-human THEN script exits non-zero.","acceptance_criteria":"Outputs: on review completion, inspect bd task; if closed, remove trudgeable; if requires-human label present, add comment/notes, remove trudgeable, add requires-human. Validation/tests: simulate review success and verify bd task is closed; simulate requires-human response and verify labels/comment/notes; simulate missing close or requires-human and verify non-zero exit. Success: bd state reflects review outcome; script errors if neither close nor requires-human.","status":"closed","priority":2,"issue_type":"task","owner":"mark@ram.local","created_at":"2026-01-26T03:25:52.312225142Z","created_by":"Mark","updated_at":"2026-01-26T04:10:27.384901343Z","closed_at":"2026-01-26T04:10:27.384901343Z","close_reason":"Closed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-0lw.4","depends_on_id":"tr-0lw","type":"parent-child","created_at":"2026-01-26T03:25:52.313358701Z","created_by":"Mark","metadata":"","thread_id":""},{"issue_id":"tr-0lw.4","depends_on_id":"tr-0lw.1","type":"blocks","created_at":"2026-01-26T03:55:10.150781719Z","created_by":"Mark","metadata":"","thread_id":""},{"issue_id":"tr-0lw.4","depends_on_id":"tr-0lw.2","type":"blocks","created_at":"2026-01-26T03:25:52.314904619Z","created_by":"Mark","metadata":"","thread_id":""},{"issue_id":"tr-0lw.4","depends_on_id":"tr-0lw.3","type":"blocks","created_at":"2026-01-26T03:25:52.316193734Z","created_by":"Mark","metadata":"","thread_id":""}]}
{"id":"tr-0lw.5","title":"Validate trudger behavior with mock tasks","description":"OpenSpec scenarios covered: WHEN no ready trudgeable tasks are found THEN script exits 0; GIVEN missing prompt files WHEN ./trudger starts THEN clear error; WHEN task selected THEN codex exec and resume prompts invoked; WHEN review outcome applied THEN bd state updates or non-zero exit if missing.","acceptance_criteria":"Outputs: documented run evidence (logs/notes) for task selection, prompt checks, codex flow, and bd updates. Validation/tests: run a real codex session with a mock trudgeable task; confirm exit 0 when none remain; confirm missing prompts error; confirm bd updates on success/requires-human. Success: all scenarios in add-trudger change demonstrate expected behavior.","status":"closed","priority":2,"issue_type":"task","owner":"mark@ram.local","created_at":"2026-01-26T03:25:58.000611480Z","created_by":"Mark","updated_at":"2026-01-26T04:10:27.392355885Z","closed_at":"2026-01-26T04:10:27.392355885Z","close_reason":"Closed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-0lw.5","depends_on_id":"tr-0lw","type":"parent-child","created_at":"2026-01-26T03:25:58.001959141Z","created_by":"Mark","metadata":"","thread_id":""},{"issue_id":"tr-0lw.5","depends_on_id":"tr-0lw.1","type":"blocks","created_at":"2026-01-26T03:25:58.004012021Z","created_by":"Mark","metadata":"","thread_id":""},{"issue_id":"tr-0lw.5","depends_on_id":"tr-0lw.2","type":"blocks","created_at":"2026-01-26T03:25:58.006003714Z","created_by":"Mark","metadata":"","thread_id":""},{"issue_id":"tr-0lw.5","depends_on_id":"tr-0lw.3","type":"blocks","created_at":"2026-01-26T03:25:58.008106675Z","created_by":"Mark","metadata":"","thread_id":""},{"issue_id":"tr-0lw.5","depends_on_id":"tr-0lw.4","type":"blocks","created_at":"2026-01-26T03:25:58.010160509Z","created_by":"Mark","metadata":"","thread_id":""}]}
{"id":"tr-131","title":"Add trudger.yml configuration + hooks","description":"OpenSpec: openspec/changes/add-trudger-config\n\nGoals:\n- Read ~/.config/trudger.yml (warn if missing) to configure:\n  - Codex invocation command line\n  - Next-task selection command\n  - Optional hooks when a task completes or needs human approval\n  - Optional label names (trudgeable / requires-human) used only when hooks are not configured\n- Remove TRUDGER_* environment-variable configuration.\n\nScope:\n- Update ./trudger behavior to be config-driven.\n- Update tests to cover config + hooks.\n- Update docs as needed to explain configuration.\n\nOut of scope:\n- Changing bd or Codex behavior.\n- Changing prompt contents beyond existing $ARGUMENTS substitution.","acceptance_criteria":"- Config file: trudger reads ~/.config/trudger.yml on startup; if missing, prints a warning and continues with defaults.\n- No env config: TRUDGER_* environment variables are not used for configuration.\n- Task selection: uses configured next-task command (first whitespace-delimited token of stdout) or defaults to bd ready selection with optional trudgeable filtering.\n- Codex invocation: uses configured Codex command line for solve, and the same with `resume --last` for review.\n- Hooks: if configured, executes hooks as `<command> <task_id> <extra args...>` for completed and requires-human outcomes.\n- Labels optional: trudgeable/requires-human labels are configurable and optional; default label behavior applies only when hooks are not configured.\n- Verification: after review, trudger exits non-zero if neither closed nor requires-human condition is detected.\n- Validation: `bats tests/trudger_test.bats` passes; `openspec validate add-trudger-config --strict --no-interactive` passes.","status":"closed","priority":2,"issue_type":"epic","owner":"mwotton@gmail.com","created_at":"2026-01-27T09:26:35.595618681Z","created_by":"Mark Wotton","updated_at":"2026-01-27T10:00:18.545671438Z","closed_at":"2026-01-27T10:00:18.545671438Z","close_reason":"Closed","source_repo":".","compaction_level":0,"labels":["trudgeable"]}
{"id":"tr-131.1","title":"Load ~/.config/trudger.yml + defaults","description":"OpenSpec refs:\n- openspec/changes/add-trudger-config/specs/trudger/spec.md\n  - Requirement: Trudger configuration file\n    - Scenario: Config missing\n    - Scenario: Env vars ignored\n\nWork:\n- Define config keys + defaults needed to drive trudger behavior (Codex command, next-task command, hooks, labels, review loop limit, log path).\n- Implement reading ~/.config/trudger.yml at startup; if missing, emit a warning (stderr) and continue with defaults.\n- Implement YAML parsing sufficient for the chosen schema.\n\nExpected outputs:\n- ./trudger loads config and exposes values to the rest of the script.\n- Missing config produces a clear warning without failing.\n\nValidation/tests:\n- Add bats coverage for missing config warning + default behavior.\n\nSuccess:\n- `trudger` runs with no config (warns once) and preserves default behavior.","acceptance_criteria":"- Config loader exists and is used by ./trudger.\n- Missing ~/.config/trudger.yml prints a warning but exits 0 when no tasks.\n- Tests demonstrate warning + defaults.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-27T09:26:35.637292067Z","created_by":"Mark Wotton","updated_at":"2026-01-28T02:26:17.660059069Z","closed_at":"2026-01-28T02:26:17.660059069Z","close_reason":"Completed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-131.1","depends_on_id":"tr-131","type":"parent-child","created_at":"2026-01-27T09:26:35.638996521Z","created_by":"Mark Wotton","metadata":"","thread_id":""}]}
{"id":"tr-131.2","title":"Remove TRUDGER_* configuration env vars","description":"OpenSpec refs:\n- openspec/changes/add-trudger-config/specs/trudger/spec.md\n  - Requirement: Trudger configuration file\n    - Scenario: Env vars ignored\n\nWork:\n- Remove TRUDGER_LOG / TRUDGER_NEXT_CMD / TRUDGER_REVIEW_LOOPS (and any other TRUDGER_* config) as configuration inputs.\n- Ensure any remaining TRUDGER_* values are internal-only state, not user config.\n\nExpected outputs:\n- ./trudger behavior is driven by config file defaults/values, not TRUDGER_* env vars.\n\nValidation/tests:\n- Add a bats test that sets TRUDGER_NEXT_CMD/TRUDGER_REVIEW_LOOPS and verifies behavior does not change unless config changes.\n\nSuccess:\n- Env vars no longer affect configuration.","acceptance_criteria":"- No TRUDGER_* env vars are read for configuration.\n- Tests cover at least one env var being ignored.","notes":"2026-01-28: Updated bats env-var test to set TRUDGER_REVIEW_LOOPS=0 alongside TRUDGER_NEXT_CMD; verified config ignores env vars. Ran: bats tests/trudger_test.bats, shellcheck trudger tests/fixtures/bin/*.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-27T09:26:35.692454937Z","created_by":"Mark Wotton","updated_at":"2026-01-28T02:44:21.885636925Z","closed_at":"2026-01-28T02:44:21.885636925Z","close_reason":"Completed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-131.2","depends_on_id":"tr-131","type":"parent-child","created_at":"2026-01-27T09:26:35.694228582Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-131.2","depends_on_id":"tr-131.1","type":"blocks","created_at":"2026-01-27T09:26:35.696546147Z","created_by":"Mark Wotton","metadata":"","thread_id":""}]}
{"id":"tr-131.3","title":"Configure Codex invocation via config","description":"OpenSpec refs:\n- openspec/changes/add-trudger-config/specs/trudger/spec.md\n  - Requirement: Codex prompt execution\n    - Scenario: Configured Codex command\n\nWork:\n- Read `codex_command` from config.\n- Use it for the solve step, and use the same command line with `resume --last` appended for the review step.\n\nExpected outputs:\n- ./trudger invokes Codex via the configured command string for both solve and review.\n\nValidation/tests:\n- Add bats coverage asserting the configured codex command is used (fixture codex log).\n\nSuccess:\n- Codex invocations match the configured command line for both phases.","acceptance_criteria":"- Configurable `codex_command` drives solve + review invocations.\n- Tests assert the command used.","notes":"2026-01-28: Verified codex_command from config drives solve and review (appends resume --last). Ran: bats tests/trudger_test.bats; TRUDGER_TEST_RUN_CODEX=1 bats -f 'uses configured codex command for solve and review' tests/trudger_test.bats; shellcheck trudger tests/fixtures/bin/*.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-27T09:26:35.750301428Z","created_by":"Mark Wotton","updated_at":"2026-01-28T02:58:16.300919686Z","closed_at":"2026-01-28T02:58:16.300919686Z","close_reason":"Completed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-131.3","depends_on_id":"tr-131","type":"parent-child","created_at":"2026-01-27T09:26:35.751906268Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-131.3","depends_on_id":"tr-131.1","type":"blocks","created_at":"2026-01-27T09:26:35.754284489Z","created_by":"Mark Wotton","metadata":"","thread_id":""}]}
{"id":"tr-131.4","title":"Configure next-task selection via config","description":"OpenSpec refs:\n- openspec/changes/add-trudger-config/specs/trudger/spec.md\n  - Requirement: Task selection\n    - Scenario: Custom next-task command\n\nWork:\n- Read `next_task_command` from config.\n- Execute it to select the next task id, using the first whitespace-delimited token of stdout.\n- If `next_task_command` is not configured, use the default bd-ready query, filtering by the configured trudgeable label when set.\n\nExpected outputs:\n- ./trudger selects tasks using the configured command and parsing rules.\n\nValidation/tests:\n- Add bats coverage for:\n  - Custom command returning an id\n  - Custom command returning empty -> exits 0 (no task)\n  - Default bd selection still works with label filtering\n\nSuccess:\n- Task selection follows config rules and is covered by tests.","acceptance_criteria":"- next-task selection uses `next_task_command` when set, otherwise defaults.\n- Tests cover parsing + fallback behavior.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-27T09:26:35.807784351Z","created_by":"Mark Wotton","updated_at":"2026-01-28T03:15:10.353568707Z","closed_at":"2026-01-28T03:15:10.353568707Z","close_reason":"Completed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-131.4","depends_on_id":"tr-131","type":"parent-child","created_at":"2026-01-27T09:26:35.809509331Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-131.4","depends_on_id":"tr-131.1","type":"blocks","created_at":"2026-01-27T09:26:35.811929987Z","created_by":"Mark Wotton","metadata":"","thread_id":""}]}
{"id":"tr-131.5","title":"Add completion hook (on_completed) + fallback label behavior","description":"OpenSpec refs:\n- openspec/changes/add-trudger-config/specs/trudger/spec.md\n  - Requirement: Task closure on success\n    - Scenario: Completion hook configured\n    - Scenario: No completion hook\n\nWork:\n- Add config for optional completion hook.\n- Execute the hook as `<command> <task_id> <extra args...>` when a task is closed.\n- If no completion hook is configured, remove the configured trudgeable label when it is set.\n\nExpected outputs:\n- ./trudger runs completion hook with task id as first argument.\n- Default label removal occurs only when hook is not configured.\n\nValidation/tests:\n- Add bats coverage using a fixture hook script to assert argv ordering.\n\nSuccess:\n- Closed tasks trigger the hook (or fallback label removal) per config.","acceptance_criteria":"- on_completed hook is invoked as `<cmd> <task_id> <extras>` when configured.\n- Fallback label removal works when hook is absent.\n- Tests cover both paths.","notes":"2026-01-28: Verified on_completed hook runs as <cmd> <task_id> <extras> and skips label removal; fallback label removal works when no hook. Ran: bats tests/trudger_test.bats; TRUDGER_TEST_RUN_CODEX=1 bats tests/trudger_test.bats; shellcheck trudger tests/fixtures/bin/*.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-27T09:26:35.867079473Z","created_by":"Mark Wotton","updated_at":"2026-01-28T03:25:19.055159742Z","closed_at":"2026-01-28T03:25:19.055159742Z","close_reason":"Completed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-131.5","depends_on_id":"tr-131","type":"parent-child","created_at":"2026-01-27T09:26:35.868861189Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-131.5","depends_on_id":"tr-131.1","type":"blocks","created_at":"2026-01-27T09:26:35.871236880Z","created_by":"Mark Wotton","metadata":"","thread_id":""}]}
{"id":"tr-131.6","title":"Add requires-human hook (on_requires_human) + optional labels","description":"OpenSpec refs:\n- openspec/changes/add-trudger-config/specs/trudger/spec.md\n  - Requirement: Requires-human escalation\n    - Scenario: Requires-human hook configured\n    - Scenario: No requires-human hook\n\nWork:\n- Add config for optional requires-human hook.\n- Execute the hook as `<command> <task_id> <extra args...>` when requires-human is detected.\n- If no hook is configured, apply label updates using configured label names (both optional).\n\nExpected outputs:\n- ./trudger can operate with labels disabled (no trudgeable/requires-human labels configured) when hooks are configured.\n\nValidation/tests:\n- Add bats coverage for:\n  - Hook invocation and argv ordering\n  - Label fallback behavior when hook is absent\n  - Behavior when label names are unset/empty\n\nSuccess:\n- Requires-human handling matches the configured hook/label strategy and is tested.","acceptance_criteria":"- on_requires_human hook is invoked as `<cmd> <task_id> <extras>` when configured.\n- Label fallback behavior works when hook is absent.\n- Labels can be disabled via config when hooks are present.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-27T09:26:35.925853480Z","created_by":"Mark Wotton","updated_at":"2026-01-28T03:31:59.775714186Z","closed_at":"2026-01-28T03:31:59.775714186Z","close_reason":"Completed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-131.6","depends_on_id":"tr-131","type":"parent-child","created_at":"2026-01-27T09:26:35.927792355Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-131.6","depends_on_id":"tr-131.1","type":"blocks","created_at":"2026-01-27T09:26:35.930450739Z","created_by":"Mark Wotton","metadata":"","thread_id":""}]}
{"id":"tr-131.7","title":"Update bats tests for config-driven behavior","description":"OpenSpec refs:\n- openspec/changes/add-trudger-config/specs/trudger/spec.md\n  - Requirement: Trudger configuration file (scenarios: Config missing, Env vars ignored)\n  - Requirement: Task selection (scenario: Custom next-task command)\n  - Requirement: Codex prompt execution (scenario: Configured Codex command)\n  - Requirement: Task closure on success (scenarios: Completion hook configured / No completion hook)\n  - Requirement: Requires-human escalation (scenarios: Requires-human hook configured / No requires-human hook)\n  - Requirement: Codex update verification (scenario: Missing update is an error)\n\nWork:\n- Update `tests/trudger_test.bats` and fixtures to use config file instead of TRUDGER_* env vars.\n- Add new fixtures/scripts as needed to assert hook argv ordering and next-task command behavior.\n\nExpected outputs:\n- New/updated bats tests covering config loading, codex command, task selection, hooks, and verification.\n\nValidation/tests:\n- `bats tests/trudger_test.bats`\n\nSuccess:\n- Test suite passes and covers the new config-driven acceptance criteria.","acceptance_criteria":"- Bats tests updated/added to cover config + hooks.\n- All tests pass locally.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-27T09:26:35.984747492Z","created_by":"Mark Wotton","updated_at":"2026-01-28T03:36:57.719086798Z","closed_at":"2026-01-28T03:36:57.719086798Z","close_reason":"Completed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-131.7","depends_on_id":"tr-131","type":"parent-child","created_at":"2026-01-27T09:26:35.986638153Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-131.7","depends_on_id":"tr-131.2","type":"blocks","created_at":"2026-01-27T09:26:35.989317341Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-131.7","depends_on_id":"tr-131.3","type":"blocks","created_at":"2026-01-27T09:26:35.991873342Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-131.7","depends_on_id":"tr-131.4","type":"blocks","created_at":"2026-01-27T09:26:35.994566446Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-131.7","depends_on_id":"tr-131.5","type":"blocks","created_at":"2026-01-27T09:26:35.997203746Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-131.7","depends_on_id":"tr-131.6","type":"blocks","created_at":"2026-01-27T09:26:35.999708932Z","created_by":"Mark Wotton","metadata":"","thread_id":""}]}
{"id":"tr-131.8","title":"Run quality gates + update docs","description":"OpenSpec refs:\n- openspec/changes/add-trudger-config/specs/trudger/spec.md\n  - Requirement: Trudger configuration file\n\nWork:\n- Update README/install guidance to document ~/.config/trudger.yml and available config keys.\n- Run validation commands and record results in the PR/notes.\n\nExpected outputs:\n- Docs clearly describe configuration and defaults.\n\nValidation/tests:\n- `openspec validate add-trudger-config --strict --no-interactive`\n- `bats tests/trudger_test.bats`\n\nSuccess:\n- Validation passes; docs match implemented behavior.","acceptance_criteria":"- Docs updated to describe config and defaults.\n- openspec + bats validation passes.","notes":"Validation:\\n- openspec validate add-trudger-config --strict --no-interactive (pass)\\n- bats tests/trudger_test.bats (pass)","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-27T09:26:36.054519306Z","created_by":"Mark Wotton","updated_at":"2026-01-28T03:41:19.360356219Z","closed_at":"2026-01-28T03:41:19.360356219Z","close_reason":"Completed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-131.8","depends_on_id":"tr-131","type":"parent-child","created_at":"2026-01-27T09:26:36.056245843Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-131.8","depends_on_id":"tr-131.7","type":"blocks","created_at":"2026-01-27T09:26:36.058726235Z","created_by":"Mark Wotton","metadata":"","thread_id":""}]}
{"id":"tr-140","title":"Consolidate specs and update trudger purpose section","description":"OpenSpec refs:\n- Requirement: Configuration loading/validation/parsing/unknown keys\n- Requirement: Hook execution semantics\n- Requirement: Task selection, review hooks, and status verification\n\nExpected outputs:\n- Remove duplicate spec copies under completed changes; keep a single canonical spec source.\n- Update `openspec/specs/trudger/spec.md` Purpose section to describe the generic task system (with br/bd as examples), removing label-specific language.\n- Ensure canonical spec reflects the added/modified requirements from this change.\n\nValidation/tests:\n- `openspec validate refactor-trudger-config-and-docs --strict --no-interactive` should pass once all spec/docs updates are done.\n\nSuccess criteria:\n- Spec sources are consolidated and purpose text matches the current system behavior.\n\nNotes:\n- This task is blocked on archiving `add-trudger-config-flag` (per change proposal dependency).","acceptance_criteria":"Acceptance criteria: (1) Duplicate spec copies under completed changes are removed. (2) Purpose section is updated to describe the generic task system. (3) Canonical spec still contains the added/modified requirements for this change.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T05:26:50.124425450Z","created_by":"mark","updated_at":"2026-01-29T09:19:35.934116782Z","closed_at":"2026-01-29T09:19:35.934046891Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-140","depends_on_id":"tr-2mc","type":"parent-child","created_at":"2026-01-29T05:26:50.149750531Z","created_by":"mark"}]}
{"id":"tr-1bh","title":"Rust core task loop (no re-exec)","description":"OpenSpec refs:\n- openspec/changes/refactor-trudger-rust-native/specs/trudger/spec.md Requirement: Rust in-process loop (Scenario: No re-exec between tasks)\n- openspec/specs/trudger/spec.md Requirement: Task selection (Scenarios: No selectable tasks; Task not ready is skipped)\n- openspec/specs/trudger/spec.md Requirement: Agent prompt execution (Scenario: solve + review)\n- openspec/specs/trudger/spec.md Requirement: Task show output handling (Scenario: Show output is prompt-only)\n- openspec/specs/trudger/spec.md Requirement: Agent update verification (Scenario: Missing status after review)\n\nWork:\n- Implement the outer task loop in Rust without re-exec.\n- Execute commands.next_task, commands.task_status, commands.task_update_in_progress, commands.task_show per config.\n- Run agent solve and review prompts using `agent_command` and `agent_review_command`; provide task context via `TRUDGER_*` env vars; treat task_show output as prompt-only.\n- Enforce task status checks after review and skip-not-ready logic with TRUDGER_SKIP_NOT_READY_LIMIT semantics.\n\nExpected outputs:\n- Rust implementation processes tasks one per iteration and idles/exits correctly.\n\nValidation/tests:\n- Integration tests for next_task exit=1 => exit 0, skip-not-ready behavior, prompt handling via env vars, and missing-status error.","acceptance_criteria":"1. Rust implementation uses an in-process loop without re-exec between tasks. (OpenSpec: Rust in-process loop scenario.)\n2. commands.next_task exit=1 results in exit 0 with no work; empty output treated as no task. (OpenSpec: Task selection scenario.)\n3. Task not ready is skipped with retry up to TRUDGER_SKIP_NOT_READY_LIMIT. (OpenSpec: Task selection scenario.)\n4. Agent solve + review use `agent_command` and `agent_review_command`, with task context via `TRUDGER_*` env vars; task_show output is not parsed for control flow. (OpenSpec: Agent prompt execution + Task show output handling scenarios.)\n5. Missing status after review yields non-zero error. (OpenSpec: Agent update verification scenario.)\n6. Integration tests cover next_task exit handling, skip-not-ready, env var prompt handling, and missing-status error.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T04:43:34.015518897Z","created_by":"mark","updated_at":"2026-02-05T02:55:01.568931579Z","closed_at":"2026-02-05T02:55:01.568914818Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1bh","depends_on_id":"tr-3j8","type":"parent-child","created_at":"2026-02-04T04:43:34.019612475Z","created_by":"mark"},{"issue_id":"tr-1bh","depends_on_id":"tr-7vm","type":"blocks","created_at":"2026-02-04T04:43:34.021194198Z","created_by":"mark"}]}
{"id":"tr-1bt","title":"Route ERR trap through quit path","description":"OpenSpec refs:\n- openspec/specs/trudger/spec.md Requirement: Error exit logging\n  - Scenario: Unhandled error triggers quit\n\nExpected outputs:\n- ERR trap exits via quit path (no quit log without exit).\n- Quit logging is consistent between explicit exits and unhandled errors.\n\nValidation/tests:\n- Add bats coverage that forces an ERR trap path by making commands.task_status or commands.task_show fail.\n- Assert non-zero exit + quit reason logged.\n- bats tests/trudger_test.bats\n\nAcceptance criteria:\n- A failing commands.task_status or commands.task_show triggers the ERR trap and non-zero exit.\n- A quit reason log entry is emitted only when the script exits.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-31T05:32:43.965561298Z","created_by":"mark","updated_at":"2026-02-05T00:55:54.261747490Z","closed_at":"2026-02-05T00:55:54.261731237Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1bt","depends_on_id":"tr-2v7","type":"parent-child","created_at":"2026-01-31T05:32:43.970075426Z","created_by":"mark"}]}
{"id":"tr-1cs","title":"Refactor Trudger command contract (env vars + review command)","description":"OpenSpec change: openspec/changes/refactor-trudger-command-contract.\\n\\nGoals:\\n- Move task context to TRUDGER_* env vars (no positional task args).\\n- Remove / prompt substitution; pass prompt content via TRUDGER_PROMPT/TRUDGER_REVIEW_PROMPT.\\n- Require agent_review_command separate from agent_command.\\n- Rename Codex-specific requirements to agent-neutral wording.\\n\\nScope:\\n- Shell + Rust implementations, config parsing/validation, docs, sample configs, and tests.","acceptance_criteria":"1. Commands and hooks receive task context via TRUDGER_* env vars with no positional task args. (OpenSpec: Command execution environment scenario.)\n2. Config validation requires agent_command and agent_review_command; codex_command is rejected. (OpenSpec: Configuration validation requirement.)\n3. Agent solve + review use agent_command/agent_review_command with the relevant prompt env var set (TRUDGER_PROMPT for solve, TRUDGER_REVIEW_PROMPT for review) and no prompt substitution. (OpenSpec: Agent prompt execution scenarios.)\n4. Task show output is provided via TRUDGER_TASK_SHOW without parsing. (OpenSpec: Task show output handling scenario.)\n5. Hooks execute with TRUDGER_TASK_ID and other context via env vars (no positional args). (OpenSpec: Hook execution semantics scenario.)\n6. Post-review status verification remains enforced. (OpenSpec: Agent update verification scenario.)\n7. Validation runs: bats tests + openspec validate refactor-trudger-command-contract --strict --no-interactive.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-02-04T06:06:46.799230534Z","created_by":"mark","updated_at":"2026-02-05T01:25:03.174871576Z","closed_at":"2026-02-05T01:25:03.174854175Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-1dl","title":"Wizard: Generate Trudger Config From Embedded Templates","description":"OpenSpec change: openspec/changes/add-trudger-config-wizard/\n\nGoal\n- Implement `trudger wizard` to generate a valid Trudger config (agent + tracking templates) and safely overwrite existing configs with a timestamped backup.\n\nScope\n- New `config_templates/` data files (agents/tracking/defaults) embedded into the binary at build time.\n- Interactive-only wizard (stdin/stdout must be TTY).\n- Safe reruns: per-key diff prompts (default keep current), preserve existing `review_loop_limit`/`log_path`, comment out unknown keys, and handle invalid existing YAML by warning + backup + overwrite (no merge).\n- Update missing-config bootstrap messaging to instruct running `trudger wizard` (and mention `--config PATH`).\n- Update docs/help and add tests.\n\nOut of scope\n- Full-screen TUI.\n- Arbitrary YAML editor.\n- Auto-migrating unknown custom structures beyond comment-out.\n\nAcceptance Criteria\n- All scenarios in openspec/changes/add-trudger-config-wizard/specs/trudger/spec.md are satisfied (wizard command, template embedding, required templates, defaults behavior, per-key merge prompts, unknown key comment-out, invalid YAML overwrite w/ backup, validation failure prevents write, config-loading messaging).\n- Quality gates: `cargo fmt`, `cargo clippy`, `cargo test` pass.\n- Spec gate: `openspec validate add-trudger-config-wizard --strict --no-interactive` passes.","notes":"Acceptance criteria verified on current HEAD:\\n- cargo fmt --check: pass\\n- cargo clippy --all-targets -- -D warnings: pass\\n- cargo test: pass\\n- openspec validate add-trudger-config-wizard --strict --no-interactive: pass\\n- OpenSpec change checklist (openspec/changes/add-trudger-config-wizard/tasks.md): all [x]\\n\\nReady for review/close.","status":"closed","priority":3,"issue_type":"epic","created_at":"2026-02-06T23:00:08.854974468Z","created_by":"mark","updated_at":"2026-02-07T03:37:21.063004859Z","closed_at":"2026-02-07T03:37:21.062988425Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-1dl.1","title":"Wizard Templates: Add config_templates Data Files","description":"OpenSpec refs\n- openspec/changes/add-trudger-config-wizard/specs/trudger/spec.md\n  - Requirement: Wizard template sources (Scenario: Templates are embedded)\n  - Requirement: Wizard template availability (Scenario: Required templates are available)\n  - Requirement: Wizard default values (Scenario: Defaults are applied when missing)\n\nWork\n- Add `config_templates/agents/*.yml` for ids: `codex`, `claude`, `pi`.\n- Add `config_templates/tracking/*.yml` for ids: `br-next-task`, `bd-labels`.\n- Add `config_templates/defaults.yml` with `review_loop_limit` and `log_path` defaults.\n- Ensure tracking templates include `hooks.on_doctor_setup` default (doctor-ready config).\n- Ensure template command strings are compatible with Trudgerâ€™s command contract (use `` where Trudger passes args).\n\nExpected outputs\n- New `config_templates/` directory and template YAML files committed.\n\nAcceptance criteria\n- The required template ids exist and contain the required fields described in openspec/changes/add-trudger-config-wizard/design.md.\n- `br-next-task` tracking template uses `commands.task_update_in_progress` that accepts args (``) so Trudger can set statuses.\n- Templates include `hooks.on_doctor_setup` so `trudger doctor` can be configured from wizard output.\n\nValidation\n- `openspec validate add-trudger-config-wizard --strict --no-interactive`","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-06T23:00:08.942321832Z","created_by":"mark","updated_at":"2026-02-06T23:05:40.941130483Z","closed_at":"2026-02-06T23:05:40.941113480Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1dl.1","depends_on_id":"tr-1dl","type":"parent-child","created_at":"2026-02-06T23:00:08.942321832Z","created_by":"mark"}]}
{"id":"tr-1dl.2","title":"Wizard Templates: Embed + Loader + Required-Template Validation","description":"OpenSpec refs\n- openspec/changes/add-trudger-config-wizard/specs/trudger/spec.md\n  - Requirement: Wizard template sources (Scenario: Templates are embedded)\n  - Requirement: Wizard template availability (Scenario: Required templates are available)\n\nWork\n- Embed `config_templates/**` into the Rust binary at build time (no runtime file reads).\n- Implement a loader that parses embedded YAML into typed template structs.\n- Validate required template ids exist (agent: `codex`, `claude`, `pi`; tracking: `br-next-task`, `bd-labels`; defaults present) and error clearly if missing.\n\nExpected outputs\n- New Rust module(s) for template loading/validation.\n- Unit tests that assert required templates exist and parse.\n\nAcceptance criteria\n- Running wizard code path can list required templates without reading external files.\n- Missing required template ids produces a clear, actionable error.\n\nValidation\n- `cargo test`\n- `openspec validate add-trudger-config-wizard --strict --no-interactive`","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-06T23:00:08.989583808Z","created_by":"mark","updated_at":"2026-02-07T01:58:00.594534050Z","closed_at":"2026-02-07T01:58:00.594458583Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1dl.2","depends_on_id":"tr-1dl","type":"parent-child","created_at":"2026-02-06T23:00:08.989583808Z","created_by":"mark"},{"issue_id":"tr-1dl.2","depends_on_id":"tr-1dl.1","type":"blocks","created_at":"2026-02-06T23:00:08.989583808Z","created_by":"mark"}]}
{"id":"tr-1dl.3","title":"Wizard: CLI + TTY Enforcement + Baseline Generate/Validate/Write","description":"OpenSpec refs\n- openspec/changes/add-trudger-config-wizard/specs/trudger/spec.md\n  - Requirement: Configuration wizard\n    - Scenario: Wizard writes config\n    - Scenario: Wizard creates parent directory\n    - Scenario: Wizard requires interactive terminal\n  - Requirement: Wizard default values\n    - Scenario: Defaults are applied when missing\n  - Requirement: Wizard output validation\n    - Scenario: Validation failure prevents write\n  - Requirement: Invalid existing config is overwritten with backup\n    - Scenario: Invalid existing config is overwritten\n\nWork\n- Add `trudger wizard` CLI path.\n- Enforce interactive-only: if stdin or stdout is not a TTY, exit non-zero with clear error.\n- Resolve target config path (default `~/.config/trudger.yml`, or `--config PATH`).\n- Load embedded templates + defaults.\n- Prompt for agent + tracking template selection.\n- Assemble candidate config.\n  - Apply embedded defaults for `review_loop_limit`/`log_path` when missing.\n- Validate generated config using existing config parsing + validation rules.\n  - If validation fails: do not write and do not create a backup.\n- Ensure parent dir exists.\n- Write config to target path.\n  - If target exists: create timestamped backup then overwrite (atomic write preferred).\n  - If target exists but is invalid YAML: warn and overwrite with backup (no merge behavior yet).\n\nExpected outputs\n- New wizard code path reachable via `trudger wizard`.\n- Generated config file is valid and doctor-ready.\n\nAcceptance criteria\n- Non-TTY invocation fails with a clear error (per scenario).\n- Validation failure prevents any write/backup.\n- Overwrite creates a timestamped backup.\n- Invalid-YAML existing config produces a warning, then backup + overwrite.\n\nValidation\n- `cargo test`\n- `openspec validate add-trudger-config-wizard --strict --no-interactive`","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-06T23:00:09.023033162Z","created_by":"mark","updated_at":"2026-02-07T02:12:54.708894437Z","closed_at":"2026-02-07T02:12:54.708877699Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1dl.3","depends_on_id":"tr-1dl","type":"parent-child","created_at":"2026-02-06T23:00:09.023033162Z","created_by":"mark"},{"issue_id":"tr-1dl.3","depends_on_id":"tr-1dl.2","type":"blocks","created_at":"2026-02-06T23:00:09.023033162Z","created_by":"mark"}]}
{"id":"tr-1dl.4","title":"Wizard: Rerun Support (Preselect + Per-Key Merge Prompts, Default Keep)","description":"OpenSpec refs\n- openspec/changes/add-trudger-config-wizard/specs/trudger/spec.md\n  - Requirement: Wizard per-key replacement prompts\n    - Scenario: Per-key diff and replacement\n  - Requirement: Wizard default values\n    - Scenario: Existing values are preserved\n\nWork\n- When an existing config parses as YAML:\n  - Preselect best-matching agent/tracking templates.\n  - Compare candidate vs existing for known template-driven keys:\n    - `agent_command`, `agent_review_command`\n    - `commands.*` (next_task, task_show, task_status, task_update_in_progress, reset_task)\n    - `hooks.*` (on_completed, on_requires_human, on_doctor_setup)\n  - For each differing known key: show current vs proposed and prompt keep/replace.\n  - Default choice is keep current.\n- Preserve existing `review_loop_limit`/`log_path` without prompting (apply embedded defaults only when missing).\n\nExpected outputs\n- Wizard reruns are safe: it does not silently clobber values.\n\nAcceptance criteria\n- Per-key prompts appear only for known keys that differ.\n- Default action is keep-current.\n- `hooks.on_doctor_setup` participates in the merge prompts.\n\nValidation\n- `cargo test` (add tests around merge decisions)\n- `openspec validate add-trudger-config-wizard --strict --no-interactive`","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-06T23:00:09.075181105Z","created_by":"mark","updated_at":"2026-02-07T02:45:42.929947050Z","closed_at":"2026-02-07T02:45:42.929928771Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1dl.4","depends_on_id":"tr-1dl","type":"parent-child","created_at":"2026-02-06T23:00:09.075181105Z","created_by":"mark"},{"issue_id":"tr-1dl.4","depends_on_id":"tr-1dl.3","type":"blocks","created_at":"2026-02-06T23:00:09.075181105Z","created_by":"mark"}]}
{"id":"tr-1dl.5","title":"Wizard: Preserve Unknown Keys as Commented YAML (Top-Level + commands/hooks)","description":"OpenSpec refs\n- openspec/changes/add-trudger-config-wizard/specs/trudger/spec.md\n  - Requirement: Unknown/custom keys are commented out\n    - Scenario: Unknown keys preserved as comments\n\nWork\n- When an existing config parses as YAML, detect unknown/custom keys:\n  - At top-level.\n  - Under `commands` and `hooks`.\n- Append them to the output as commented YAML with a clear warning header.\n- Emit a warning to stderr that unknown keys were commented out.\n\nExpected outputs\n- Output config retains unknown/custom keys as comments so users can restore them manually.\n\nAcceptance criteria\n- Unknown keys (including nested under `commands`/`hooks`) are preserved as commented YAML.\n- Wizard prints an explicit warning when it comments keys.\n\nValidation\n- `cargo test`","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-06T23:00:09.137194638Z","created_by":"mark","updated_at":"2026-02-07T02:59:14.196217674Z","closed_at":"2026-02-07T02:59:14.196201016Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1dl.5","depends_on_id":"tr-1dl","type":"parent-child","created_at":"2026-02-06T23:00:09.137194638Z","created_by":"mark"},{"issue_id":"tr-1dl.5","depends_on_id":"tr-1dl.3","type":"blocks","created_at":"2026-02-06T23:00:09.137194638Z","created_by":"mark"}]}
{"id":"tr-1dl.6","title":"Bootstrap + Docs: Point Missing-Config Messaging and README/help to Wizard","description":"OpenSpec refs\n- openspec/changes/add-trudger-config-wizard/specs/trudger/spec.md\n  - Requirement: Configuration loading\n    - Scenario: Missing default config prints wizard instructions\n    - Scenario: Missing explicit config prints missing-path error\n\nWork\n- Update missing-config bootstrap messaging to instruct `trudger wizard`.\n  - Mention `trudger wizard --config PATH` for non-default config paths.\n- Preserve behavior for missing explicit `--config PATH`: error includes PATH.\n- Update `README.md` and `trudger --help` output to document wizard.\n- Remove sample-config bootstrap references (curl commands) from docs.\n\nExpected outputs\n- Updated docs and user-facing error/help messages.\n\nAcceptance criteria\n- Missing default config instructs using `trudger wizard`.\n- Missing explicit config prints a missing-path error including the path.\n\nValidation\n- `cargo test`\n- `openspec validate add-trudger-config-wizard --strict --no-interactive`","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-06T23:00:09.176046144Z","created_by":"mark","updated_at":"2026-02-07T03:12:24.118527273Z","closed_at":"2026-02-07T03:12:24.118454264Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1dl.6","depends_on_id":"tr-1dl","type":"parent-child","created_at":"2026-02-06T23:00:09.176046144Z","created_by":"mark"},{"issue_id":"tr-1dl.6","depends_on_id":"tr-1dl.3","type":"blocks","created_at":"2026-02-06T23:00:09.176046144Z","created_by":"mark"}]}
{"id":"tr-1dl.7","title":"Tests: Wizard Coverage (TTY, Defaults, Merge Prompts, Unknown Keys, Backup, Invalid YAML)","description":"OpenSpec refs\n- openspec/changes/add-trudger-config-wizard/specs/trudger/spec.md\n  - All wizard scenarios, especially:\n    - Wizard requires interactive terminal\n    - Wizard writes config / creates parent directory\n    - Defaults when missing; preserve existing values\n    - Per-key diff prompts (default keep)\n    - Unknown keys commented out\n    - Invalid YAML overwrite with backup + warning\n    - Validation failure prevents write\n\nWork\n- Add tests for wizard behavior:\n  - Non-TTY invocation fails with clear error.\n  - Successful run writes config and creates parent dir.\n  - Backup created on overwrite.\n  - Invalid YAML existing config warns + backup + overwrite.\n  - Merge prompts default keep-current.\n  - Unknown keys are preserved as commented YAML.\n- Prefer integration-style tests that can drive interactive prompts (PTY-based) where needed.\n\nAcceptance criteria\n- Tests cover each OpenSpec scenario above and fail reliably when behavior regresses.\n\nValidation\n- `cargo test`","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-06T23:00:09.213742897Z","created_by":"mark","updated_at":"2026-02-07T03:24:03.871387578Z","closed_at":"2026-02-07T03:24:03.871371159Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1dl.7","depends_on_id":"tr-1dl","type":"parent-child","created_at":"2026-02-06T23:00:09.213742897Z","created_by":"mark"},{"issue_id":"tr-1dl.7","depends_on_id":"tr-1dl.4","type":"blocks","created_at":"2026-02-06T23:00:09.213742897Z","created_by":"mark"},{"issue_id":"tr-1dl.7","depends_on_id":"tr-1dl.5","type":"blocks","created_at":"2026-02-06T23:00:09.213742897Z","created_by":"mark"}]}
{"id":"tr-1dl.8","title":"Finalize: Quality Gates + OpenSpec Validation + Mark Change Tasks Complete","description":"OpenSpec refs\n- openspec/changes/add-trudger-config-wizard/tasks.md (complete all checkboxes)\n- openspec/changes/add-trudger-config-wizard/specs/trudger/spec.md (all scenarios)\n\nWork\n- Ensure `cargo fmt`, `cargo clippy`, `cargo test` pass.\n- Run `openspec validate add-trudger-config-wizard --strict --no-interactive`.\n- Update openspec/changes/add-trudger-config-wizard/tasks.md checkboxes to reflect completed work.\n\nAcceptance criteria\n- All quality gates pass.\n- OpenSpec validation passes.\n- OpenSpec change task checklist matches reality.\n\nValidation\n- `cargo fmt`\n- `cargo clippy`\n- `cargo test`\n- `openspec validate add-trudger-config-wizard --strict --no-interactive`","notes":"Completed validation gates: cargo fmt --check, cargo clippy --all-targets -- -D warnings, cargo test, openspec validate add-trudger-config-wizard --strict --no-interactive. Updated OpenSpec change checklist to all [x].\\n\\nCommits: a7c00d6 (tasks.md), ae9d244 (beads status update).","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-06T23:00:09.251086602Z","created_by":"mark","updated_at":"2026-02-07T03:32:07.910646262Z","closed_at":"2026-02-07T03:32:07.910629018Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1dl.8","depends_on_id":"tr-1dl","type":"parent-child","created_at":"2026-02-06T23:00:09.251086602Z","created_by":"mark"},{"issue_id":"tr-1dl.8","depends_on_id":"tr-1dl.6","type":"blocks","created_at":"2026-02-06T23:00:09.251086602Z","created_by":"mark"},{"issue_id":"tr-1dl.8","depends_on_id":"tr-1dl.7","type":"blocks","created_at":"2026-02-06T23:00:09.251086602Z","created_by":"mark"}]}
{"id":"tr-1e1","title":"Test sample configs with br","description":"Add coverage for both sample configs, including robot-triage using bv stub, and ensure br workflow works in tests.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-28T13:21:40.335760004Z","created_by":"mark","updated_at":"2026-01-28T13:22:30.666716310Z","closed_at":"2026-01-28T13:22:30.666653281Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-1e5","title":"Investigate --robot-next selecting in_progress task","description":"Running ../trudger/trudger from /home/mark/lambdalabs/tooltest returns: 'Task tooltest-ev5 is not ready (status: in_progress)'. Expected robot-next to avoid in_progress tasks; investigate config or trudger selection logic.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T02:16:58.269747706Z","created_by":"mark","updated_at":"2026-01-29T03:52:28.331064395Z","closed_at":"2026-01-29T03:52:28.331019276Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-1g8","title":"Execute config commands without eval; evaluate shell at execution time","description":"Replace eval-based parsing with safer execution; ensure shell syntax is handled at execution time; document behavior.","acceptance_criteria":"Criteria: all configured commands execute via bash -lc at runtime (no eval/argv parsing); task id passed as $1 with extra args appended; shell constructs are supported; docs describe bash -lc execution.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-30T02:50:13.442722398Z","created_by":"mark","updated_at":"2026-01-30T07:47:02.167411464Z","closed_at":"2026-01-30T07:47:02.167366719Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1g8","depends_on_id":"tr-1xw","type":"blocks","created_at":"2026-01-30T02:50:13.855706673Z","created_by":"mark"},{"issue_id":"tr-1g8","depends_on_id":"tr-26e","type":"parent-child","created_at":"2026-01-30T02:50:13.448458399Z","created_by":"mark"}]}
{"id":"tr-1hl","title":"Ensure sample configuration files are present","description":"OpenSpec refs:\n- Requirement: Sample config files â€” Scenario: sample configs available in repo\n\nExpected outputs:\n- `sample_configuration/trudgeable-with-hooks.yml` exists (legacy/default behavior).\n- `sample_configuration/robot-triage.yml` exists (`bv --robot-triage` task selection).\n\nValidation/tests:\n- Repository contents verified (manual or via test fixture references).\n\nSuccess criteria:\n- Both sample config files are present and usable for copy/adaptation.","acceptance_criteria":"Acceptance criteria: (1) sample_configuration/trudgeable-with-hooks.yml exists in the repo. (2) sample_configuration/robot-triage.yml exists in the repo.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T06:05:15.132814137Z","created_by":"mark","updated_at":"2026-01-29T10:11:13.785284184Z","closed_at":"2026-01-29T10:11:13.785239433Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1hl","depends_on_id":"tr-jyr","type":"parent-child","created_at":"2026-01-29T06:05:15.162082088Z","created_by":"mark"}]}
{"id":"tr-1i0","title":"TaskId: replace String error with a typed TaskIdError","notes":"Blocker for review: no TaskIdError implementation found. Current state: TaskId TryFrom uses Error=String in src/task_types.rs; no TaskIdError type in src/tests; unit tests still assert on String contents (see src/unit_tests.rs task_id_*). Ran: cargo test task_id_ (passes). Need: confirm where the solve changes are, or proceed with implementing typed TaskIdError + updating call sites/tests.","status":"closed","priority":2,"issue_type":"task","assignee":"mark","created_at":"2026-02-09T01:25:32.698642627Z","created_by":"mark","updated_at":"2026-02-09T02:29:28.847107905Z","closed_at":"2026-02-09T02:29:28.847091154Z","close_reason":"Implemented TaskIdError and updated tests to assert on variants.","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":6,"issue_id":"tr-1i0","author":"Mark Wotton","text":"Review: I canâ€™t verify this task as complete in the current workspace. src/task_types.rs still has TaskId::try_from with type Error=String (no TaskIdError), and unit tests assert on substring-matched error strings. Was the TaskIdError implementation landed on another branch/PR, or should I proceed to implement it here?","created_at":"2026-02-09T02:10:58Z"},{"id":7,"issue_id":"tr-1i0","author":"Mark Wotton","text":"Proceeding to implement TaskIdError in this workspace (src/task_types.rs), update TaskId::try_from to return it instead of String, and adjust unit tests to assert on error variants rather than substring matches.","created_at":"2026-02-09T02:27:42Z"}]}
{"id":"tr-1id","title":"Update docs + sample configs for env-var contract","description":"OpenSpec refs:\\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Command execution environment\\n  - Scenario: Command environment provided\\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Hook execution semantics\\n  - Scenario: Hook receives env vars\\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Agent prompt execution (Prompt context via env vars)\\n\\nWork:\\n- Update docs and sample configs for agent_command + agent_review_command.\\n- Document TRUDGER_* env vars and removal of prompt substitution/positional args.\\n\\nExpected outputs:\\n- README and sample_configuration/*.yml reflect new keys and env-var contract.\\n\\nValidation/tests:\\n- Manual doc review for spec alignment.\\n","acceptance_criteria":"1. README documents agent_command + agent_review_command and TRUDGER_* env vars, including TRUDGER_PROMPT/TRUDGER_REVIEW_PROMPT and TRUDGER_TASK_SHOW. (OpenSpec: Command execution environment + Agent prompt execution scenarios.)\n2. sample_configuration/*.yml use agent_command + agent_review_command and do not rely on positional args or prompt substitution.\n3. Manual doc review confirms alignment with the env-var contract.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T06:07:46.671273012Z","created_by":"mark","updated_at":"2026-02-04T10:36:03.531372888Z","closed_at":"2026-02-04T10:36:03.531355775Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1id","depends_on_id":"tr-1cs","type":"parent-child","created_at":"2026-02-04T06:07:46.675628192Z","created_by":"mark"},{"issue_id":"tr-1id","depends_on_id":"tr-vgj","type":"blocks","created_at":"2026-02-04T06:07:46.677557916Z","created_by":"mark"}]}
{"id":"tr-1nf","title":"Rust binary scaffold + startup checks","description":"OpenSpec refs:\n- openspec/changes/refactor-trudger-rust-native/specs/trudger/spec.md Requirement: Rust entrypoint (Scenario: Rust entrypoint is executable)\n- openspec/specs/trudger/spec.md Requirement: Prompt file presence (Scenario: Prompt file missing)\n- openspec/specs/trudger/spec.md Requirement: Configuration loading (Scenario: Missing config file)\n\nWork:\n- Create Cargo crate/binary named 'trudger' (release output target/release/trudger).\n- Implement CLI flags -c/--config and -h/--help consistent with shell behavior.\n- On startup, verify prompt files exist and config path exists (respecting -c); on missing config, emit bootstrap instructions.\n\nExpected outputs:\n- Runnable Rust binary with matching CLI flags and startup checks.\n\nValidation/tests:\n- Manual run shows binary executes and --help prints usage.\n- Missing prompt or config file errors are clear and non-zero.","acceptance_criteria":"1. Cargo binary named 'trudger' builds and runs (release output target/release/trudger).\n2. -c/--config and -h/--help flags behave consistently with shell usage.\n3. Missing prompt file yields a clear error naming the path and non-zero exit. (OpenSpec: Prompt file presence scenario.)\n4. Missing config file yields a clear error naming the path, includes bootstrap instructions for sample configs, and exits non-zero. (OpenSpec: Configuration loading scenario.)\n5. Running the release binary without shell invocation succeeds. (OpenSpec: Rust entrypoint scenario.)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T04:43:01.700377729Z","created_by":"mark","updated_at":"2026-02-04T06:26:55.602317816Z","closed_at":"2026-02-04T06:26:55.602226261Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1nf","depends_on_id":"tr-3j8","type":"parent-child","created_at":"2026-02-04T04:43:01.726396685Z","created_by":"mark"}]}
{"id":"tr-1o1","title":"Shell: guard total TRUDGER_* env payload (not just per-value) to avoid E2BIG","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-09T01:25:32.703249745Z","created_by":"mark","updated_at":"2026-02-09T02:18:05.044477699Z","closed_at":"2026-02-09T02:18:05.044454094Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-1o8","title":"Reset task status on interruption","description":"When a run stops without succeeding or is interrupted, invoke the reset_task command so the task returns to open and we avoid stale in_progress markers. Also update sample configurations to document/enable the reset_task behavior.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-30T03:41:08.539472996Z","created_by":"mark","updated_at":"2026-02-05T01:46:44.409373069Z","closed_at":"2026-02-05T01:46:44.409356829Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-1ru","title":"Docs: clarify notification payload path + task_description extraction","description":"Follow up on notification hook contract improvements:\n- Document TRUDGER_NOTIFY_PAYLOAD_PATH JSON file payload interface (and compatibility env vars).\n- Clarify task_description behavior for JSON task_show output (prefer title/summary fields when present).\n- Consider whether openspec/specs/trudger/spec.md should capture notification hook contract (currently only in completed change).","status":"in_progress","priority":2,"issue_type":"docs","created_at":"2026-02-12T09:12:31.472088500Z","created_by":"mark","updated_at":"2026-02-12T09:29:14.119369816Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-1ta","title":"Align task selection and review hooks with spec","description":"OpenSpec refs:\n- Requirement: Task selection â€” Scenario: No selectable tasks\n- Requirement: Task selection â€” Scenario: Task not ready is skipped\n- Requirement: Task closure on success â€” Scenario: Task closed after successful review\n- Requirement: Requires-human escalation â€” Scenario: Task still open after review\n- Requirement: Codex update verification â€” Scenario: Missing status after review\n\nExpected outputs:\n- `commands.next_task` empty or exit 1 => script exits 0.\n- Not-ready task is skipped and retried up to `TRUDGER_SKIP_NOT_READY_LIMIT` before idling.\n- After review, task status must be non-empty; missing status => non-zero exit.\n- Status closed => run `hooks.on_completed`; otherwise run `hooks.on_requires_human`.\n- One task is processed per outer loop iteration.\n\nValidation/tests:\n- Covered by new/updated BATS cases in the \"Extend tests\" task.\n\nSuccess criteria:\n- Task selection and review hook behavior matches OpenSpec scenarios.","acceptance_criteria":"Acceptance criteria: (1) Empty/exit-1 commands.next_task results in exit status 0. (2) Not-ready tasks are skipped with retries up to TRUDGER_SKIP_NOT_READY_LIMIT. (3) Missing/empty status after review exits non-zero. (4) Closed status triggers hooks.on_completed; non-closed triggers hooks.on_requires_human. (5) Only one task is processed per outer loop iteration.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T05:26:01.798809820Z","created_by":"mark","updated_at":"2026-01-29T08:12:31.296294951Z","closed_at":"2026-01-29T08:12:31.296251276Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1ta","depends_on_id":"tr-2ef","type":"waits-for","created_at":"2026-01-29T05:26:01.829273666Z","created_by":"mark"},{"issue_id":"tr-1ta","depends_on_id":"tr-2mc","type":"parent-child","created_at":"2026-01-29T05:26:01.824145961Z","created_by":"mark"}]}
{"id":"tr-1uo","title":"Run validation and quality gates","description":"OpenSpec refs:\n- openspec/changes/update-trudger-logging-and-parsing/tasks.md steps 1.8-1.10\n\nExpected outputs:\n- shellcheck passes for trudger + test fixtures.\n- bats test suite passes.\n- openspec validate update-trudger-logging-and-parsing passes in strict mode.\n\nValidation/tests:\n- shellcheck trudger tests/trudger_test.bats tests/fixtures/bin/br tests/fixtures/bin/bv tests/fixtures/bin/agent\n- bats tests/trudger_test.bats\n- openspec validate update-trudger-logging-and-parsing --strict --no-interactive\n\nAcceptance criteria:\n- All validation commands succeed with exit code 0.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T05:33:00.013244236Z","created_by":"mark","updated_at":"2026-02-05T01:50:31.191020202Z","closed_at":"2026-02-05T01:50:31.191003396Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-1uo","depends_on_id":"tr-1bt","type":"blocks","created_at":"2026-01-31T05:33:00.062089821Z","created_by":"mark"},{"issue_id":"tr-1uo","depends_on_id":"tr-29x","type":"blocks","created_at":"2026-01-31T05:33:00.057581876Z","created_by":"mark"},{"issue_id":"tr-1uo","depends_on_id":"tr-2v7","type":"parent-child","created_at":"2026-01-31T05:33:00.043840994Z","created_by":"mark"},{"issue_id":"tr-1uo","depends_on_id":"tr-34q","type":"blocks","created_at":"2026-01-31T05:33:00.066196113Z","created_by":"mark"},{"issue_id":"tr-1uo","depends_on_id":"tr-3ay","type":"blocks","created_at":"2026-01-31T05:33:00.053152486Z","created_by":"mark"},{"issue_id":"tr-1uo","depends_on_id":"tr-3ii","type":"blocks","created_at":"2026-01-31T05:33:00.048493633Z","created_by":"mark"}]}
{"id":"tr-1v2","title":"Reconcile OpenSpec change status vs implemented code","status":"closed","priority":4,"issue_type":"task","created_at":"2026-02-06T15:37:29.190829737Z","created_by":"mark","updated_at":"2026-02-06T21:59:00.662457191Z","closed_at":"2026-02-06T21:59:00.662440216Z","close_reason":"Reconciled OpenSpec change/task status with implemented code; marked completed changes complete and fixed doctor closed-status verification.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-1xw","title":"Restore $ARGUMENTS to task id (not task_show JSON)","description":"Pass task id to prompts, update prompts/docs/tests to match, and keep task_show usage internal.","acceptance_criteria":"Criteria: $ARGUMENTS is task id only; prompt embeds task_show output; prompts no longer instruct the agent to run task_show; README/prompt docs updated to match.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-30T02:50:13.348677410Z","created_by":"mark","updated_at":"2026-01-30T06:20:20.233615712Z","closed_at":"2026-01-30T06:20:20.233552092Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["human_required"],"dependencies":[{"issue_id":"tr-1xw","depends_on_id":"tr-26e","type":"parent-child","created_at":"2026-01-30T02:50:13.354523751Z","created_by":"mark"}]}
{"id":"tr-26e","title":"Fix trudger task context, command execution, and logging","description":"Align task context and command execution with env-var contract and agent-agnostic configuration.\n\nNotes (2026-01-30 updated 2026-02-04):\n- Remove $ARGUMENTS and prompt substitution; provide prompt content via TRUDGER_PROMPT/TRUDGER_REVIEW_PROMPT.\n- Task context is provided via TRUDGER_TASK_ID/TRUDGER_TASK_SHOW/TRUDGER_TASK_STATUS/TRUDGER_CONFIG_PATH (no positional task args).\n- Execute all configured commands via bash -lc (no argv parsing).\n- Log full command strings; sanitize only to keep logs intact (no secret redaction).\n- commands.next_task is required when no manual task IDs; if manual IDs provided, missing next_task is a warning only; empty string counts as missing.\n- Use agent_command + agent_review_command (no codex_command).","notes":"Decisions (2026-01-30):\n- $ARGUMENTS is task id only.\n- Trudger embeds task_show output into the prompt body; agents must not fetch task details themselves.\n- Execute all configured commands via bash -lc (no argv parsing).\n- Log full command strings; sanitize only to keep logs intact (no secret redaction).\n- commands.next_task is required when no manual task IDs; if manual IDs provided, missing next_task is a warning only; empty string counts as missing.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-30T02:50:13.248637539Z","created_by":"mark","updated_at":"2026-02-05T04:04:47.434387090Z","closed_at":"2026-02-05T04:04:47.434368874Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-29x","title":"Standardize logging semantics and sanitization","description":"OpenSpec refs:\n- openspec/specs/trudger/spec.md Requirement: Execution logging\n  - Scenario: Command logging includes full command\n  - Scenario: Log values include control characters\n\nExpected outputs:\n- Command start/exit and quit reasons are logged as single-line entries.\n- Control characters (\\n, \\r, \\t) are escaped in logged values.\n- Full command strings + args are included in logs without redaction.\n- Exit-code log lines include the command label and task id (when available).\n\nValidation/tests:\n- Add/extend bats coverage for log output and control-char escaping.\n- Ensure exit-code lines include label + task id (can be separate from full command line).\n- bats tests/trudger_test.bats\n\nAcceptance criteria:\n- Log entries remain single-line even when values contain control characters.\n- Logs include full command strings and arguments.\n- Exit-code log lines include label and task id (when available), even if logged on a separate line.","notes":"Completed: logging now sanitizes full entries, start/exit lines include full command+args and exit lines include label+task; tests updated.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-31T05:32:37.517344637Z","created_by":"mark","updated_at":"2026-02-04T02:09:44.071342779Z","closed_at":"2026-02-04T02:09:44.071287092Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-29x","depends_on_id":"tr-2v7","type":"parent-child","created_at":"2026-01-31T05:32:37.550086125Z","created_by":"mark"}]}
{"id":"tr-2c7","title":"Adopt env-var command + hook contract","description":"OpenSpec refs:\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Command execution environment\n  - Scenario: Command environment provided\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Task show output handling\n  - Scenario: Show output is prompt-only\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Hook execution semantics\n  - Scenario: Hook receives env vars\n\nWork:\n- Update command/hook execution to pass task context via TRUDGER_* env vars.\n- Remove positional task args for commands and hooks.\n- Set TRUDGER_TASK_ID only after a task is selected (not for commands.next_task).\n- After commands.task_show, set TRUDGER_TASK_SHOW and keep it available for subsequent commands/hooks.\n- After each commands.task_status, set TRUDGER_TASK_STATUS to the latest value.\n- Always set TRUDGER_CONFIG_PATH.\n\nExpected outputs:\n- Commands and hooks run with env vars only; no positional task id.\n\nValidation/tests:\n- Tests assert env vars are present and positional args are empty.","acceptance_criteria":"1. commands.next_task runs without TRUDGER_TASK_ID set; once a task is selected, TRUDGER_TASK_ID is set for subsequent commands/hooks. (OpenSpec: Command execution environment scenario.)\n2. TRUDGER_TASK_SHOW is set after commands.task_show and preserved for subsequent commands/hooks without parsing. (OpenSpec: Task show output handling scenario.)\n3. TRUDGER_TASK_STATUS reflects the most recent commands.task_status result and is available to hooks after review. (OpenSpec: Command execution environment scenario.)\n4. TRUDGER_CONFIG_PATH is always set. (OpenSpec: Command execution environment scenario.)\n5. Only relevant env vars are set for each command; unused prompt env vars are unset. (OpenSpec: Command execution environment + Agent prompt execution scenarios.)\n6. No positional task id arguments are passed to commands/hooks. (OpenSpec: Command execution environment + Hook execution semantics scenarios.)\n7. Tests verify env var presence/timing, absence of irrelevant env vars, and no positional args.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T06:07:10.112306839Z","created_by":"mark","updated_at":"2026-02-04T10:22:03.782439685Z","closed_at":"2026-02-04T10:22:03.782422791Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2c7","depends_on_id":"tr-1cs","type":"parent-child","created_at":"2026-02-04T06:07:10.116533761Z","created_by":"mark"},{"issue_id":"tr-2c7","depends_on_id":"tr-30q","type":"blocks","created_at":"2026-02-04T06:07:10.118381841Z","created_by":"mark"}]}
{"id":"tr-2e7","title":"Hardening: safer TaskId + env vars, pure-Rust arg escaping, Option log_path","description":"Scope:\n- Remove bash subprocess from arg rendering in logs (pure Rust escaping).\n- Replace log_path empty-string sentinel with Option and normalize empty => disabled.\n- Guard against oversized TRUDGER_* env values (detect + truncate + warn).\n- Tighten TaskId validation and remove TaskId::try_from(...).unwrap() panics.\n- Clarify exit code semantics (no clamping; OS uses low 8 bits).\n\nGoals: correctness, honest tests, and type-level enforcement where it helps.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-02-09T00:58:01.541969523Z","created_by":"mark","updated_at":"2026-02-09T01:22:53.454276124Z","closed_at":"2026-02-09T01:22:53.454259799Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-2e7.1","title":"Config: make log_path Option (normalize empty => None; reject null)","description":"Change internal representation of config.log_path from String sentinel to Option<PathBuf> (or equivalent), preserving external semantics:\n- missing log_path => logging disabled\n- log_path: \"\" (or whitespace) => logging disabled\n- log_path: null => validation error (per spec)\n\nUpdate wizard + tests accordingly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-09T00:58:07.701206934Z","created_by":"mark","updated_at":"2026-02-09T01:22:50.140996759Z","closed_at":"2026-02-09T01:22:50.140975856Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2e7.1","depends_on_id":"tr-2e7","type":"parent-child","created_at":"2026-02-09T00:58:07.701206934Z","created_by":"mark"}]}
{"id":"tr-2e7.2","title":"Logging: use pure-Rust arg escaping (no bash subprocess)","description":"Replace shell::render_args implementation to avoid spawning bash for printf %q.\n- Use a deterministic pure-Rust escaping strategy suitable for bash copy/paste.\n- Update log fixture(s) and tests accordingly.\n- Keep trailing-space behavior if tests/fixtures rely on it.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-09T00:58:13.691554562Z","created_by":"mark","updated_at":"2026-02-09T01:22:50.141769570Z","closed_at":"2026-02-09T01:22:50.141753708Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2e7.2","depends_on_id":"tr-2e7","type":"parent-child","created_at":"2026-02-09T00:58:13.691554562Z","created_by":"mark"}]}
{"id":"tr-2e7.3","title":"Shell: detect + truncate oversized TRUDGER_* env values (warn)","description":"Add a guard in command execution to prevent E2BIG from huge environment variables.\n- Detect when a TRUDGER_* env var value exceeds a conservative byte limit.\n- Truncate to the limit and emit a warning (stderr + transition log).\n- Add tests that exercise the truncation path deterministically (ASCII payload).\n\nAt minimum cover TRUDGER_TASK_SHOW / TRUDGER_PROMPT / TRUDGER_REVIEW_PROMPT, but consider TRUDGER_COMPLETED/NEEDS_HUMAN too.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-09T00:58:19.534688266Z","created_by":"mark","updated_at":"2026-02-09T01:22:50.142271746Z","closed_at":"2026-02-09T01:22:50.142260743Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2e7.3","depends_on_id":"tr-2e7","type":"parent-child","created_at":"2026-02-09T00:58:19.534688266Z","created_by":"mark"}]}
{"id":"tr-2e7.4","title":"TaskId: tighten validation + remove unwraps; propagate errors","description":"Harden TaskId handling:\n- TaskId::try_from should reject unsafe/ambiguous tokens (whitespace, shell metacharacters, overly long).\n- Replace TaskId::try_from(...).unwrap() in production paths with proper error propagation (CLI errors, Quit reasons, doctor errors).\n- Add tests for invalid manual -t values and invalid next_task outputs.\n\nMotivation: reduce footguns when interpolating TRUDGER_TASK_ID into bash -lc commands; avoid panics.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-09T00:58:25.068663701Z","created_by":"mark","updated_at":"2026-02-09T01:22:50.142679693Z","closed_at":"2026-02-09T01:22:50.142669395Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2e7.4","depends_on_id":"tr-2e7","type":"parent-child","created_at":"2026-02-09T00:58:25.068663701Z","created_by":"mark"}]}
{"id":"tr-2e7.5","title":"Quit exit code: document semantics (no clamping; low 8 bits)","description":"Clarify exit-code handling:\n- Keep Quit.code as i32.\n- Make it explicit (comment + maybe test) that the OS exit status is the low 8 bits; no clamping.\n- Avoid implying errno semantics (errno is separate from process exit status).\n\nThis is mostly clarity/type hygiene, not a functional change.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-09T00:58:30.196291401Z","created_by":"mark","updated_at":"2026-02-09T01:22:50.143124816Z","closed_at":"2026-02-09T01:22:50.143108958Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2e7.5","depends_on_id":"tr-2e7","type":"parent-child","created_at":"2026-02-09T00:58:30.196291401Z","created_by":"mark"}]}
{"id":"tr-2ef","title":"Add shared command helper and hook argument substitution","description":"OpenSpec refs:\n- Requirement: Hook execution semantics â€” Scenario: Hook uses $1 substitution\n- Requirement: Hook execution semantics â€” Scenario: Hook without substitution\n\nExpected outputs:\n- Shared helper for executing task/hook commands (next_task, task_show, task_update_in_progress, hooks).\n- Hook commands containing `$1` or `${1}` run via a shell with task id as $1.\n- Hook commands without substitution receive task id as first argument.\n\nValidation/tests:\n- Covered by new/updated BATS cases in the \"Extend tests\" task.\n\nSuccess criteria:\n- Hook execution matches spec and the helper is used consistently for task/hook commands.","acceptance_criteria":"Acceptance criteria: (1) Hook command with / executes via shell with task id available as . (2) Hook command without substitution receives task id as first argument. (3) Helper is used for all task/hook command invocations.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T05:25:49.562064640Z","created_by":"mark","updated_at":"2026-01-29T07:55:42.385464533Z","closed_at":"2026-01-29T07:55:42.385399163Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2ef","depends_on_id":"tr-2mc","type":"parent-child","created_at":"2026-01-29T05:25:49.571031781Z","created_by":"mark"}]}
{"id":"tr-2fd","title":"Rust hook execution + outcome handling","description":"OpenSpec refs:\n- openspec/changes/refactor-trudger-rust-native/specs/trudger/spec.md Requirement: Rust hook execution parity (Scenarios: Hook uses `$1` substitution in Rust; Hook without substitution in Rust)\n- openspec/specs/trudger/spec.md Requirement: Hook execution semantics (Scenarios: Hook uses `$1` substitution; Hook without substitution)\n- openspec/specs/trudger/spec.md Requirement: Task closure on success (Scenario: Task closed after successful review)\n- openspec/specs/trudger/spec.md Requirement: Requires-human escalation (Scenario: Task still open after review)\n\nWork:\n- Implement hook execution in Rust with `$1`/`${1}` substitution detection and shell invocation when present.\n- If no substitution token, pass task id as first argument.\n- Invoke on_completed when status == closed; invoke on_requires_human otherwise.\n\nExpected outputs:\n- Hook commands receive task id per spec and are executed in the right outcome path.\n\nValidation/tests:\n- Tests for both substitution paths and outcome-based hook invocation.","acceptance_criteria":"1. Hook commands containing `$1` or `${1}` are executed via a shell with task id available as `$1`. (OpenSpec: Rust hook execution parity scenario; Hook execution semantics scenario.)\n2. Hook commands without `$1`/`${1}` receive task id as argv[1]. (OpenSpec: Rust hook execution parity scenario; Hook execution semantics scenario.)\n3. on_completed executes only when status == closed; on_requires_human executes otherwise. (OpenSpec: Task closure on success; Requires-human escalation scenarios.)\n4. Tests cover both substitution behaviors and both outcome paths.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T04:43:56.740262629Z","created_by":"mark","updated_at":"2026-02-05T03:04:17.840310553Z","closed_at":"2026-02-05T03:04:17.840293614Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2fd","depends_on_id":"tr-1bh","type":"blocks","created_at":"2026-02-04T04:43:56.770366340Z","created_by":"mark"},{"issue_id":"tr-2fd","depends_on_id":"tr-3j8","type":"parent-child","created_at":"2026-02-04T04:43:56.765494530Z","created_by":"mark"}]}
{"id":"tr-2ij","title":"Notification hook hardening and contract cleanup","description":"Tracks remediation from notification-hook review (commits 23eeacf..22c7cec): duplicate task_end emission risk, payload contract drift, duration baseline ambiguity, missing regression coverage, and nightly runtime verification.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-02-12T05:28:07.206216647Z","created_by":"mark","updated_at":"2026-02-12T05:53:44.681842564Z","closed_at":"2026-02-12T05:53:44.681822232Z","close_reason":"Completed: all remediation child tasks closed including nightly runtime verification","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-2ij.1","title":"Decide non-run_end TRUDGER_NOTIFY_EXIT_CODE semantics","description":"Hard contract decision: for notification events other than run_end, should TRUDGER_NOTIFY_EXIT_CODE be unset or set to an empty string? Current implementation sets empty string while docs imply run_end-only presence.","notes":"Decision (2026-02-12): TRUDGER_NOTIFY_EXIT_CODE should be unset for non-run_end events.\nRationale: avoids ambiguous presence-based logic in hooks and aligns with run_end-only meaning.","status":"closed","priority":1,"issue_type":"question","created_at":"2026-02-12T05:28:07.251392562Z","created_by":"mark","updated_at":"2026-02-12T05:35:20.508031342Z","closed_at":"2026-02-12T05:35:20.508015134Z","close_reason":"Decision made: unset for non-run_end","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2ij.1","depends_on_id":"tr-2ij","type":"parent-child","created_at":"2026-02-12T05:28:07.251392562Z","created_by":"mark"}]}
{"id":"tr-2ij.2","title":"Decide all_logs duration baseline start point","description":"Hard timing-contract decision: should all_logs TRUDGER_NOTIFY_DURATION_MS measure from logger configuration time or from run_start after config/prompt validation? This choice affects downstream alerting and dashboards.","notes":"Decision (2026-02-12): all_logs TRUDGER_NOTIFY_DURATION_MS should use the run_start baseline (after config/prompt validation), not logger-configuration time.\nRationale: keeps duration semantics consistent across run_start/run_end/log events.","status":"closed","priority":2,"issue_type":"question","created_at":"2026-02-12T05:28:07.291244823Z","created_by":"mark","updated_at":"2026-02-12T05:35:20.540325959Z","closed_at":"2026-02-12T05:35:20.540303058Z","close_reason":"Decision made: all_logs baseline = run_start","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2ij.2","depends_on_id":"tr-2ij","type":"parent-child","created_at":"2026-02-12T05:28:07.291244823Z","created_by":"mark"}]}
{"id":"tr-2ij.3","title":"Fix duplicate task_end notification on terminal hook failure","description":"Prevent double task_end emission when terminal hooks fail: task_end currently dispatches in run_loop terminal branches and may dispatch again during finish_current_task_context teardown if current_task_id remains set on early error exits.","notes":"Nightly runtime repro (current behavior):\n- Toolchain: cargo 1.94.0-nightly (e91b2baa6 2025-12-13)\n- Scenario: hooks.on_notification=hook, scope=task_boundaries; single task transitions to closed; hooks.on_completed exits 9 (fails).\n- Observed: task_start_count=1, task_end_count=2, hook_invocations=3 (task_start + task_end + task_end again during teardown).\n- Likely cause: run_loop dispatches task_end before terminal hook and returns early on hook failure without clearing current_task_id; app teardown then calls finish_current_task_context which dispatches task_end again.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-02-12T05:28:07.328893334Z","created_by":"mark","updated_at":"2026-02-12T05:40:24.085357146Z","closed_at":"2026-02-12T05:40:24.085339859Z","close_reason":"Completed: clear task context after terminal task_end dispatch to prevent duplicate teardown task_end; regression test added and passing.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2ij.3","depends_on_id":"tr-2ij","type":"parent-child","created_at":"2026-02-12T05:28:07.328893334Z","created_by":"mark"}]}
{"id":"tr-2ij.4","title":"Align TRUDGER_NOTIFY_EXIT_CODE code/spec/docs contract","description":"Resolve contract mismatch for TRUDGER_NOTIFY_EXIT_CODE across src/run_loop.rs, src/logger.rs, README.md, and OpenSpec notification payload requirement. Implement one semantics and test/document it consistently.","notes":"Upstream decision locked: non-run_end TRUDGER_NOTIFY_EXIT_CODE must be unset (not empty string). Implement code+spec+README+tests accordingly.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-12T05:28:07.365430522Z","created_by":"mark","updated_at":"2026-02-12T05:44:19.054595896Z","closed_at":"2026-02-12T05:44:19.054575741Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2ij.4","depends_on_id":"tr-2ij","type":"parent-child","created_at":"2026-02-12T05:28:07.365430522Z","created_by":"mark"},{"issue_id":"tr-2ij.4","depends_on_id":"tr-2ij.1","type":"blocks","created_at":"2026-02-12T05:28:07.519495708Z","created_by":"mark"}]}
{"id":"tr-2ij.5","title":"Align all_logs notify duration baseline with run-boundary semantics","description":"Make TRUDGER_NOTIFY_DURATION_MS baseline unambiguous in all_logs mode (src/logger.rs + app wiring + docs/spec/tests) so run_start/run_end/all_logs semantics are internally consistent.","notes":"Upstream decision locked: all_logs duration baseline is run_start (post-validation/prompt checks). Update logger/app wiring, spec/docs, and regression tests accordingly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-12T05:28:07.404677850Z","created_by":"mark","updated_at":"2026-02-12T05:50:43.450016357Z","closed_at":"2026-02-12T05:50:43.449996967Z","close_reason":"Completed: all_logs notify duration now baselined at run_start with app/logger wiring, docs clarification, and regression coverage.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2ij.5","depends_on_id":"tr-2ij","type":"parent-child","created_at":"2026-02-12T05:28:07.404677850Z","created_by":"mark"},{"issue_id":"tr-2ij.5","depends_on_id":"tr-2ij.2","type":"blocks","created_at":"2026-02-12T05:28:07.555862569Z","created_by":"mark"}]}
{"id":"tr-2ij.6","title":"Add notification failure-path regression coverage and test fixture dedupe","description":"Add regression tests for terminal hook failure paths with notifications enabled (including no duplicate task_end), and extract shared notification test setup helpers to reduce repeated fixture boilerplate in run_loop tests.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-12T05:28:07.441502931Z","created_by":"mark","updated_at":"2026-02-12T05:47:10.891621144Z","closed_at":"2026-02-12T05:47:10.891595278Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2ij.6","depends_on_id":"tr-2ij","type":"parent-child","created_at":"2026-02-12T05:28:07.441502931Z","created_by":"mark"},{"issue_id":"tr-2ij.6","depends_on_id":"tr-2ij.3","type":"blocks","created_at":"2026-02-12T05:28:07.591144323Z","created_by":"mark"},{"issue_id":"tr-2ij.6","depends_on_id":"tr-2ij.4","type":"related","created_at":"2026-02-12T05:28:07.778207701Z","created_by":"mark"},{"issue_id":"tr-2ij.6","depends_on_id":"tr-2ij.5","type":"related","created_at":"2026-02-12T05:28:07.815640604Z","created_by":"mark"}]}
{"id":"tr-2ij.7","title":"Run notification-hook runtime verification with Rust nightly","description":"Run targeted/full notification-hook verification with cargo +nightly (or nextest nightly where applicable), record failing/passing evidence, and attach commands/output notes to close remediation loop.","notes":"Nightly runtime verification evidence (pre-fix baseline):\n1) Duplicate task_end on terminal hook failure: task_boundaries + failing on_completed produces task_end twice (see notes on tr-2ij.3).\n2) all_logs early notification + exit_code presence: With scope=all_logs and missing prompt files, quit(reason=Missing prompt file) triggers a log notification (TRUDGER_NOTIFY_EVENT=log) and TRUDGER_NOTIFY_EXIT_CODE is present (envset=1) but empty.\n3) all_logs duration baseline: in the prompt-missing early-exit case, TRUDGER_NOTIFY_DURATION_MS observed as 0 (notification baseline currently starts at logger configure time, before prompt validation).\n\nNote: this task should be re-run after fixes land to confirm regressions are resolved.\n\nPost-fix nightly runtime verification (2026-02-12):\n\nCommands run:\n1) cargo +nightly nextest run notification_hook\n   - Result: PASS (10 passed, 0 failed)\n   - Notable coverage includes:\n     - run_loop::tests::dispatch_notification_hook_run_start_and_run_end_payload_semantics\n     - run_loop::tests::dispatch_notification_hook_nonzero_exit_is_fail_open\n     - run_loop::tests::run_loop_continues_when_notification_hook_fails\n\n2) cargo +nightly test unit_tests::run_with_cli_emits_task_end_once_when_on_completed_hook_fails -- --exact\n   - Result: PASS (1 passed)\n\n3) cargo +nightly test unit_tests::run_with_cli_emits_task_end_once_when_on_requires_human_hook_fails -- --exact\n   - Result: PASS (1 passed)\n\n4) cargo +nightly test run_loop::tests::run_loop_dispatches_task_boundary_notifications_once_each -- --exact\n   - Result: PASS (1 passed)\n\n5) cargo +nightly test run_loop::tests::dispatch_notification_hook_run_start_and_run_end_payload_semantics -- --exact\n   - Result: PASS (1 passed)\n\n6) cargo +nightly test unit_tests::all_logs_duration_baseline_starts_at_run_start -- --exact\n   - Result: PASS (1 passed)\n\n7) cargo +nightly test unit_tests::run_with_cli_dispatches_all_logs_notifications_when_log_path_is_empty -- --exact\n   - Result: PASS (1 passed)\n\n8) cargo +nightly test unit_tests::all_logs_notification_failure_does_not_recurse -- --exact\n   - Result: PASS (1 passed)\n\nConclusion:\n- Duplicate task_end regression checks now pass on nightly.\n- TRUDGER_NOTIFY_EXIT_CODE semantics checks now pass on nightly.\n- all_logs duration baseline checks now pass on nightly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-12T05:28:07.480159336Z","created_by":"mark","updated_at":"2026-02-12T05:53:44.636924975Z","closed_at":"2026-02-12T05:53:44.636903972Z","close_reason":"Completed: nightly notification-hook verification rerun and documented with passing evidence","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2ij.7","depends_on_id":"tr-2ij","type":"parent-child","created_at":"2026-02-12T05:28:07.480159336Z","created_by":"mark"},{"issue_id":"tr-2ij.7","depends_on_id":"tr-2ij.1","type":"related","created_at":"2026-02-12T05:28:07.853462605Z","created_by":"mark"},{"issue_id":"tr-2ij.7","depends_on_id":"tr-2ij.2","type":"related","created_at":"2026-02-12T05:28:07.889808673Z","created_by":"mark"},{"issue_id":"tr-2ij.7","depends_on_id":"tr-2ij.3","type":"blocks","created_at":"2026-02-12T05:28:07.626284852Z","created_by":"mark"},{"issue_id":"tr-2ij.7","depends_on_id":"tr-2ij.4","type":"blocks","created_at":"2026-02-12T05:28:07.670259171Z","created_by":"mark"},{"issue_id":"tr-2ij.7","depends_on_id":"tr-2ij.5","type":"blocks","created_at":"2026-02-12T05:28:07.705120041Z","created_by":"mark"},{"issue_id":"tr-2ij.7","depends_on_id":"tr-2ij.6","type":"blocks","created_at":"2026-02-12T05:28:07.742171850Z","created_by":"mark"}]}
{"id":"tr-2m6","title":"Bug: notification folder should be invocation cwd (not current_dir)","description":"In notification hook payloads, TRUDGER_NOTIFY_FOLDER is currently populated from env::current_dir() at dispatch time (run_loop/logger). The add-notification-hook-modes design spec says it should use the absolute invocation working directory captured at startup for stability.","status":"open","priority":3,"issue_type":"bug","created_at":"2026-02-12T09:12:38.964682147Z","created_by":"mark","updated_at":"2026-02-12T09:12:38.964682147Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-2mc","title":"Refactor Trudger config parsing, docs, and test helpers","description":"Goals:\n- Align config parsing/validation with spec using yq, required keys, null handling, unknown key warnings, and missing-config bootstrap messaging.\n- Standardize hook execution and task selection/review behaviors to match the updated spec.\n- Reduce duplication by consolidating specs, refactoring tests/fixtures, and updating docs/prompts.\n\nScope:\n- Code: `trudger` script + shared command execution helper.\n- Tests/fixtures: `tests/trudger_test.bats`, `tests/fixtures/bin/*`.\n- Docs/specs: `README.md`, `prompts/*.md`, `openspec/specs/trudger/spec.md`, and removal of duplicate spec copies under `openspec/changes/`.\n\nOpenSpec refs:\n- ADDED: Configuration loading (Scenario: Missing config file)\n- ADDED: Configuration validation (Scenario: Required config value missing)\n- ADDED: Configuration parsing (Scenario: Null config value)\n- ADDED: Unknown config keys (Scenario: Unknown config key)\n- ADDED: Hook execution semantics (Scenario: Hook uses $1 substitution; Scenario: Hook without substitution)\n- MODIFIED: Task selection (Scenario: No selectable tasks; Scenario: Task not ready is skipped)\n- MODIFIED: Task closure on success (Scenario: Task closed after successful review)\n- MODIFIED: Requires-human escalation (Scenario: Task still open after review)\n- MODIFIED: Codex update verification (Scenario: Missing status after review)","acceptance_criteria":"Acceptance criteria: (1) All added/modified OpenSpec requirements listed in the epic are implemented in trudger and reflected in docs/tests. (2) Tests cover each referenced scenario and pass. (3) openspec validate refactor-trudger-config-and-docs --strict --no-interactive succeeds.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-29T05:24:30.328999195Z","created_by":"mark","updated_at":"2026-01-30T01:55:11.583693463Z","closed_at":"2026-01-30T01:55:11.583627637Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-2ry","title":"Hardening: correctness, tests, and types","description":"Repo-wide review follow-ups focused on:\n\n- Honest, enforced test/coverage gates\n- Types that prevent incorrect states\n- Removing avoidable panics and footguns\n- Clarifying env/CLI behavior\n\nThis epic tracks the concrete fixes and refactors needed to keep trudger predictable and safe under failure modes.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-02-07T06:46:07.091367113Z","created_by":"mark","updated_at":"2026-02-08T15:20:25.986158404Z","closed_at":"2026-02-08T15:20:25.986137949Z","close_reason":"All child tasks tr-2ry.* are closed; epic complete","source_repo":".","compaction_level":0,"original_size":0,"labels":["human_required"]}
{"id":"tr-2ry.1","title":"Coverage: restore 100% llvm-cov gate (exclude only wizard wiring)","description":"Restore an honest 100% llvm-cov gate while keeping exclusions minimal and justified.\n\nDecision: we may exclude wizard config read/write and interactive terminal wiring from coverage (by isolating them into dedicated modules), but wizard core logic must be covered via deterministic tests.","acceptance_criteria":"Done when:\n- `cargo llvm-cov --all-targets --ignore-filename-regex \"unit_tests\\.rs$|wizard/(interactive|fs)\\.rs$\" --fail-under-lines 100 --fail-under-regions 100` passes locally.\n- `.github/workflows/ci.yml` runs the same llvm-cov command (same ignore regex + thresholds).\n- The ignore regex excludes only:\n  - `src/unit_tests.rs` (test-only harness)\n  - `src/wizard/interactive.rs` (terminal wiring)\n  - `src/wizard/fs.rs` (config read/write)\n- README coverage docs include the exact enforced command and justification for each excluded file.\n- No other production files are excluded from coverage.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-07T06:46:07.159230409Z","created_by":"mark","updated_at":"2026-02-08T03:56:52.614880092Z","closed_at":"2026-02-08T03:56:52.614854731Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2ry.1","depends_on_id":"tr-2ry","type":"parent-child","created_at":"2026-02-07T06:46:07.159230409Z","created_by":"mark"},{"issue_id":"tr-2ry.1","depends_on_id":"tr-2ry.2","type":"blocks","created_at":"2026-02-08T01:05:22.997612266Z","created_by":"mark"}]}
{"id":"tr-2ry.2","title":"Wizard: abstract IO (\"abstract interpretation\") and add deterministic tests","description":"Make wizard behavior testable without a real TTY by separating pure decisions from effects.\n\nDecision: keep behavior the same, but exact prompt/output text does not need to match (similar output is fine). Config read/write can be isolated (and excluded from coverage if needed).","acceptance_criteria":"Done when:\n- Wizard core logic performs no direct terminal IO (no `stdin` reads, no `stdout/stderr` writes); all interaction goes through a small IO interface.\n- There is a real terminal interpreter and a deterministic test interpreter.\n- Tests drive wizard flows through the test interpreter (template selection defaults, merge decisions, unknown-key preservation, backups, and validation failure behavior).\n- Config read/write is isolated in `src/wizard/fs.rs` (thin wrappers) so core logic remains unit-testable.\n- `cargo nextest run` passes.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-07T06:46:07.198704393Z","created_by":"mark","updated_at":"2026-02-08T01:53:34.864562793Z","closed_at":"2026-02-08T01:53:34.864545595Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2ry.2","depends_on_id":"tr-2ry","type":"parent-child","created_at":"2026-02-07T06:46:07.198704393Z","created_by":"mark"}]}
{"id":"tr-2ry.3","title":"Run loop: only reset tasks on exit when currently in_progress","description":"Fix correctness bug: `reset_task_on_exit` can reopen tasks that are already `closed`/`blocked` if an error happens late (for example, hook failure).\n\nDecision: on exit, re-check the task status via `commands.task_status` and only run `commands.reset_task` if the current status is `in_progress`.","acceptance_criteria":"Done when:\n- On any non-OK exit (including SIGINT / exit code 130) with an active task id, trudger runs `commands.task_status` for that task and only runs `commands.reset_task` when the status token is exactly `in_progress`.\n- If `commands.task_status` fails or returns an empty status at exit time, trudger does not attempt a reset (and logs a warning/transition).\n- Tests cover:\n  - hook failure after `closed` does not invoke reset\n  - hook failure after `blocked` does not invoke reset\n  - solve/review failure while `in_progress` does invoke reset\n  - SIGINT while `in_progress` does invoke reset\n  - status-check failure at exit does not invoke reset\n- `cargo nextest run` passes.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-07T06:46:07.240891803Z","created_by":"mark","updated_at":"2026-02-08T02:15:08.402965070Z","closed_at":"2026-02-08T02:15:08.402946826Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2ry.3","depends_on_id":"tr-2ry","type":"parent-child","created_at":"2026-02-07T06:46:07.240891803Z","created_by":"mark"}]}
{"id":"tr-2ry.4","title":"Remove avoidable panics in production code (tmux + wizard)","description":"Remove avoidable panics in production code.\n\nDecisions:\n- For tmux title cleanup, prefer a non-regex implementation, or compile regexes once at startup (no repeated compilation, no `unwrap`).\n- For wizard YAML path mutation, make panics unreachable by construction; no `expect`/`unwrap` in the normal code path.","acceptance_criteria":"Done when:\n- tmux title cleanup does not call `Regex::new(...).unwrap()` in production code (either no-regex, or compiled once via `OnceLock` + graceful fallback).\n- wizard YAML mutation code has no `expect/unwrap` in non-test paths; internal errors are represented as errors and/or made unreachable by construction.\n- Relevant behavior is covered by tests (tmux base-name trimming, wizard path mutation / merge behavior).\n- `cargo clippy --all-targets -- -D warnings` and `cargo nextest run` pass.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-07T06:46:07.283744262Z","created_by":"mark","updated_at":"2026-02-08T04:42:37.519701550Z","closed_at":"2026-02-08T04:42:37.519684772Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2ry.4","depends_on_id":"tr-2ry","type":"parent-child","created_at":"2026-02-07T06:46:07.283744262Z","created_by":"mark"},{"issue_id":"tr-2ry.4","depends_on_id":"tr-2ry.2","type":"blocks","created_at":"2026-02-08T01:05:23.034056097Z","created_by":"mark"}]}
{"id":"tr-2ry.5","title":"Fix command_exists semantics (executable + no dangling symlinks)","description":"Fix `command_exists` so it reflects \"actually runnable\" commands on Unix.\n\nDecision: we do not need Windows-specific semantics; keep behavior correct on Unix (what CI runs).","acceptance_criteria":"Done when:\n- On Unix, `command_exists(name)` returns true only when PATH contains a resolvable, executable file for `name`.\n- Dangling symlinks are treated as missing.\n- Unit tests are updated to match the new semantics.\n- tmux enablement cannot be triggered by non-executable files or dangling symlinks.\n- `cargo nextest run` passes.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-07T06:46:07.326681537Z","created_by":"mark","updated_at":"2026-02-08T04:09:06.267492554Z","closed_at":"2026-02-08T04:09:06.267474687Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2ry.5","depends_on_id":"tr-2ry","type":"parent-child","created_at":"2026-02-07T06:46:07.326681537Z","created_by":"mark"}]}
{"id":"tr-2ry.6","title":"Remove global env coupling for TRUDGER_COMPLETED/TRUDGER_NEEDS_HUMAN","description":"Remove global process-environment coupling for `TRUDGER_COMPLETED` and `TRUDGER_NEEDS_HUMAN`.\n\nDecision: rely on explicit per-command env injection (`CommandEnv`) rather than `env::set_var` in the parent process.","acceptance_criteria":"Done when:\n- `run_loop` no longer calls `env::set_var(\"TRUDGER_COMPLETED\", ...)` or `env::set_var(\"TRUDGER_NEEDS_HUMAN\", ...)`.\n- Commands/hooks still receive `TRUDGER_COMPLETED` / `TRUDGER_NEEDS_HUMAN` via `CommandEnv` when non-empty.\n- Tests cover that these env vars are present with expected values for at least one command/hook after completing/escalating tasks.\n- `cargo nextest run` passes.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-07T06:46:07.375054951Z","created_by":"mark","updated_at":"2026-02-08T04:53:01.389038792Z","closed_at":"2026-02-08T04:53:01.389021701Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2ry.6","depends_on_id":"tr-2ry","type":"parent-child","created_at":"2026-02-07T06:46:07.375054951Z","created_by":"mark"}]}
{"id":"tr-2ry.7","title":"Introduce types for TaskId/TaskStatus/Phase/ReviewLoopLimit","description":"Introduce types that enforce correctness across config parsing, run loop, doctor mode, and wizard output.\n\nDecisions:\n- Make this a bigger change (not run_loop-only): propagate types into config/doctor/wizard where it improves invariants.\n- Preserve unknown status strings for logging/debugging.\n- Enforce `review_loop_limit` non-zero at the serde layer (not just runtime validation).","acceptance_criteria":"Done when:\n- Core control flow does not depend on bare status/phase string literals; it uses enums/newtypes.\n- `TaskStatus` preserves unknown values (e.g. `Unknown(String)`) and logs them; unknown statuses never match ready/terminal statuses.\n- `review_loop_limit` is non-zero by construction (serde rejects 0) and error messages remain actionable (path/key context preserved).\n- Doctor mode and wizard output use the same typed status/ID representations (no parallel stringly-typed implementations).\n- `cargo clippy --all-targets -- -D warnings` and `cargo nextest run` pass.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-07T06:46:07.418429789Z","created_by":"mark","updated_at":"2026-02-08T05:41:12.755437453Z","closed_at":"2026-02-08T05:41:12.755406705Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2ry.7","depends_on_id":"tr-2ry","type":"parent-child","created_at":"2026-02-07T06:46:07.418429789Z","created_by":"mark"},{"issue_id":"tr-2ry.7","depends_on_id":"tr-2ry.3","type":"blocks","created_at":"2026-02-08T01:05:23.077283936Z","created_by":"mark"},{"issue_id":"tr-2ry.7","depends_on_id":"tr-2ry.6","type":"blocks","created_at":"2026-02-08T01:05:23.125220341Z","created_by":"mark"}]}
{"id":"tr-2ry.8","title":"wizard_templates: remove broad allow(dead_code)","description":"Remove the broad dead-code suppression in `src/wizard_templates.rs` so drift is caught by CI.","acceptance_criteria":"Done when:\n- `#![allow(dead_code)]` is removed from `src/wizard_templates.rs`, or narrowed to the smallest necessary scope.\n- Any truly-unused items are either removed or justified with targeted `#[allow(dead_code)]`.\n- `cargo clippy --all-targets -- -D warnings` passes.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-07T06:46:07.458707798Z","created_by":"mark","updated_at":"2026-02-08T06:13:29.219766427Z","closed_at":"2026-02-08T06:13:29.219747874Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2ry.8","depends_on_id":"tr-2ry","type":"parent-child","created_at":"2026-02-07T06:46:07.458707798Z","created_by":"mark"}]}
{"id":"tr-2ry.9","title":"CI: add caching to speed up installs/builds","description":"Speed up CI by caching Rust build artifacts.\n\nDecision: use `Swatinem/rust-cache` in `.github/workflows/ci.yml`.","acceptance_criteria":"Done when:\n- `.github/workflows/ci.yml` uses `Swatinem/rust-cache@v2` (or equivalent) with sensible defaults.\n- All existing quality gates still run (fmt/clippy/nextest/llvm-cov/shellcheck) with no weakening.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-07T06:46:07.497468670Z","created_by":"mark","updated_at":"2026-02-08T06:46:19.376936403Z","closed_at":"2026-02-08T06:46:19.376916823Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2ry.9","depends_on_id":"tr-2ry","type":"parent-child","created_at":"2026-02-07T06:46:07.497468670Z","created_by":"mark"}]}
{"id":"tr-2v7","title":"Update trudger logging, parsing, and reexec behavior","description":"Goals:\n- Implement OpenSpec change update-trudger-logging-and-parsing for logging, parse errors, prompt context, and reexec handling.\n\nScope:\n- YAML parse failure handling with clear error.\n- Prompt context via env vars (TRUDGER_PROMPT/TRUDGER_REVIEW_PROMPT/ TRUDGER_TASK_SHOW) and no prompt substitution.\n- Logging semantics (single-line, escaped control chars, full command text).\n- Error trap exits via quit path.\n- Reexec path resolution + logging.\n- Tests and validation updates.\n\nOut of scope:\n- Changing task selection or hook behavior beyond env-var contract.\n\nAcceptance criteria:\n- Spec deltas in openspec/changes/update-trudger-logging-and-parsing are implemented.\n- Tests cover parse failure, env-var prompt context, logging/error handling, and reexec path logging.\n- shellcheck, bats, and openspec validate all pass.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-31T05:31:35.090103295Z","created_by":"mark","updated_at":"2026-02-04T08:49:29.813374118Z","closed_at":"2026-02-04T08:49:29.813296291Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-2vc","title":"Refactor: split src/main.rs into modules (run/doctor/tmux/logging)","description":"`src/main.rs` is currently a ~3k LOC monolith that mixes:\n- CLI parsing and config bootstrap\n- logging\n- shell command execution (`bash -lc`)\n- tmux integration\n- main run loop state machine\n- doctor mode\n- unit tests\n\nRefactor into focused modules to make changes safer to land for release polish.\n\nSuggested module split (names flexible):\n- `src/cli.rs`: `Cli`, `CliCommand`, parsing helpers\n- `src/logger.rs`: `Logger`, `sanitize_log_value`\n- `src/shell.rs`: command execution + env wiring (`CommandEnv`, `run_shell_command_*`)\n- `src/tmux.rs`: `TmuxState`, `build_tmux_name`\n- `src/run_loop.rs`: `RuntimeState` + `run_loop` state machine\n- `src/doctor.rs`: doctor mode helpers + checks\n- `src/main.rs`: small wiring layer\n\nKeep behavior identical; this is purely a clarity/structure refactor.","acceptance_criteria":"Done when:\n- `src/main.rs` contains no logic beyond wiring (mode selection + calling into modules). All non-trivial behavior lives in modules.\n- The unit tests currently defined in `src/main.rs` are moved into dedicated test module file(s) (for example `src/unit_tests.rs`), with `src/main.rs` only containing a `#[cfg(test)] mod ...;` declaration (no inline test bodies).\n- No behavior changes: all existing unit tests continue to pass.\n- Quality gates pass: `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, `cargo test`.\n- No new public API surface beyond what the binary needs (`pub(crate)` preferred).","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-06T08:55:56.329439763Z","created_by":"mark","updated_at":"2026-02-06T10:15:30.527269873Z","closed_at":"2026-02-06T10:15:30.527253793Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2vc","depends_on_id":"tr-obz","type":"parent-child","created_at":"2026-02-06T09:13:42.433037743Z","created_by":"mark"}]}
{"id":"tr-2vh","title":"Rust tests + validation","description":"OpenSpec refs:\n- openspec/changes/refactor-trudger-rust-native/specs/trudger/spec.md Requirements: Rust entrypoint; Rust configuration parsing; Rust in-process loop; Rust hook execution parity; Rust logging parity (all scenarios)\n- openspec/specs/trudger/spec.md Requirements exercised by Rust implementation: Prompt file presence; Configuration loading/validation/unknown keys; Task selection; Agent prompt execution; Task show output handling; Task closure on success; Requires-human escalation; Agent update verification\n\nWork:\n- Add tests for config parsing (nulls, invalid YAML, unknown keys), hook substitution semantics, and log formatting/escaping.\n- Add integration tests for task loop behavior (next_task exit handling, skip-not-ready, missing status).\n- Smoke run with sample_configuration/*.yml using target/release/trudger.\n\nExpected outputs:\n- Test suite and smoke run cover the Rust-specific requirements and core task loop behavior.\n\nValidation/tests:\n- cargo test\n- Smoke run with sample_configuration/*.yml using release binary","acceptance_criteria":"1. Tests cover Rust entrypoint execution, config parsing (nulls, invalid YAML, unknown keys), in-process loop behavior, env-var command contract, hook semantics, and log formatting/escaping. (OpenSpec: Rust requirements + scenarios.)\n2. Integration tests exercise task selection exit semantics, skip-not-ready, env-var prompt handling, and missing-status error. (OpenSpec: Task selection, Agent prompt execution, Agent update verification scenarios.)\n3. cargo test passes.\n4. Smoke run using sample_configuration/*.yml with target/release/trudger succeeds.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T04:44:33.308741208Z","created_by":"mark","updated_at":"2026-02-05T03:20:11.527622587Z","closed_at":"2026-02-05T03:20:11.527590929Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2vh","depends_on_id":"tr-1bh","type":"blocks","created_at":"2026-02-04T04:44:33.317986828Z","created_by":"mark"},{"issue_id":"tr-2vh","depends_on_id":"tr-1nf","type":"blocks","created_at":"2026-02-04T04:44:33.314728358Z","created_by":"mark"},{"issue_id":"tr-2vh","depends_on_id":"tr-2fd","type":"blocks","created_at":"2026-02-04T04:44:33.319490302Z","created_by":"mark"},{"issue_id":"tr-2vh","depends_on_id":"tr-37d","type":"blocks","created_at":"2026-02-04T04:44:33.320964180Z","created_by":"mark"},{"issue_id":"tr-2vh","depends_on_id":"tr-3j8","type":"parent-child","created_at":"2026-02-04T04:44:33.312951854Z","created_by":"mark"},{"issue_id":"tr-2vh","depends_on_id":"tr-7vm","type":"blocks","created_at":"2026-02-04T04:44:33.316441286Z","created_by":"mark"}]}
{"id":"tr-2xy","title":"Centralize base config in tests","description":"OpenSpec refs:\n- Requirement: Configuration loading â€” Scenario: Missing config file\n- Requirement: Configuration validation â€” Scenario: Required config value missing\n- Requirement: Configuration parsing â€” Scenario: Null config value\n\nExpected outputs:\n- Centralized base config setup in `tests/trudger_test.bats` with all required keys.\n- Tests reuse the shared base config to reduce duplication and keep required fields in sync.\n\nValidation/tests:\n- BATS suite passes with shared base config.\n\nSuccess criteria:\n- Test fixtures stay aligned with required config fields and are easier to maintain.","acceptance_criteria":"Acceptance criteria: (1) Base config includes all required keys and non-empty values. (2) Tests reuse the shared base config rather than re-declaring required fields.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T05:26:14.048626175Z","created_by":"mark","updated_at":"2026-01-29T09:03:15.335203958Z","closed_at":"2026-01-29T09:03:15.335159913Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2xy","depends_on_id":"tr-2mc","type":"parent-child","created_at":"2026-01-29T05:26:14.073885268Z","created_by":"mark"},{"issue_id":"tr-2xy","depends_on_id":"tr-365","type":"waits-for","created_at":"2026-01-29T05:26:14.079065130Z","created_by":"mark"}]}
{"id":"tr-2zt","title":"Update tests to use --config and sample configs","description":"OpenSpec refs:\n- Requirement: Config flag override â€” Scenario: provided config path used\n- Requirement: Sample config files â€” Scenario: sample configs available in repo\n\nExpected outputs:\n- Tests that need config use `-c/--config` with files in `sample_configuration/`.\n- Inline config definitions in tests are replaced with sample configs where appropriate.\n\nValidation/tests:\n- `bats tests/trudger_test.bats` passes after updates.\n\nSuccess criteria:\n- Tests consistently rely on the config flag and sample configs, reducing duplication.","acceptance_criteria":"Acceptance criteria: (1) Tests that load config use -c/--config. (2) Sample config files are used instead of inline YAML where possible.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T06:06:02.179922292Z","created_by":"mark","updated_at":"2026-01-30T02:08:59.123375307Z","closed_at":"2026-01-30T02:08:59.123330480Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-2zt","depends_on_id":"tr-1hl","type":"waits-for","created_at":"2026-01-29T06:06:02.187221461Z","created_by":"mark"},{"issue_id":"tr-2zt","depends_on_id":"tr-jyr","type":"parent-child","created_at":"2026-01-29T06:06:02.184031544Z","created_by":"mark"},{"issue_id":"tr-2zt","depends_on_id":"tr-rg8","type":"waits-for","created_at":"2026-01-29T06:06:02.185632425Z","created_by":"mark"}]}
{"id":"tr-305","title":"probe task","description":"probe","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-29T06:03:28.181049417Z","created_by":"mark","updated_at":"2026-01-29T06:03:42.322989858Z","source_repo":".","deleted_at":"2026-01-29T06:03:42.322981732Z","deleted_by":"mark","delete_reason":"delete","original_type":"task","compaction_level":0,"original_size":0}
{"id":"tr-30q","title":"Update config schema for agent_command + agent_review_command","description":"OpenSpec refs:\\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Configuration validation\\n  - Scenario: Required config value missing\\n\\nWork:\\n- Update config schema/validation to require agent_command and agent_review_command.\\n- Remove codex_command from required keys (treat as invalid/unknown as appropriate).\\n\\nExpected outputs:\\n- Config validation errors name missing agent_command/agent_review_command.\\n\\nValidation/tests:\\n- Unit or bats tests for missing required keys.\\n\\nSuccess criteria:\\n- Missing agent_command or agent_review_command yields clear non-zero error.","acceptance_criteria":"1. Config validation requires agent_command and agent_review_command; missing values are named in the error. (OpenSpec: Configuration validation scenario.)\n2. If codex_command is present, validation fails with a clear migration error (not just an unknown-key warning).\n3. Tests cover missing agent_command/agent_review_command and codex_command presence.","notes":"Verified current implementation: Rust config validation in src/config.rs requires agent_command/agent_review_command and includes a unit test rejecting codex_command. However, the Bash script  still reads/validates codex_command and bats tests are still codex_command-based. Acceptance criteria 1â€“3 are not met end-to-end until the shell config validation and tests are updated to the new keys (or clarified to be Rust-only).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T06:06:58.682623056Z","created_by":"mark","updated_at":"2026-02-04T09:46:41.396729037Z","closed_at":"2026-02-04T09:46:41.396711792Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["human_required"],"dependencies":[{"issue_id":"tr-30q","depends_on_id":"tr-1cs","type":"parent-child","created_at":"2026-02-04T06:06:58.707565020Z","created_by":"mark"}],"comments":[{"id":3,"issue_id":"tr-30q","author":"Mark Wotton","text":"Do you want this task to update the Bash  config validation and bats tests to use / (and fail on ), or is the Rust-only validation sufficient for now? I can proceed either way.","created_at":"2026-02-04T09:33:04Z"}]}
{"id":"tr-31i","title":"Add shared queue helpers and update fixtures","description":"OpenSpec refs:\n- Requirement: Task selection â€” Scenario: No selectable tasks\n- Requirement: Task selection â€” Scenario: Task not ready is skipped\n\nExpected outputs:\n- Shared queue/fixture helper(s) for `tests/fixtures/bin/*`.\n- Fixtures updated to use shared helpers to simulate task queues consistently.\n\nValidation/tests:\n- BATS suite passes with fixture helper updates.\n\nSuccess criteria:\n- Fixture behavior is consistent and queue setup logic is no longer duplicated.","acceptance_criteria":"Acceptance criteria: (1) Fixture bins use shared queue/fixture helpers. (2) Queue helpers can represent ready/open vs not-ready tasks used in task selection scenarios.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T05:26:23.141924426Z","created_by":"mark","updated_at":"2026-01-29T09:08:46.236169425Z","closed_at":"2026-01-29T09:08:46.236107779Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-31i","depends_on_id":"tr-2mc","type":"parent-child","created_at":"2026-01-29T05:26:23.166862367Z","created_by":"mark"},{"issue_id":"tr-31i","depends_on_id":"tr-2xy","type":"waits-for","created_at":"2026-01-29T05:26:23.172009220Z","created_by":"mark"}]}
{"id":"tr-34q","title":"Use resolved reexec path and log it","description":"OpenSpec refs:\n- openspec/specs/trudger/spec.md Requirement: Reexec path resolution\n  - Scenario: Reexec uses resolved path\n\nExpected outputs:\n- Resolve executable path using `command -v \"$0\"` when available; otherwise fall back to `$0`.\n- Exec using the resolved path (if found) and log the path actually used.\n\nValidation/tests:\n- Add bats coverage that inspects the log for the reexec path used.\n- bats tests/trudger_test.bats\n\nAcceptance criteria:\n- Reexec uses `command -v \"$0\"` when it resolves to a path; else uses `$0`.\n- Log entry records the reexec path used.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T05:32:50.964076986Z","created_by":"mark","updated_at":"2026-02-05T01:00:40.252191040Z","closed_at":"2026-02-05T01:00:40.252175530Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-34q","depends_on_id":"tr-2v7","type":"parent-child","created_at":"2026-01-31T05:32:50.968361896Z","created_by":"mark"}]}
{"id":"tr-34r","title":"Run BATS test suite","description":"OpenSpec refs:\n- Requirement: Config flag override â€” Scenario: provided config path used; Scenario: missing config path errors\n- Requirement: Sample config files â€” Scenario: sample configs available in repo\n\nExpected outputs:\n- `bats tests/trudger_test.bats` completes successfully.\n\nValidation/tests:\n- Run `bats tests/trudger_test.bats`.\n\nSuccess criteria:\n- Test suite exits 0 with all tests passing.","acceptance_criteria":"Acceptance criteria: (1) bats tests/trudger_test.bats exits 0 with all tests passing.","notes":"Acceptance criteria verified: bats tests/trudger_test.bats exits 0 with all tests passing (2026-01-30). Unable to close because dependencies are still open: tr-2zt, tr-htz.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T06:06:27.727815244Z","created_by":"mark","updated_at":"2026-01-30T02:16:33.824136890Z","closed_at":"2026-01-30T02:16:33.824074563Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-34r","depends_on_id":"tr-2zt","type":"waits-for","created_at":"2026-01-29T06:06:27.733638122Z","created_by":"mark"},{"issue_id":"tr-34r","depends_on_id":"tr-htz","type":"waits-for","created_at":"2026-01-29T06:06:27.735325410Z","created_by":"mark"},{"issue_id":"tr-34r","depends_on_id":"tr-jyr","type":"parent-child","created_at":"2026-01-29T06:06:27.732010018Z","created_by":"mark"}]}
{"id":"tr-35l","title":"Tests: add Rust coverage for manual -t task flow and tmux name builder","description":"Add missing Rust unit tests that cover two release-critical surfaces:\n\n1) Manual task flow (`trudger -t ...`)\n- Ensure manual tasks bypass `commands.next_task`.\n- Ensure not-ready manual tasks fail fast with a clear Quit reason.\n- Ensure ready manual tasks still execute solve/review + hooks correctly.\n\n2) tmux pane title formatting (`build_tmux_name`)\n- Validate base-name trimming behavior (`: fg` / `: codex`).\n- Validate COMPLETED/NEEDS_HUMAN segments and phase suffixes (SOLVING/REVIEWING/ERROR).\n\nThese tests should be â€œhonestâ€: drive behavior through the same command execution paths used in production (fixture binaries are fine), not by bypassing core logic.","acceptance_criteria":"Done when:\n- New unit test(s) cover manual `-t` tasks (both ready and not-ready cases) and assert the expected Quit code/reason and that `next-task` is not invoked.\n- New unit test(s) cover `build_tmux_name` formatting for at least: base trimming, completed list, needs-human list, and phase suffixes.\n- Quality gates pass: `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, `cargo test`.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-06T08:55:56.296813191Z","created_by":"mark","updated_at":"2026-02-06T10:49:07.234523848Z","closed_at":"2026-02-06T10:49:07.234508029Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-35l","depends_on_id":"tr-2vc","type":"blocks","created_at":"2026-02-06T09:33:26.672651523Z","created_by":"mark"},{"issue_id":"tr-35l","depends_on_id":"tr-obz","type":"parent-child","created_at":"2026-02-06T09:13:53.202035151Z","created_by":"mark"}]}
{"id":"tr-365","title":"Implement yq-based config loading and validation","description":"OpenSpec refs:\n- Requirement: Configuration loading â€” Scenario: Missing config file\n- Requirement: Configuration validation â€” Scenario: Required config value missing\n- Requirement: Configuration parsing â€” Scenario: Null config value\n- Requirement: Unknown config keys â€” Scenario: Unknown config key\n\nExpected outputs:\n- `trudger` loads `~/.config/trudger.yml` via `yq`.\n- Missing config file => non-zero exit with bootstrap instructions for sample configs.\n- Missing/empty required keys => non-zero exit naming the field.\n- Null required values => non-zero exit naming the field.\n- Unknown top-level keys => warning + continue startup.\n- Missing `yq` => non-zero exit with clear install/use guidance.\n\nValidation/tests:\n- Covered by new/updated BATS cases in the \"Extend tests\" task.\n\nSuccess criteria:\n- Config parsing/validation matches OpenSpec and errors are explicit and actionable.","acceptance_criteria":"Acceptance criteria: (1) Missing config file prints bootstrap instructions and exits non-zero. (2) Missing/empty required key errors with the field name. (3) Null required value errors with the field name. (4) Unknown top-level key logs a warning and continues. (5) Missing yq errors clearly and exits non-zero.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T05:24:58.550086753Z","created_by":"mark","updated_at":"2026-01-29T06:18:35.252988311Z","closed_at":"2026-01-29T06:18:35.252943644Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-365","depends_on_id":"tr-2mc","type":"parent-child","created_at":"2026-01-29T05:24:58.554800546Z","created_by":"mark"}]}
{"id":"tr-37d","title":"Rust logging parity","description":"OpenSpec refs:\\n- openspec/changes/refactor-trudger-rust-native/specs/trudger/spec.md Requirement: Rust logging parity (Scenario: Rust log format matches shell)\\n- openspec/changes/update-trudger-logging-and-parsing/specs/trudger/spec.md Requirement: Execution logging (Scenarios: Command logging includes full command; Log values include control characters)\\n- openspec/changes/update-trudger-logging-and-parsing/specs/trudger/spec.md Requirement: Error exit logging (Scenario: Unhandled error triggers quit)\\n\\nWork:\\n- Implement log_path handling and log entry format identical to shell implementation.\\n- Escape control characters in logged values and include full command strings/args.\\n- Ensure quit reasons are logged via the same path before exit.\\n\\nExpected outputs:\\n- Rust logs match shell format and escaping rules.\\n\\nValidation/tests:\\n- Tests compare Rust log lines against expected shell-format fixtures.\\n","acceptance_criteria":"1. When log_path is set, Rust logs use the same single-line format and control-character escaping as the shell implementation. (OpenSpec: Rust logging parity scenario.)\\n2. Command start/exit logs include full command strings/args and escape control characters. (OpenSpec: Execution logging scenarios.)\\n3. Quit reasons are logged via the quit path before exit. (OpenSpec: Error exit logging scenario.)\\n4. Tests validate log formatting and escaping against a known fixture.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T04:44:18.521759395Z","created_by":"mark","updated_at":"2026-02-05T03:14:37.880459965Z","closed_at":"2026-02-05T03:14:37.880443618Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-37d","depends_on_id":"tr-1bh","type":"blocks","created_at":"2026-02-04T04:44:18.552051220Z","created_by":"mark"},{"issue_id":"tr-37d","depends_on_id":"tr-3j8","type":"parent-child","created_at":"2026-02-04T04:44:18.547077833Z","created_by":"mark"}]}
{"id":"tr-3ay","title":"Use env var prompt context (no substitution)","description":"OpenSpec refs:\n- openspec/changes/update-trudger-logging-and-parsing/specs/trudger/spec.md Requirement: Prompt context via env vars\n  - Scenario: Task show output contains special characters\n\nExpected outputs:\n- Prompt templates are not substituted by Trudger.\n- Task show output is passed via TRUDGER_TASK_SHOW without mutation.\n- Agent commands receive TRUDGER_PROMPT/TRUDGER_REVIEW_PROMPT with prompt content.\n\nValidation/tests:\n- bats: \"task_show preserves ampersands and backslashes via TRUDGER_TASK_SHOW\" in tests/trudger_test.bats\n- bats tests/trudger_test.bats\n\nAcceptance criteria:\n- Agent commands receive prompt content via TRUDGER_PROMPT/TRUDGER_REVIEW_PROMPT.\n- TRUDGER_TASK_SHOW includes special characters exactly as returned.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-31T05:32:29.510262158Z","created_by":"mark","updated_at":"2026-02-05T00:50:10.399712059Z","closed_at":"2026-02-05T00:50:10.399695979Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-3ay","depends_on_id":"tr-2v7","type":"parent-child","created_at":"2026-01-31T05:32:29.514529962Z","created_by":"mark"}]}
{"id":"tr-3do","title":"Align docs and prompts with config + hook behavior","description":"OpenSpec refs:\n- Requirement: Configuration loading â€” Scenario: Missing config file\n- Requirement: Configuration validation â€” Scenario: Required config value missing\n- Requirement: Configuration parsing â€” Scenario: Null config value\n- Requirement: Unknown config keys â€” Scenario: Unknown config key\n- Requirement: Hook execution semantics â€” Scenario: Hook uses $1 substitution; Scenario: Hook without substitution\n- Requirement: Task selection â€” Scenario: No selectable tasks; Scenario: Task not ready is skipped\n- Requirement: Task closure on success â€” Scenario: Task closed after successful review\n- Requirement: Requires-human escalation â€” Scenario: Task still open after review\n- Requirement: Codex update verification â€” Scenario: Missing status after review\n\nExpected outputs:\n- `README.md` and `prompts/*.md` updated to document config path, required keys, `yq` dependency, unknown key warnings, hook semantics, review hook outcomes, status validation, and task selection behavior.\n\nValidation/tests:\n- Manual doc review for alignment with spec (no automated tests).\n\nSuccess criteria:\n- Docs accurately reflect the updated spec-driven behavior and config requirements.","acceptance_criteria":"Acceptance criteria: (1) README/prompts mention ~/.config/trudger.yml, required keys, and the yq dependency. (2) Docs explain unknown key warnings and hook argument/substitution rules. (3) Docs describe task selection outcomes and review hook behavior (completed vs requires human).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T05:26:39.110993238Z","created_by":"mark","updated_at":"2026-01-29T09:14:09.574087980Z","closed_at":"2026-01-29T09:14:09.574042590Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-3do","depends_on_id":"tr-1ta","type":"waits-for","created_at":"2026-01-29T05:26:39.118214886Z","created_by":"mark"},{"issue_id":"tr-3do","depends_on_id":"tr-2mc","type":"parent-child","created_at":"2026-01-29T05:26:39.115214224Z","created_by":"mark"},{"issue_id":"tr-3do","depends_on_id":"tr-365","type":"waits-for","created_at":"2026-01-29T05:26:39.116680550Z","created_by":"mark"}]}
{"id":"tr-3hr","title":"Require commands.next_task in config","description":"Validate commands.next_task; produce migration error if missing; update docs/tests.","acceptance_criteria":"Criteria: commands.next_task is required when no manual task IDs; missing/empty next_task errors with migration guidance; when manual IDs provided, missing/empty next_task logs warning only; empty strings count as missing.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-30T02:50:13.654540883Z","created_by":"mark","updated_at":"2026-02-04T02:02:43.133324974Z","closed_at":"2026-02-04T02:02:43.133280567Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-3hr","depends_on_id":"tr-1xw","type":"blocks","created_at":"2026-01-30T02:50:14.015579874Z","created_by":"mark"},{"issue_id":"tr-3hr","depends_on_id":"tr-26e","type":"parent-child","created_at":"2026-01-30T02:50:13.660206521Z","created_by":"mark"}]}
{"id":"tr-3ii","title":"Handle invalid YAML config parse errors","description":"OpenSpec refs:\n- openspec/specs/trudger/spec.md Requirement: Configuration parsing\n  - Scenario: Config parse failure\n\nExpected outputs:\n- Detect invalid YAML during config load.\n- Exit non-zero with an error that includes the config path.\n- Do not fall through to missing-key validation on parse failure.\n\nValidation/tests:\n- bats: \"invalid yaml prints parse error\" in tests/trudger_test.bats\n- bats tests/trudger_test.bats\n\nAcceptance criteria:\n- Running trudger with an invalid YAML config exits non-zero.\n- Error output includes the config path and a parse-failure message.\n- No subsequent validation errors are emitted after parse failure.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-31T05:32:22.181649511Z","created_by":"mark","updated_at":"2026-02-05T00:47:20.762383928Z","closed_at":"2026-02-05T00:47:20.762367610Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-3ii","depends_on_id":"tr-2v7","type":"parent-child","created_at":"2026-01-31T05:32:22.185682973Z","created_by":"mark"}]}
{"id":"tr-3j8","title":"Refactor Trudger Rust Implementation (side-by-side)","description":"OpenSpec change: openspec/changes/refactor-trudger-rust-native.\\n\\nGoals:\\n- Add a Rust-native Trudger binary built via Cargo (release output under target/release) alongside the shell script.\\n- Implement native YAML config parsing (no yq/jq) in Rust.\\n- Use an in-process task loop (no re-exec).\\n- Match hook execution semantics and log format parity with the shell implementation.\\n\\nScope:\\n- Rust CLI, config parsing/validation, task loop, hook execution, logging, and tests/validation.","acceptance_criteria":"1. Rust binary exists under target/release (e.g., target/release/trudger) and is executable. (OpenSpec: Rust entrypoint requirement, scenario: Rust entrypoint is executable.)\n2. Rust config parsing uses native YAML, treats nulls as errors, and does not rely on yq/jq. (OpenSpec: Rust configuration parsing requirement and scenarios.)\n3. Config validation requires `agent_command` and `agent_review_command` (no `codex_command`). (OpenSpec: Configuration validation requirement.)\n4. Rust implementation uses an in-process loop with no re-exec between tasks. (OpenSpec: Rust in-process loop requirement.)\n5. Hook execution semantics match shell via `TRUDGER_*` env vars with no positional task args. (OpenSpec: Rust hook execution parity requirement and scenarios.)\n6. Rust log format matches shell log format and escaping rules when log_path is set. (OpenSpec: Rust logging parity requirement and scenario.)\n7. Validation runs: cargo test + smoke run with sample_configuration/*.yml using the release binary.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-02-04T04:42:30.713355361Z","created_by":"mark","updated_at":"2026-02-05T01:21:08.015263648Z","closed_at":"2026-02-05T01:21:08.015245899Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-3j8","depends_on_id":"tr-2v7","type":"blocks","created_at":"2026-02-04T05:05:48.112930995Z","created_by":"mark"}]}
{"id":"tr-3ul","title":"Document config flag and sample configs","description":"OpenSpec refs:\n- Requirement: Config flag override â€” Scenario: provided config path used\n- Requirement: Sample config files â€” Scenario: sample configs available in repo\n\nExpected outputs:\n- `README.md` documents `-c/--config` usage and that it overrides the default path.\n- `README.md` references both sample configuration files and their purposes.\n\nValidation/tests:\n- Manual doc review for alignment with OpenSpec behavior.\n\nSuccess criteria:\n- Docs clearly instruct how to use the flag and where to find sample configs.","acceptance_criteria":"Acceptance criteria: (1) README explains -c/--config override behavior. (2) README lists both sample configuration files and intended usage.","notes":"Ready to close: README documents -c/--config override and sample configs; bats tests passed (bats tests/trudger_test.bats). bd close failed with parent-blocked (tr-jyr).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T06:05:52.433639948Z","created_by":"mark","updated_at":"2026-01-30T01:58:46.172910001Z","closed_at":"2026-01-30T01:58:46.172859046Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-3ul","depends_on_id":"tr-1hl","type":"waits-for","created_at":"2026-01-29T06:05:52.441561070Z","created_by":"mark"},{"issue_id":"tr-3ul","depends_on_id":"tr-jyr","type":"parent-child","created_at":"2026-01-29T06:05:52.438003805Z","created_by":"mark"},{"issue_id":"tr-3ul","depends_on_id":"tr-rg8","type":"waits-for","created_at":"2026-01-29T06:05:52.439767840Z","created_by":"mark"}]}
{"id":"tr-3vq","title":"Sanitize log output for quit reasons and commands","description":"Strip control characters and avoid leaking secrets; align log_transition usage with new sanitization.","acceptance_criteria":"Criteria: log output escapes/strips control characters to prevent corruption; full command strings remain logged with no redaction; quit reasons sanitized with the same control-char handling.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-30T02:50:13.550357230Z","created_by":"mark","updated_at":"2026-01-31T13:36:27.586265731Z","closed_at":"2026-01-31T13:36:27.586222352Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-3vq","depends_on_id":"tr-1g8","type":"blocks","created_at":"2026-01-30T02:50:13.954216109Z","created_by":"mark"},{"issue_id":"tr-3vq","depends_on_id":"tr-26e","type":"parent-child","created_at":"2026-01-30T02:50:13.556065749Z","created_by":"mark"}]}
{"id":"tr-5xj","title":"Release polish + doctor foundations","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-02-05T13:18:10.371756465Z","created_by":"mark","updated_at":"2026-02-06T15:36:10.105496948Z","closed_at":"2026-02-06T15:36:10.105480126Z","close_reason":"All child tasks completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["human_required"]}
{"id":"tr-5xj.1","title":"Respect review_loop_limit; mark human+blocked on exhaustion","description":"Use review_loop_limit to rerun solve/review until closed or limit reached. On limit reached, mark needs-human and blocked (likely via hooks/config) and move on. Add/adjust tests.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T13:18:26.141892877Z","created_by":"mark","updated_at":"2026-02-06T06:59:48.596649059Z","closed_at":"2026-02-06T06:59:48.596632399Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-5xj.1","depends_on_id":"tr-5xj","type":"parent-child","created_at":"2026-02-05T13:18:26.141892877Z","created_by":"mark"}]}
{"id":"tr-5xj.2","title":"Make log_path optional in config/validation","description":"Allow missing/empty log_path (Logger::new(None)), update validation, docs, and tests accordingly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T13:18:29.185563887Z","created_by":"mark","updated_at":"2026-02-06T07:20:20.890887118Z","closed_at":"2026-02-06T07:20:20.890870413Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-5xj.2","depends_on_id":"tr-5xj","type":"parent-child","created_at":"2026-02-05T13:18:29.185563887Z","created_by":"mark"}]}
{"id":"tr-5xj.3","title":"Document reset_task + sample config conformance tests","description":"Ensure README example includes commands.reset_task and add automated conformance tests for sample configs (load_config + required keys).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T13:18:33.037109299Z","created_by":"mark","updated_at":"2026-02-06T08:15:06.387870841Z","closed_at":"2026-02-06T08:15:06.387854080Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-5xj.3","depends_on_id":"tr-5xj","type":"parent-child","created_at":"2026-02-05T13:18:33.037109299Z","created_by":"mark"}]}
{"id":"tr-5xj.4","title":"Add doctor scratch-db hook + sample config reset from issues.jsonl","description":"Introduce hooks.on_doctor_setup for doctor mode scratch DB setup. trudger doctor creates a temp scratch dir, runs the setup hook from the invocation CWD with TRUDGER_DOCTOR_SCRATCH_DIR set, then cleans up the scratch dir (fail hard if cleanup fails). Sample configs include an example setup hook.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T13:18:40.544926104Z","created_by":"mark","updated_at":"2026-02-06T03:29:45.985056180Z","closed_at":"2026-02-06T03:29:45.985037972Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-5xj.4","depends_on_id":"tr-5xj","type":"parent-child","created_at":"2026-02-05T13:18:40.544926104Z","created_by":"mark"}]}
{"id":"tr-5xj.5","title":"Implement trudger doctor checks using scratch DB","description":"Add a doctor subcommand that runs configured commands against the scratch DB, verifying command availability, task_show/status/update/reset/hook behavior and ready/closed parsing. Depends on new scratch-db hook.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-05T13:18:44.389599864Z","created_by":"mark","updated_at":"2026-02-06T07:56:19.207713360Z","closed_at":"2026-02-06T07:56:19.207679146Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-5xj.5","depends_on_id":"tr-5xj","type":"parent-child","created_at":"2026-02-05T13:18:44.389599864Z","created_by":"mark"},{"issue_id":"tr-5xj.5","depends_on_id":"tr-5xj.4","type":"blocks","created_at":"2026-02-05T13:19:02.338654120Z","created_by":"mark"}]}
{"id":"tr-5xj.6","title":"Warn on unknown nested config keys (commands/hooks)","description":"Extend config linting to flag unknown keys under commands/hooks (typo detection). Decide whether warnings are emitted at load_config or via doctor.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T13:18:47.720216276Z","created_by":"mark","updated_at":"2026-02-06T08:31:50.785939473Z","closed_at":"2026-02-06T08:31:50.785920471Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-5xj.6","depends_on_id":"tr-5xj","type":"parent-child","created_at":"2026-02-05T13:18:47.720216276Z","created_by":"mark"}]}
{"id":"tr-5xj.7","title":"Decide packaging/tests for Rust canonical vs bash wrapper","description":"Clarify release stance: install Rust binary instead of bash wrapper, and adjust tests accordingly (minimize bash coverage if Rust is canonical).","status":"closed","priority":4,"issue_type":"task","created_at":"2026-02-05T13:18:57.755439205Z","created_by":"mark","updated_at":"2026-02-06T15:36:10.036788179Z","closed_at":"2026-02-06T15:36:10.036769739Z","close_reason":"Decided: Rust binary installed via cargo install; legacy bash moved to historical/","source_repo":".","compaction_level":0,"original_size":0,"labels":["human_required"],"dependencies":[{"issue_id":"tr-5xj.7","depends_on_id":"tr-5xj","type":"parent-child","created_at":"2026-02-05T13:18:57.755439205Z","created_by":"mark"}]}
{"id":"tr-5xj.8","title":"Refactor CLI args: subcommands + -t manual tasks","description":"Implement refactor-trudger-cli-args: add subcommand parsing (doctor) and move manual task ids to -t/--task with repeated+comma-separated support; reject positional task ids with migration hint.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-06T02:42:57.705766681Z","created_by":"mark","updated_at":"2026-02-06T03:29:46.106461831Z","closed_at":"2026-02-06T03:29:46.106445385Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-5xj.8","depends_on_id":"tr-5xj","type":"parent-child","created_at":"2026-02-06T02:42:57.705766681Z","created_by":"mark"}]}
{"id":"tr-5xj.9","title":"Complete Rust migration (shim + install + tests)","description":"Implement openspec/changes/complete-trudger-rust-migration/: make Rust binary the default runtime, convert repo-root ./trudger to a thin shim, update install/docs/tests/tooling.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-06T05:27:57.000630933Z","created_by":"mark","updated_at":"2026-02-06T15:36:10.070835056Z","closed_at":"2026-02-06T15:36:10.070818040Z","close_reason":"Implemented: rust is default (shim + cargo install docs), legacy bash moved to historical, CI/hooks updated","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-5xj.9","depends_on_id":"tr-5xj","type":"parent-child","created_at":"2026-02-06T05:27:57.000630933Z","created_by":"mark"},{"issue_id":"tr-5xj.9","depends_on_id":"tr-5xj.7","type":"blocks","created_at":"2026-02-06T05:28:03.650440050Z","created_by":"mark"}]}
{"id":"tr-7vm","title":"Rust config parsing + validation","description":"OpenSpec refs:\n- openspec/changes/refactor-trudger-rust-native/specs/trudger/spec.md Requirement: Rust configuration parsing (Scenarios: null value; parse failure; no yq/jq)\n- openspec/specs/trudger/spec.md Requirement: Configuration validation (Scenario: Required config value missing)\n- openspec/specs/trudger/spec.md Requirement: Unknown config keys (Scenario: Unknown config key)\n\nWork:\n- Implement native YAML parsing into typed schema.\n- Validate required fields and nulls; emit clear error naming field.\n- Warn on unknown top-level keys to stderr and continue.\n- Ensure no yq/jq invocation for config loading in Rust.\n\nExpected outputs:\n- Config loads via serde/serde_yaml with explicit validation and warnings.\n\nValidation/tests:\n- Unit tests for missing required fields, nulls, invalid YAML, and unknown keys.","acceptance_criteria":"1. Rust config parsing uses native YAML and does not call yq/jq. (OpenSpec: Rust configuration parsing scenario: no yq/jq.)\n2. Null required values error with field name. (OpenSpec: Rust configuration parsing scenario: null config value.)\n3. Invalid YAML errors non-zero with config path in message. (OpenSpec: Rust configuration parsing scenario: parse failure.)\n4. Missing required fields error with field name, including `agent_command` and `agent_review_command`. (OpenSpec: Configuration validation scenario.)\n5. Unknown top-level keys emit warnings to stderr and continue. (OpenSpec: Unknown config keys scenario.)\n6. Unit tests cover nulls, missing fields, invalid YAML, and unknown keys.","notes":"Blocked from closing because parent tr-3j8 is parent-blocked. Implementation and tests appear complete, but close is skipped by beads. Need guidance on whether to leave open or change dependency/parent status.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T04:43:16.029202057Z","created_by":"mark","updated_at":"2026-02-05T02:47:59.898795090Z","closed_at":"2026-02-05T02:47:59.898778337Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-7vm","depends_on_id":"tr-1nf","type":"blocks","created_at":"2026-02-04T04:43:16.035054985Z","created_by":"mark"},{"issue_id":"tr-7vm","depends_on_id":"tr-3j8","type":"parent-child","created_at":"2026-02-04T04:43:16.033348475Z","created_by":"mark"}],"comments":[{"id":2,"issue_id":"tr-7vm","author":"Mark Wotton","text":"Closure blocked: beads reports parent tr-3j8 is parent-blocked. Should I leave this task open until the parent unblocks, or update dependencies so it can close?","created_at":"2026-02-04T06:33:35Z"}]}
{"id":"tr-bpp","title":"Add regression tests for env-var prompt context, command exec, log sanitization, and required next_task","description":"Cover updated semantics and failure modes in Bats for env-var contract and agent commands.\n\nExpected outputs:\n- Tests cover TRUDGER_PROMPT/TRUDGER_REVIEW_PROMPT and TRUDGER_TASK_SHOW usage.\n- Tests cover commands execution without positional task args (env vars only).\n- Tests cover log sanitization and commands.next_task missing/empty behavior for manual vs non-manual flows.\n\nValidation/tests:\n- bats tests/trudger_test.bats\n\nAcceptance criteria:\n- Tests assert env-var prompt context (no $ARGUMENTS/$TASK_SHOW substitution).\n- TRUDGER_TASK_SHOW preserves special characters.\n- Commands run via configured command strings and use env vars for task context.\n- Log sanitization of control chars is covered.\n- commands.next_task missing/empty behavior covered.","acceptance_criteria":"Criteria: tests cover $ARGUMENTS = task id (not task_show JSON), prompt embeds task_show output, bash -lc command execution for shell syntax, log sanitization of control chars (no redaction), and commands.next_task missing/empty behavior for manual vs non-manual flows.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-30T02:50:13.754574217Z","created_by":"mark","updated_at":"2026-02-05T01:36:20.376660965Z","closed_at":"2026-02-05T01:36:20.376644571Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-bpp","depends_on_id":"tr-1g8","type":"blocks","created_at":"2026-01-30T02:50:14.179179391Z","created_by":"mark"},{"issue_id":"tr-bpp","depends_on_id":"tr-1xw","type":"blocks","created_at":"2026-01-30T02:50:14.085429740Z","created_by":"mark"},{"issue_id":"tr-bpp","depends_on_id":"tr-26e","type":"parent-child","created_at":"2026-01-30T02:50:13.760613144Z","created_by":"mark"},{"issue_id":"tr-bpp","depends_on_id":"tr-3hr","type":"blocks","created_at":"2026-01-30T02:50:14.369436767Z","created_by":"mark"},{"issue_id":"tr-bpp","depends_on_id":"tr-3vq","type":"blocks","created_at":"2026-01-30T02:50:14.262303050Z","created_by":"mark"}]}
{"id":"tr-dr8","title":"Implement OpenSpec: add-notification-hook-modes","description":"OpenSpec change: `add-notification-hook-modes`.\n\nGoals:\n- Add optional `hooks.on_notification` with configurable scope (`all_logs`, `task_boundaries`, `run_boundaries`).\n- Emit notification payloads containing duration, folder, task context, redacted log message data, and run exit code.\n- Keep notification hook failures non-fatal while preventing recursion in `all_logs` mode.\n\nScope:\n- Config parsing/validation updates.\n- Notification dispatch/event emission in run loop.\n- Payload/env contract updates (including truncation alignment).\n- Wizard/template/docs updates for new config keys.\n- Tests and quality/validation gates.\n\nOpenSpec references:\n- MODIFIED Requirement: Configuration validation (`hooks.on_notification*` behavior).\n- ADDED Requirement: Optional notification hook dispatch.\n- ADDED Requirement: Notification payload contract.","acceptance_criteria":"Done when OpenSpec add-notification-hook-modes is fully implemented: notification scopes and dispatch semantics match spec scenarios, TRUDGER_NOTIFY payload contract (including redaction and run_end exit code) is delivered, run_end is emitted at absolute end of task-processing teardown with best-effort coverage across all termination paths that can run user code, quality gates plus strict openspec validation pass, and evidence of passing commands/tests is recorded in descendant issue notes before epic closure.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-02-12T02:14:56.233356746Z","created_by":"mark","updated_at":"2026-02-12T03:31:45.826394051Z","closed_at":"2026-02-12T03:31:45.826375764Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["add-notification-hook-modes","notifications","openspec"]}
{"id":"tr-dr8.1","title":"Add notification config schema and validation behavior","description":"OpenSpec refs: MODIFIED Requirement 'Configuration validation'; scenarios 'Invalid notification scope errors' and 'Notification scope without hook warns and is ignored'. Expected outputs: add optional hooks.on_notification + hooks.on_notification_scope parse/validation with default scope task_boundaries only when hook is set; warn+ignore scope when hook missing. Validation: unit tests for valid/invalid scope and scope-without-hook warning behavior. Success: startup behavior matches OpenSpec scenarios exactly.","acceptance_criteria":"Acceptance: hooks.on_notification is optional but non-empty when set; hooks.on_notification_scope accepts only all_logs|task_boundaries|run_boundaries; invalid scope errors with field name; when hook is set and scope is omitted the effective scope defaults to task_boundaries; scope-without-hook continues startup with a warning (substring-check for hooks.on_notification_scope + ignored is sufficient) and no dispatch.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-12T02:16:31.387497738Z","created_by":"mark","updated_at":"2026-02-12T02:44:40.931423287Z","closed_at":"2026-02-12T02:44:40.931402432Z","close_reason":"Reviewed: config schema/validation and tests satisfy acceptance criteria","source_repo":".","compaction_level":0,"original_size":0,"labels":["add-notification-hook-modes","config","openspec"],"dependencies":[{"issue_id":"tr-dr8.1","depends_on_id":"tr-dr8","type":"parent-child","created_at":"2026-02-12T02:16:31.387497738Z","created_by":"mark"}]}
{"id":"tr-dr8.10","title":"Run quality gates for notification-hook changes","description":"OpenSpec refs: change task mapping 5.2. Expected outputs: run project quality gates for notification-hook changes: cargo nextest run (preferred) or cargo test fallback, plus fmt/clippy per repo standards. Validation: capture successful gate runs and note any fallback use. Success: CI-equivalent quality checks are green for this change.","acceptance_criteria":"Acceptance: cargo fmt --check passes; cargo clippy --all-targets -- -D warnings passes; cargo nextest run passes (or cargo test fallback only when nextest unavailable, with fallback documented in issue notes before closure).","notes":"2026-02-12 quality gates executed successfully for add-notification-hook-modes task 5.2:\\n- cargo fmt --check (pass)\\n- cargo clippy --all-targets -- -D warnings (pass)\\n- cargo nextest run (pass; 351 passed, 0 failed, no fallback required).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-12T02:17:26.669647980Z","created_by":"mark","updated_at":"2026-02-12T03:24:47.397745748Z","closed_at":"2026-02-12T03:24:47.397720648Z","close_reason":"Acceptance criteria verified in review: fmt/clippy/nextest all passing; no fallback needed.","source_repo":".","compaction_level":0,"original_size":0,"labels":["add-notification-hook-modes","openspec","quality"],"dependencies":[{"issue_id":"tr-dr8.10","depends_on_id":"tr-dr8","type":"parent-child","created_at":"2026-02-12T02:17:26.669647980Z","created_by":"mark"},{"issue_id":"tr-dr8.10","depends_on_id":"tr-dr8.9","type":"blocks","created_at":"2026-02-12T02:17:26.669647980Z","created_by":"mark"}]}
{"id":"tr-dr8.11","title":"Run strict OpenSpec validation for add-notification-hook-modes","description":"OpenSpec refs: change task mapping 5.3. Expected outputs: strict OpenSpec validation passes after implementation/doc updates: openspec validate add-notification-hook-modes --strict --no-interactive. Validation: run command and resolve any issues before close. Success: no OpenSpec validation errors remain.","acceptance_criteria":"Acceptance: openspec validate add-notification-hook-modes --strict --no-interactive exits successfully and any intermediate validation failures are resolved before closure.","notes":"2026-02-12: Ran openspec validate add-notification-hook-modes --strict --no-interactive; exit 0, no validation errors.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-12T02:17:32.430140024Z","created_by":"mark","updated_at":"2026-02-12T03:27:22.890605732Z","closed_at":"2026-02-12T03:27:22.890562632Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["add-notification-hook-modes","openspec","validation"],"dependencies":[{"issue_id":"tr-dr8.11","depends_on_id":"tr-dr8","type":"parent-child","created_at":"2026-02-12T02:17:32.430140024Z","created_by":"mark"},{"issue_id":"tr-dr8.11","depends_on_id":"tr-dr8.10","type":"blocks","created_at":"2026-02-12T02:34:51.274683647Z","created_by":"mark"},{"issue_id":"tr-dr8.11","depends_on_id":"tr-dr8.9","type":"blocks","created_at":"2026-02-12T02:17:32.430140024Z","created_by":"mark"}]}
{"id":"tr-dr8.2","title":"Implement notification dispatcher core and fail-open semantics","description":"OpenSpec refs: ADDED Requirement 'Optional notification hook dispatch'; scenarios 'Notification hook omitted' and 'Notification failures are non-fatal'. Expected outputs: notification dispatcher executes hooks.on_notification with no positional args, no-op when hook missing, and fail-open warning/transition on spawn/exit failure. Validation: tests for missing-hook no-op plus failure paths that continue run loop. Success: notification execution failures never abort task processing.","acceptance_criteria":"Acceptance: notification hook runs without positional args; missing hook produces zero invocations; non-zero exit/spawn failures do not abort processing; failure is surfaced via warning/transition.","notes":"Implemented runtime wiring for notification dispatcher core in src/run_loop.rs by invoking dispatch_notification_hook at task terminal transitions (closed/blocked paths) so hooks.on_notification now executes in task-processing flow. Existing helper behavior retained: no positional args, missing/empty hook no-op, fail-open warning+transition on non-zero/spawn failure. Added run-loop integration test run_loop_continues_when_notification_hook_fails to prove processing continues and task completes despite notification exit=7. Validation: cargo test run_loop::tests::dispatch_notification_hook -- --nocapture; cargo test run_loop::tests::run_loop_continues_when_notification_hook_fails -- --nocapture; cargo nextest run run_loop_continues_when_notification_hook_fails. Commit: 9120a63.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-12T02:16:36.972422920Z","created_by":"mark","updated_at":"2026-02-12T02:52:16.714606867Z","closed_at":"2026-02-12T02:52:16.714564183Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["add-notification-hook-modes","openspec","run-loop"],"dependencies":[{"issue_id":"tr-dr8.2","depends_on_id":"tr-dr8","type":"parent-child","created_at":"2026-02-12T02:16:36.972422920Z","created_by":"mark"},{"issue_id":"tr-dr8.2","depends_on_id":"tr-dr8.1","type":"blocks","created_at":"2026-02-12T02:16:36.972422920Z","created_by":"mark"}]}
{"id":"tr-dr8.3","title":"Add run/task boundary notification events","description":"OpenSpec refs: ADDED Requirement 'Optional notification hook dispatch'; scenarios 'Task boundary notifications', 'Run boundary notifications', and 'Notification hook is run-mode only'. Expected outputs: emit run_start/run_end/task_start/task_end at specified trigger points and suppress notifications in wizard/doctor modes. Validation: tests for each trigger and for non-trigger in doctor/wizard. Success: deterministic boundary events per spec.","acceptance_criteria":"Acceptance: run_start/run_end/task_start/task_end timing matches OpenSpec; run_end is emitted exactly once at absolute end of teardown for each handled exit path (idle/no-task success, interrupt/130, handled termination signals, and task-processing error exits); no notification dispatch occurs in wizard or doctor mode.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-12T02:16:42.415767467Z","created_by":"mark","updated_at":"2026-02-12T03:00:00.729311164Z","closed_at":"2026-02-12T03:00:00.729275378Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["add-notification-hook-modes","events","openspec"],"dependencies":[{"issue_id":"tr-dr8.3","depends_on_id":"tr-dr8","type":"parent-child","created_at":"2026-02-12T02:16:42.415767467Z","created_by":"mark"},{"issue_id":"tr-dr8.3","depends_on_id":"tr-dr8.2","type":"blocks","created_at":"2026-02-12T02:16:42.415767467Z","created_by":"mark"}]}
{"id":"tr-dr8.4","title":"Implement all_logs notification mode with recursion guard","description":"OpenSpec refs: ADDED Requirement 'Optional notification hook dispatch'; scenarios 'All-log notifications', 'All-log notifications still run with log file disabled', and 'Notification failure does not recurse in all_logs mode'. Expected outputs: implement all_logs scope dispatch per transition message, independent of log_path file logging, with recursion guard for notification-generated transitions. Validation: tests for log_path disabled and non-recursive failure handling. Success: high-volume mode is correct and bounded.","acceptance_criteria":"Acceptance: all_logs dispatches per transition message even when log_path is empty; notification failure transitions do not trigger recursive notification dispatch; behavior covered by tests.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-12T02:16:48.114957691Z","created_by":"mark","updated_at":"2026-02-12T03:04:33.451279806Z","closed_at":"2026-02-12T03:04:33.451248839Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["add-notification-hook-modes","logging","openspec"],"dependencies":[{"issue_id":"tr-dr8.4","depends_on_id":"tr-dr8","type":"parent-child","created_at":"2026-02-12T02:16:48.114957691Z","created_by":"mark"},{"issue_id":"tr-dr8.4","depends_on_id":"tr-dr8.2","type":"blocks","created_at":"2026-02-12T02:16:48.114957691Z","created_by":"mark"}]}
{"id":"tr-dr8.5","title":"Implement TRUDGER_NOTIFY payload fields and duration/exit semantics","description":"OpenSpec refs: ADDED Requirement 'Notification payload contract'; scenarios 'Task notification includes required fields', 'Run and task start durations are zero', 'Run end payload includes exit code', 'Non-run-end payload has empty exit code', and 'Notification payload values are truncated when oversized'. Expected outputs: implement TRUDGER_NOTIFY_EVENT/DURATION_MS/FOLDER/EXIT_CODE/TASK_ID/TASK_DESCRIPTION semantics plus context inheritance and truncation behavior alignment. Validation: tests for duration rules, exit-code behavior, and oversized payload truncation. Success: payload contract is deterministic and robust.","acceptance_criteria":"Acceptance: required TRUDGER_NOTIFY fields are present with event-specific values; log-event duration is measured since run_start; TRUDGER_NOTIFY_EXIT_CODE is set only for run_end and is empty-string for other events; run_end payload reflects final post-teardown state; notification hooks also receive existing TRUDGER_* context; oversized notify env values are truncated at UTF-8 boundaries with expected warnings/transitions.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-12T02:16:54.820694849Z","created_by":"mark","updated_at":"2026-02-12T03:11:37.688624611Z","closed_at":"2026-02-12T03:11:37.688500868Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["add-notification-hook-modes","openspec","payload"],"dependencies":[{"issue_id":"tr-dr8.5","depends_on_id":"tr-dr8","type":"parent-child","created_at":"2026-02-12T02:16:54.820694849Z","created_by":"mark"},{"issue_id":"tr-dr8.5","depends_on_id":"tr-dr8.3","type":"blocks","created_at":"2026-02-12T02:16:54.820694849Z","created_by":"mark"},{"issue_id":"tr-dr8.5","depends_on_id":"tr-dr8.4","type":"blocks","created_at":"2026-02-12T02:30:46.735593417Z","created_by":"mark"}]}
{"id":"tr-dr8.6","title":"Derive notification task description from task_show output","description":"OpenSpec refs: ADDED Requirement 'Notification payload contract'; scenario 'Task description extracted from task_show output'. Expected outputs: derive TRUDGER_NOTIFY_TASK_DESCRIPTION from first non-empty trimmed line of most recent commands.task_show output; empty fallback when unavailable. Validation: tests for multiline, whitespace-only, and missing task_show outputs. Success: description extraction rule is stable and spec-compliant.","acceptance_criteria":"Acceptance: TRUDGER_NOTIFY_TASK_DESCRIPTION uses first non-empty trimmed line from latest task_show output; empty or unavailable task_show yields empty description; extraction behavior has deterministic tests.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-12T02:17:00.550851701Z","created_by":"mark","updated_at":"2026-02-12T03:18:05.397163133Z","closed_at":"2026-02-12T03:18:05.397143471Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["add-notification-hook-modes","openspec","payload"],"dependencies":[{"issue_id":"tr-dr8.6","depends_on_id":"tr-dr8","type":"parent-child","created_at":"2026-02-12T02:17:00.550851701Z","created_by":"mark"},{"issue_id":"tr-dr8.6","depends_on_id":"tr-dr8.3","type":"blocks","created_at":"2026-02-12T02:17:00.550851701Z","created_by":"mark"}]}
{"id":"tr-dr8.7","title":"Redact command and args values in all_logs notification message payloads","description":"OpenSpec refs: ADDED Requirement 'Notification payload contract'; scenarios 'All-log payload includes transition message' and 'All-log payload redacts command and args fields'. Expected outputs: in all_logs mode, set TRUDGER_NOTIFY_MESSAGE from transition text with command= and args= values replaced by [REDACTED], preserving control-char escaping consistency. Validation: tests for redaction correctness and non-target field preservation. Success: no raw command/args values leak via notification message payload.","acceptance_criteria":"Acceptance: TRUDGER_NOTIFY_MESSAGE is emitted in all_logs mode and redacts command= and args= values to [REDACTED]; output is deterministic within this version and covered by automated tests, but redaction formatting is not treated as a cross-version compatibility contract.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-12T02:17:07.117397825Z","created_by":"mark","updated_at":"2026-02-12T03:12:42.271133635Z","closed_at":"2026-02-12T03:12:42.271115141Z","close_reason":"Completed; all_logs TRUDGER_NOTIFY_MESSAGE redacts command/args with tests passing","source_repo":".","compaction_level":0,"original_size":0,"labels":["add-notification-hook-modes","openspec","security"],"dependencies":[{"issue_id":"tr-dr8.7","depends_on_id":"tr-dr8","type":"parent-child","created_at":"2026-02-12T02:17:07.117397825Z","created_by":"mark"},{"issue_id":"tr-dr8.7","depends_on_id":"tr-dr8.4","type":"blocks","created_at":"2026-02-12T02:17:07.117397825Z","created_by":"mark"}]}
{"id":"tr-dr8.8","title":"Update wizard/templates/docs for notification keys","description":"OpenSpec refs: MODIFIED Requirement 'Configuration validation' (new keys as known config fields) and change tasks 1.3 + 4.1/4.2. Expected outputs: update known-key allowlists and wizard/template round-trip for hooks.on_notification and hooks.on_notification_scope; update README/sample config docs with scope examples and payload notes; coordinate merge with add-trudger-wizard-prompt-install if overlapping files conflict. Validation: wizard/config parsing tests and docs/sample config sanity parse checks. Success: notification keys are first-class across config tooling/docs.","acceptance_criteria":"Acceptance: no unknown-key warnings for hooks.on_notification* in expected paths; wizard/template flows preserve/round-trip notification keys; README/sample docs include scope usage and payload guidance.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-12T02:17:12.878435854Z","created_by":"mark","updated_at":"2026-02-12T03:15:57.371883936Z","closed_at":"2026-02-12T03:15:57.371862462Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["add-notification-hook-modes","docs","openspec","wizard"],"dependencies":[{"issue_id":"tr-dr8.8","depends_on_id":"tr-dr8","type":"parent-child","created_at":"2026-02-12T02:17:12.878435854Z","created_by":"mark"},{"issue_id":"tr-dr8.8","depends_on_id":"tr-dr8.1","type":"blocks","created_at":"2026-02-12T02:17:12.878435854Z","created_by":"mark"},{"issue_id":"tr-dr8.8","depends_on_id":"tr-dr8.3","type":"blocks","created_at":"2026-02-12T02:30:46.594577879Z","created_by":"mark"},{"issue_id":"tr-dr8.8","depends_on_id":"tr-dr8.4","type":"blocks","created_at":"2026-02-12T02:30:46.643937637Z","created_by":"mark"},{"issue_id":"tr-dr8.8","depends_on_id":"tr-dr8.5","type":"blocks","created_at":"2026-02-12T02:30:46.691271812Z","created_by":"mark"}]}
{"id":"tr-dr8.9","title":"Add comprehensive tests for notification scopes, payloads, and failure handling","description":"OpenSpec refs: all three delta requirements and their scenarios. Expected outputs: add/expand tests for config behavior, scope dispatch behavior, all_logs recursion guard, payload fields (including TRUDGER_NOTIFY_EXIT_CODE), redaction behavior, and fail-open handling. Validation: run test suite with new regression coverage. Success: OpenSpec scenario regressions are caught by deterministic automated tests.","acceptance_criteria":"Acceptance: tests explicitly cover OpenSpec scenarios for config, dispatch, and payload requirements; tests verify fail-open plus non-recursive all_logs failure handling; tests verify redaction and TRUDGER_NOTIFY_EXIT_CODE semantics.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-12T02:17:21.315299740Z","created_by":"mark","updated_at":"2026-02-12T03:22:10.147988929Z","closed_at":"2026-02-12T03:22:10.147970395Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["add-notification-hook-modes","openspec","tests"],"dependencies":[{"issue_id":"tr-dr8.9","depends_on_id":"tr-dr8","type":"parent-child","created_at":"2026-02-12T02:17:21.315299740Z","created_by":"mark"},{"issue_id":"tr-dr8.9","depends_on_id":"tr-dr8.3","type":"blocks","created_at":"2026-02-12T02:34:51.239120010Z","created_by":"mark"},{"issue_id":"tr-dr8.9","depends_on_id":"tr-dr8.5","type":"blocks","created_at":"2026-02-12T02:17:21.315299740Z","created_by":"mark"},{"issue_id":"tr-dr8.9","depends_on_id":"tr-dr8.6","type":"blocks","created_at":"2026-02-12T02:17:21.315299740Z","created_by":"mark"},{"issue_id":"tr-dr8.9","depends_on_id":"tr-dr8.7","type":"blocks","created_at":"2026-02-12T02:17:21.315299740Z","created_by":"mark"},{"issue_id":"tr-dr8.9","depends_on_id":"tr-dr8.8","type":"blocks","created_at":"2026-02-12T02:17:21.315299740Z","created_by":"mark"}]}
{"id":"tr-eeu","title":"Rust tmux updates (rough parity)","description":"OpenSpec refs:\\n- openspec/changes/refactor-trudger-rust-native/tasks.md item 1.6 (tmux updates with roughly equivalent semantics)\\n- openspec/specs/trudger/spec.md (tmux behavior implied by current shell implementation)\\n\\nWork:\\n- Implement tmux pane title updates in Rust when running under tmux.\\n- Match shell semantics roughly (SOLVING/REVIEWING/ERROR phases, completed/needs-human summaries), but exact parity is not required.\\n- No-op when not in tmux or tmux is unavailable.\\n\\nExpected outputs:\\n- tmux pane title updates during task processing with roughly equivalent semantics.\\n\\nValidation/tests:\\n- Manual verification in a tmux session (no automated test required).\\n","acceptance_criteria":"1. When running inside tmux, Rust updates the pane title during SOLVING/REVIEWING/ERROR phases. (Rough parity with shell behavior.)\n2. Completed and needs-human summaries are included in the title when present (format may differ).\n3. When not in tmux, no tmux commands are executed.\n4. Manual verification in tmux confirms updates occur without errors.","notes":"Verified: tmux pane titles update during SOLVING/REVIEWING/ERROR with completed/needs-human summaries when present; no tmux commands run when TMUX not set. Manual tmux verification done on 2026-02-05; no errors observed. Tests: cargo test.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T05:09:59.217065183Z","created_by":"mark","updated_at":"2026-02-05T04:12:04.313303139Z","closed_at":"2026-02-05T04:12:04.313283852Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-eeu","depends_on_id":"tr-1bh","type":"blocks","created_at":"2026-02-04T05:09:59.221096990Z","created_by":"mark"},{"issue_id":"tr-eeu","depends_on_id":"tr-3j8","type":"parent-child","created_at":"2026-02-04T05:09:59.219762911Z","created_by":"mark"}],"comments":[{"id":4,"issue_id":"tr-eeu","author":"Mark Wotton","text":"Manual tmux verification is still required. Can you run trudger inside a tmux session and confirm pane titles update for SOLVING/REVIEWING/ERROR and include completed/needs-human summaries without errors? Please share result.","created_at":"2026-02-05T03:22:53Z"},{"id":5,"issue_id":"tr-eeu","author":"Mark Wotton","text":"Manual tmux verification (2026-02-05): started a tmux session and ran trudger with 3 manual tasks. Observed pane title updates via tmux display-message during SOLVING/REVIEWING phases. Titles included completed and needs-human summaries, e.g. 'COMPLETED [task1] NEEDS_HUMAN [task2] SOLVING task3'. No tmux errors surfaced; title restored after completion.","created_at":"2026-02-05T04:09:37Z"}]}
{"id":"tr-gk1","title":"Run OpenSpec validation for the change","description":"OpenSpec refs:\n- All added/modified requirements in `openspec/changes/refactor-trudger-config-and-docs/specs/trudger/spec.md`.\n\nExpected outputs:\n- `openspec validate refactor-trudger-config-and-docs --strict --no-interactive` runs cleanly.\n\nValidation/tests:\n- Run the validation command and capture a zero exit status.\n\nSuccess criteria:\n- No OpenSpec validation errors or warnings.","acceptance_criteria":"Acceptance criteria: (1) openspec validate refactor-trudger-config-and-docs --strict --no-interactive exits 0 with no errors.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T05:27:14.167430530Z","created_by":"mark","updated_at":"2026-01-29T09:28:20.349419646Z","closed_at":"2026-01-29T09:28:20.349375662Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-gk1","depends_on_id":"tr-140","type":"waits-for","created_at":"2026-01-29T05:27:14.201633362Z","created_by":"mark"},{"issue_id":"tr-gk1","depends_on_id":"tr-2mc","type":"parent-child","created_at":"2026-01-29T05:27:14.198199128Z","created_by":"mark"},{"issue_id":"tr-gk1","depends_on_id":"tr-3do","type":"waits-for","created_at":"2026-01-29T05:27:14.199895517Z","created_by":"mark"},{"issue_id":"tr-gk1","depends_on_id":"tr-u0t","type":"waits-for","created_at":"2026-01-29T05:27:14.203315388Z","created_by":"mark"}]}
{"id":"tr-htz","title":"Add BATS coverage for --config override","description":"OpenSpec refs:\n- Requirement: Config flag override â€” Scenario: provided config path used\n- Requirement: Config flag override â€” Scenario: missing config path errors\n\nExpected outputs:\n- BATS test verifying `--config` uses the provided file.\n- BATS test verifying `-c` missing path errors non-zero with clear message.\n\nValidation/tests:\n- `bats tests/trudger_test.bats` includes these scenarios.\n\nSuccess criteria:\n- Both OpenSpec scenarios have explicit BATS coverage.","acceptance_criteria":"Acceptance criteria: (1) BATS test asserts --config loads the provided file. (2) BATS test asserts missing -c/--config path errors non-zero with clear message.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T06:06:15.366718098Z","created_by":"mark","updated_at":"2026-01-30T02:14:32.836212759Z","closed_at":"2026-01-30T02:14:32.836167966Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-htz","depends_on_id":"tr-2zt","type":"waits-for","created_at":"2026-01-29T06:06:15.401873864Z","created_by":"mark"},{"issue_id":"tr-htz","depends_on_id":"tr-jyr","type":"parent-child","created_at":"2026-01-29T06:06:15.397076124Z","created_by":"mark"},{"issue_id":"tr-htz","depends_on_id":"tr-rg8","type":"waits-for","created_at":"2026-01-29T06:06:15.399675607Z","created_by":"mark"}]}
{"id":"tr-jyr","title":"Add config flag and sample configs for trudger","description":"Goals:\n- Provide a deterministic config override via `-c/--config` so tests and alternate workflows can bypass `~/.config/trudger.yml`.\n- Ship sample configuration files for legacy hooks and `bv --robot-triage` task selection.\n- Document flag usage and sample config locations.\n\nScope:\n- Code: `trudger` CLI flag parsing and config-path handling.\n- Docs: `README.md` updates.\n- Samples/tests: `sample_configuration/*.yml`, `tests/` updates.\n\nOpenSpec refs:\n- ADDED: Config flag override (Scenario: provided config path used; Scenario: missing config path errors)\n- ADDED: Sample config files (Scenario: sample configs available in repo)\n\nDependencies:\n- Depends on `update-trudger-config-bootstrap` and `refactor-trudger-config-and-docs` (see proposal).","acceptance_criteria":"Acceptance criteria: (1) -c/--config loads the provided file and ignores ~/.config/trudger.yml; missing path exits non-zero with a clear error. (2) sample_configuration/trudgeable-with-hooks.yml and sample_configuration/robot-triage.yml exist in the repo. (3) README documents the flag and sample config locations.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-29T06:02:53.980894557Z","created_by":"mark","updated_at":"2026-01-29T10:01:55.878731725Z","closed_at":"2026-01-29T10:01:55.878686569Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-jyr","depends_on_id":"tr-2mc","type":"waits-for","created_at":"2026-01-29T06:02:53.985076367Z","created_by":"mark"}],"comments":[{"id":1,"issue_id":"tr-jyr","author":"Mark Wotton","text":"Review complete: acceptance criteria verified (config override, sample configs present, README updated) and bats suite passed. Unable to close because dependency tr-2mc is still in_progress.","created_at":"2026-01-29T09:33:18Z"}]}
{"id":"tr-kxd","title":"Externalize task commands and bootstrap config","description":"Convert Trudger to a config-driven task runner: require config bootstrap, externalize task selection/show/update commands, and preserve hook-based completion/escalation without direct bd usage.\n\nScope\n- Add command expectations for next/show/update in config (commands.*), pass task id as first arg.\n- Ensure next_task exit semantics (1=done, other non-zero=error).\n- Use show output as free-form text for Codex, ignore update output.\n- Update samples/tests/README accordingly.","acceptance_criteria":"- Missing ~/.config/trudger.yml prints curl bootstrap instructions for sample configs and exits non-zero.\n- Trudger never invokes bd directly; all task ops run via configured commands.\n- commands.next_task exit 1 yields exit 0; other non-zero exits are errors.\n- commands.task_show output is passed to Codex unparsed; commands.task_update_in_progress output is ignored.\n- Sample configs and tests reflect new commands.* contract.\n- bats tests pass.","status":"closed","priority":2,"issue_type":"epic","owner":"mwotton@gmail.com","created_at":"2026-01-28T09:21:15.567006719Z","created_by":"Mark Wotton","updated_at":"2026-01-29T03:27:11.790631824Z","closed_at":"2026-01-29T03:27:11.790567578Z","close_reason":"done","source_repo":".","compaction_level":0}
{"id":"tr-kxd.1","title":"Update trudger to use commands.next_task with exit semantics","description":"Implements update-trudger-config-bootstrap: Requirement 'Task selection' scenarios (custom next-task, exit code 1 => exit 0, other non-zero => error). Ensure task id is passed as first arg to other commands/hooks. Update error handling for next_task exit codes.","acceptance_criteria":"- next_task_command is sourced from commands.next_task.\n- Exit code 1 from next_task exits 0.\n- Non-zero (non-1) from next_task exits non-zero with clear error.\n- First token of stdout is used as task id and is passed as arg1 to other commands/hooks.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-28T09:21:27.458152850Z","created_by":"Mark Wotton","updated_at":"2026-01-29T02:00:13.889587947Z","closed_at":"2026-01-29T02:00:13.889525038Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-kxd.1","depends_on_id":"tr-kxd","type":"parent-child","created_at":"2026-01-29T01:53:39Z","created_by":"import"}]}
{"id":"tr-kxd.2","title":"Add commands.task_show + commands.task_update_in_progress support","description":"Implements update-trudger-config-bootstrap: Requirements 'Task show command' and 'Task update command'. Replace direct bd show/update usage with configured commands. Show output is treated as free-form and passed to Codex without parsing; update output ignored.","acceptance_criteria":"- commands.task_show is required and executed as <command> <task_id> <extra args>.\n- commands.task_update_in_progress is required and executed before solve; output is ignored.\n- No bd invocations remain in trudger.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-28T09:22:13.087195272Z","created_by":"Mark Wotton","updated_at":"2026-01-29T02:28:57.484030745Z","closed_at":"2026-01-29T02:28:57.483986038Z","close_reason":"Completed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-kxd.2","depends_on_id":"tr-kxd","type":"parent-child","created_at":"2026-01-28T09:22:13.088373805Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-kxd.2","depends_on_id":"tr-kxd.1","type":"blocks","created_at":"2026-01-28T09:23:47.149182145Z","created_by":"import","metadata":"","thread_id":""}]}
{"id":"tr-kxd.3","title":"Update sample configs for commands.*","description":"Implements update-trudger-config-bootstrap: Requirement 'Configured task commands' and task selection semantics. Add commands.next_task, commands.task_show, commands.task_update_in_progress to sample configs using bd/bv as appropriate. Ensure next_task exit behavior is consistent with config commands.","acceptance_criteria":"- sample_configuration/trudgeable-with-hooks.yml includes commands.next_task/task_show/task_update_in_progress using bd.\n- sample_configuration/robot-triage.yml includes commands.next_task/task_show/task_update_in_progress using bv/bd equivalents.\n- Comment headers explain command usage.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-28T09:22:23.974540484Z","created_by":"Mark Wotton","updated_at":"2026-01-29T03:15:39.294325776Z","closed_at":"2026-01-29T03:15:39.294280857Z","close_reason":"Completed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-kxd.3","depends_on_id":"tr-kxd","type":"parent-child","created_at":"2026-01-28T09:22:23.975704167Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-kxd.3","depends_on_id":"tr-kxd.1","type":"blocks","created_at":"2026-01-28T09:23:47.150495678Z","created_by":"import","metadata":"","thread_id":""}]}
{"id":"tr-kxd.4","title":"Update tests for commands.* and next_task exit semantics","description":"Implements update-trudger-config-bootstrap scenarios for commands.task_show/task_update_in_progress and next_task exit codes. Update test fixtures to use configured commands and ensure failure paths are covered.","acceptance_criteria":"- tests use commands.* in config.\n- coverage for next_task exit 1 (idle) vs non-zero error.\n- tests assert that show output is passed to Codex and update output is ignored (as applicable).","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-28T09:22:38.877194587Z","created_by":"Mark Wotton","updated_at":"2026-01-29T03:23:30.828847112Z","closed_at":"2026-01-29T03:23:30.828785372Z","close_reason":"Completed","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-kxd.4","depends_on_id":"tr-kxd","type":"parent-child","created_at":"2026-01-28T09:22:38.878375851Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-kxd.4","depends_on_id":"tr-kxd.1","type":"blocks","created_at":"2026-01-28T09:23:47.151578293Z","created_by":"import","metadata":"","thread_id":""},{"issue_id":"tr-kxd.4","depends_on_id":"tr-kxd.2","type":"blocks","created_at":"2026-01-28T09:23:47.152629887Z","created_by":"import","metadata":"","thread_id":""},{"issue_id":"tr-kxd.4","depends_on_id":"tr-kxd.3","type":"blocks","created_at":"2026-01-28T09:23:47.153677318Z","created_by":"import","metadata":"","thread_id":""}]}
{"id":"tr-kxd.5","title":"Update README for commands.* contract","description":"Implements update-trudger-config-bootstrap documentation updates: describe commands.next_task/task_show/task_update_in_progress, exit code semantics, and requirement to pass task id as first arg.","acceptance_criteria":"- README documents commands.* keys, required status, and exit semantics.\n- Sample config snippets updated to match.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-28T09:22:51.062564796Z","created_by":"Mark Wotton","updated_at":"2026-01-29T03:36:39.685704837Z","closed_at":"2026-01-29T03:36:39.685659295Z","close_reason":"done","source_repo":".","compaction_level":0,"dependencies":[{"issue_id":"tr-kxd.5","depends_on_id":"tr-kxd","type":"parent-child","created_at":"2026-01-28T09:22:51.063699822Z","created_by":"Mark Wotton","metadata":"","thread_id":""},{"issue_id":"tr-kxd.5","depends_on_id":"tr-kxd.2","type":"blocks","created_at":"2026-01-28T09:23:47.154769707Z","created_by":"import","metadata":"","thread_id":""},{"issue_id":"tr-kxd.5","depends_on_id":"tr-kxd.3","type":"blocks","created_at":"2026-01-28T09:23:47.155819942Z","created_by":"import","metadata":"","thread_id":""}]}
{"id":"tr-mh0","title":"Implement config bootstrap for trudger","description":"Implement update-trudger-config-bootstrap proposal once approved: require config file, print curl bootstrap, remove in-script defaults, update tests/docs.","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-28T05:53:41.832324503Z","created_by":"Mark Wotton","updated_at":"2026-01-28T06:05:42.624502730Z","closed_at":"2026-01-28T06:05:42.624502730Z","close_reason":"Completed","source_repo":".","compaction_level":0}
{"id":"tr-njl","title":"Tests for env-var contract + review command","description":"OpenSpec refs:\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Command execution environment\n  - Scenario: Command environment provided\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Agent prompt execution\n  - Scenarios: Agent solve + review; Prompt context via env vars\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Task show output handling\n  - Scenario: Show output is prompt-only\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Hook execution semantics\n  - Scenario: Hook receives env vars\n\nWork:\n- Update tests to assert env-var contract and review command usage.\n- Add fixtures for TRUDGER_PROMPT/TRUDGER_REVIEW_PROMPT and TRUDGER_TASK_SHOW.\n- Add coverage for missing prompt file error.\n\nExpected outputs:\n- Tests cover env-var prompt context, no positional args, and missing prompt file handling.\n\nValidation/tests:\n- bats tests/trudger_test.bats","acceptance_criteria":"1. Tests assert TRUDGER_PROMPT/TRUDGER_REVIEW_PROMPT are set only for the relevant command and TRUDGER_TASK_SHOW is passed to agent commands. (OpenSpec: Agent prompt execution + Task show output handling scenarios.)\n2. Tests assert no positional task id args are passed to commands/hooks. (OpenSpec: Command execution environment + Hook execution semantics scenarios.)\n3. Tests assert review uses agent_review_command. (OpenSpec: Agent solve + review scenario.)\n4. Tests cover missing prompt file error.\n5. bats tests/trudger_test.bats passes.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T06:08:04.364863480Z","created_by":"mark","updated_at":"2026-02-05T01:57:34.680517481Z","closed_at":"2026-02-05T01:57:34.680501277Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-njl","depends_on_id":"tr-1cs","type":"parent-child","created_at":"2026-02-04T06:08:04.370105793Z","created_by":"mark"},{"issue_id":"tr-njl","depends_on_id":"tr-1id","type":"blocks","created_at":"2026-02-04T06:08:04.375077176Z","created_by":"mark"},{"issue_id":"tr-njl","depends_on_id":"tr-vgj","type":"blocks","created_at":"2026-02-04T06:08:04.372704858Z","created_by":"mark"}]}
{"id":"tr-obz","title":"Release Polish: Rust clarity, dedup, and logging hardening","description":"Follow-ups from wide-ranging Rust review: reduce main.rs complexity, remove high-risk duplication, improve log failure visibility, and strengthen unit test coverage for key flows.","acceptance_criteria":"Done when:\n- All child tasks under `tr-obz` are closed.\n- CI is green (Rust + shell).\n- Release branch is in a shippable state (no known correctness regressions vs current behavior).","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-02-06T09:10:29.101586379Z","created_by":"mark","updated_at":"2026-02-06T14:37:04.423513188Z","closed_at":"2026-02-06T14:37:04.423497601Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-obz.1","title":"Refactor: dedupe shell command runner (capture vs inherit)","description":"`run_shell_command_capture` and `run_shell_command_status` share a lot of logic (logging start/exit, bash -lc wiring, args rendering, env injection). Refactor to a shared internal helper so behavior stays consistent and future changes are less error-prone.\n\nConstraints:\n- Keep log line formats identical (existing fixtures depend on them).\n- Preserve current bash invocation semantics, including how args are passed and how empty commands are handled.","acceptance_criteria":"Done when:\n- There is a single internal implementation for running `bash -lc` commands, with capture vs inherit controlled via parameters.\n- Capture vs inherit stdio semantics are preserved (capture returns stdout; inherit passes stdin/stdout/stderr through unchanged).\n- Log output remains byte-for-byte compatible with current format (fixture-based tests remain unchanged or are updated only if strictly necessary).\n- Quality gates pass: `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, `cargo test`.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-06T09:14:03.710039410Z","created_by":"mark","updated_at":"2026-02-06T10:26:25.495165217Z","closed_at":"2026-02-06T10:26:25.495149708Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-obz.1","depends_on_id":"tr-2vc","type":"blocks","created_at":"2026-02-06T09:33:26.589028068Z","created_by":"mark"},{"issue_id":"tr-obz.1","depends_on_id":"tr-obz","type":"parent-child","created_at":"2026-02-06T09:14:03.710039410Z","created_by":"mark"}]}
{"id":"tr-obz.2","title":"Refactor: simplify doctor mode command runners","description":"Doctor mode has several near-duplicate helpers (next_task/task_show/task_status/task_update/reset_task/hook) and a clippy suppression for too-many-arguments.\n\nRefactor doctor-mode code to share common plumbing (env building + bash invocation) and pass a context struct instead of long arg lists.\n\nGoal: make doctor checks easier to extend without copy/paste and without clippy allows.","acceptance_criteria":"Done when:\n- Doctor-mode helpers share common command-running plumbing (no copy/paste env + bash invocation).\n- `doctor_run_hook` no longer needs `#[allow(clippy::too_many_arguments)]` and `cargo clippy --all-targets -- -D warnings` passes.\n- Doctor mode behavior is unchanged and covered by existing tests (`cargo test` passes).\n- Code readability improves (fewer repeated parameter lists, clearer control flow).","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-06T09:14:23.274124957Z","created_by":"mark","updated_at":"2026-02-06T14:24:37.838682731Z","closed_at":"2026-02-06T14:24:37.838609201Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-obz.2","depends_on_id":"tr-obz","type":"parent-child","created_at":"2026-02-06T09:14:23.274124957Z","created_by":"mark"},{"issue_id":"tr-obz.2","depends_on_id":"tr-obz.1","type":"blocks","created_at":"2026-02-06T09:33:26.555011846Z","created_by":"mark"}]}
{"id":"tr-obz.3","title":"Logging: make log_transition failures visible (without spam)","description":"`Logger::log_transition` currently swallows file open/write errors, which can silently disable logging when `log_path` is set.\n\nChange logging behavior so failures are visible to the user but non-fatal and non-spammy (warn once, then disable logging). This should improve debuggability without breaking normal runs.","acceptance_criteria":"Done when:\n- If `log_path` is configured but the log file cannot be created/opened/appended, Trudger prints a single warning to stderr (includes the path and OS error) and continues.\n- The warning is emitted at most once per process; subsequent `log_transition` calls do not repeatedly attempt failing I/O (logging is disabled after first failure).\n- Automated coverage asserts warn-once behavior without requiring exact warning text.\n- When the log file is writable, log output format is unchanged.\n- Quality gates pass: `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, `cargo test`.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-06T09:14:40.644255140Z","created_by":"mark","updated_at":"2026-02-06T11:05:38.089194975Z","closed_at":"2026-02-06T11:05:38.089174828Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-obz.3","depends_on_id":"tr-2vc","type":"blocks","created_at":"2026-02-06T09:33:26.630524531Z","created_by":"mark"},{"issue_id":"tr-obz.3","depends_on_id":"tr-obz","type":"parent-child","created_at":"2026-02-06T09:14:40.644255140Z","created_by":"mark"}]}
{"id":"tr-obz.4","title":"Testing: enforce 100% Rust coverage (lines + regions)","description":"Raise Rust coverage to 100% for both lines and regions (LLVM source-based coverage).\n\nUse `cargo llvm-cov` as the source of truth for metrics (regions + lines). Add a repeatable local command and a CI gate so coverage regressions fail fast.\n\nNote: region coverage is stricter than line coverage; expect to add tests for error paths and branchy logic.","acceptance_criteria":"Done when:\n- Running `cargo llvm-cov --all-targets --fail-under-lines 100 --fail-under-regions 100` succeeds locally.\n- CI includes a coverage step that runs the same coverage command and fails the job if coverage drops below 100% lines or regions.\n- Coverage scope is documented (what is included/excluded, and why).\n- Test-only modules (compiled only under `cfg(test)`) may be excluded from coverage via `--ignore-filename-regex`, with justification.\n- `src/main.rs` may be excluded from coverage only if it is wiring-only and very small (<= 200 LOC).\n- Any exclusions use `--ignore-filename-regex` with justification.\n- Quality gates pass: `cargo fmt --check`, `cargo clippy --all-targets -- -D warnings`, `cargo test`.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-06T09:21:49.065467947Z","created_by":"mark","updated_at":"2026-02-06T14:02:20.166250019Z","closed_at":"2026-02-06T14:02:20.166175542Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-obz.4","depends_on_id":"tr-35l","type":"blocks","created_at":"2026-02-06T09:33:26.713257523Z","created_by":"mark"},{"issue_id":"tr-obz.4","depends_on_id":"tr-obz","type":"parent-child","created_at":"2026-02-06T09:21:49.065467947Z","created_by":"mark"},{"issue_id":"tr-obz.4","depends_on_id":"tr-obz.3","type":"blocks","created_at":"2026-02-06T09:33:26.756442272Z","created_by":"mark"}]}
{"id":"tr-rg8","title":"Implement -c/--config override and missing-path error","description":"OpenSpec refs:\n- Requirement: Config flag override â€” Scenario: provided config path used\n- Requirement: Config flag override â€” Scenario: missing config path errors\n\nExpected outputs:\n- `trudger` accepts `-c/--config` and uses the provided path instead of `~/.config/trudger.yml`.\n- When the provided path is missing, the script exits non-zero with a clear error.\n- Default config path is ignored entirely when the flag is present.\n\nValidation/tests:\n- Covered by new/updated BATS cases in the \"Add BATS coverage for --config override\" task.\n\nSuccess criteria:\n- Flag behavior matches both OpenSpec scenarios.","acceptance_criteria":"Acceptance criteria: (1) -c/--config loads the provided file and ignores ~/.config/trudger.yml. (2) Missing config path exits non-zero with a clear error message.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T06:04:19.295557677Z","created_by":"mark","updated_at":"2026-01-29T10:06:42.192169662Z","closed_at":"2026-01-29T10:06:42.192092904Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-rg8","depends_on_id":"tr-jyr","type":"parent-child","created_at":"2026-01-29T06:04:19.299819864Z","created_by":"mark"}]}
{"id":"tr-ruf","title":"Wizard-managed prompt installation","description":"OpenSpec: add-trudger-wizard-prompt-install\n\nGoal: make 'trudger wizard' a one-stop bootstrap by optionally installing/updating required prompt files for task-processing mode.\n\nScope:\n- Install missing prompts to ~/.codex/prompts/ (default Yes)\n- Offer per-file overwrite when prompts differ (default No; explicit y/yes)\n- Create sibling timestamped backups before overwrite: {filename}.bak-YYYYMMDDTHHMMSSZ\n- Use embedded prompt defaults (wizard works without a repo checkout)\n- If accepted prompt install/update fails: exit non-zero and DO NOT write config\n\nNon-goals:\n- Making prompt paths configurable (separate change)\n\nSpec delta: openspec/changes/add-trudger-wizard-prompt-install/specs/trudger/spec.md","acceptance_criteria":"Must satisfy OpenSpec change add-trudger-wizard-prompt-install:\n\n- Requirement: Prompt file presence (MODIFIED)\n  - Scenario: Wizard offers to install missing prompts\n  - Scenario: Wizard can skip prompt installation\n  - Scenario: Wizard offers to update differing prompts\n  - Scenario: Wizard does nothing when prompts match defaults\n- Requirement: Wizard prompt defaults are embedded (ADDED)\n  - Scenario: Wizard installs prompts without repo checkout\n- Requirement: Wizard prompt installation is safe (ADDED)\n  - Scenario: Wizard creates prompt directory\n  - Scenario: Wizard refuses to overwrite without confirmation\n  - Scenario: Wizard backs up prompt before overwrite\n  - Backup naming: sibling {filename}.bak-YYYYMMDDTHHMMSSZ (+ collision suffix)\n- Requirement: Wizard prompt state detection is strict (ADDED)\n  - Scenario: Prompt read/parse failure aborts wizard\n- Requirement: Wizard prompt install/update failures are actionable (ADDED)\n  - Scenario: Prompt write failure exits non-zero with path and config is not written\n\nQuality gates:\n- cargo fmt, clippy, (nextest|test) pass\n- openspec validate add-trudger-wizard-prompt-install --strict --no-interactive passes","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-02-09T13:23:42.607817663Z","created_by":"mark","updated_at":"2026-02-09T14:57:00.305681619Z","closed_at":"2026-02-09T14:57:00.305664617Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"tr-ruf.1","title":"Embed default prompts in Rust binary","description":"OpenSpec refs:\n- openspec/changes/add-trudger-wizard-prompt-install/specs/trudger/spec.md\n  - Requirement: Wizard prompt defaults are embedded (ADDED)\n  - Scenario: Wizard installs prompts without repo checkout\n\nWork:\n- Embed the default prompt contents for trudge + review in the Rust binary (e.g., include_str! of prompts/trudge.md and prompts/trudge_review.md).\n- Provide a small Rust API that returns (a) default prompt contents and (b) default destination paths under ~/.codex/prompts/.\n\nExpected outputs:\n- New/updated Rust module exposing embedded prompt strings.\n\nValidation:\n- cargo test passes (add a focused unit test that asserts embedded prompts are non-empty).","acceptance_criteria":"Acceptance:\n- Implements OpenSpec Requirement: Wizard prompt defaults are embedded (openspec/changes/add-trudger-wizard-prompt-install/specs/trudger/spec.md)\n- Default prompt contents for both files are embedded in the Rust binary at build time.\n- A Rust API returns the embedded contents for:\n  - ~/.codex/prompts/trudge.md\n  - ~/.codex/prompts/trudge_review.md\n- Unit test asserts both embedded prompt strings are non-empty.\n- cargo test passes.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-09T13:24:36.290724168Z","created_by":"mark","updated_at":"2026-02-09T14:15:25.130132141Z","closed_at":"2026-02-09T14:15:25.130115926Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-ruf.1","depends_on_id":"tr-ruf","type":"parent-child","created_at":"2026-02-09T13:24:36.290724168Z","created_by":"mark"}]}
{"id":"tr-ruf.2","title":"Implement prompt install/update helpers (diff + backups)","description":"OpenSpec refs:\n- openspec/changes/add-trudger-wizard-prompt-install/specs/trudger/spec.md\n  - Requirement: Prompt file presence (MODIFIED)\n    - Scenario: Wizard offers to update differing prompts\n  - Requirement: Wizard prompt installation is safe (ADDED)\n    - Scenario: Wizard refuses to overwrite without confirmation\n    - Scenario: Wizard backs up prompt before overwrite\n    - Backup naming: {filename}.bak-YYYYMMDDTHHMMSSZ (+ collision suffix)\n  - Requirement: Wizard prompt state detection is strict (ADDED)\n    - Scenario: Prompt read/parse failure aborts wizard\n  - Requirement: Wizard prompt install/update failures are actionable (ADDED)\n\nWork:\n- Implement reusable helpers for:\n  - Detecting per-prompt state: missing / matches_default / differs.\n    - Compare on-disk contents to embedded defaults using normalized text (treat CRLF/LF/CR as equivalent; ignore a single trailing newline).\n    - If an existing prompt cannot be read or decoded as UTF-8, return an error (do not treat as differs).\n  - Creating the prompt directory when needed.\n  - Writing missing prompts.\n  - Overwriting a prompt file only after an explicit y/yes confirmation.\n  - Creating a sibling backup before overwrite using the specified naming scheme.\n  - Returning errors that include the failing path and an operation hint (read/mkdir/backup/write).\n\nExpected outputs:\n- Helper functions usable from wizard flow (no UI here).\n\nValidation:\n- Unit tests for backup-path selection and state detection (including normalization and read/UTF-8 failure).\n- cargo test passes.","acceptance_criteria":"Acceptance:\n- Implements OpenSpec Requirement: Wizard prompt installation is safe, Requirement: Wizard prompt state detection is strict, and Requirement: Wizard prompt install/update failures are actionable.\n- Provides per-prompt state detection: missing / matches_default / differs.\n  - Uses normalized compare (CRLF/LF/CR equivalent; ignore a single trailing newline).\n  - Read/UTF-8 decode failure returns an error that includes the failing path (do not silently treat as differs).\n- Provides backup-path generation that creates sibling backups named:\n  - {filename}.bak-YYYYMMDDTHHMMSSZ\n  - If the path exists, selects a non-colliding sibling (e.g., suffix -2, -3, ...).\n- Provides file operations that:\n  - Create ~/.codex/prompts/ when needed.\n  - Write missing prompt files.\n  - Overwrite a prompt file only when caller indicates explicit confirmation.\n  - Return errors that include the failing path and an operation hint (read/mkdir/backup/write).\n- Unit tests cover:\n  - backup-path generation\n  - normalized state detection\n  - read/UTF-8 decode failure erroring with key substrings (operation + path)\n- cargo test passes.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-09T13:24:56.684842506Z","created_by":"mark","updated_at":"2026-02-09T14:21:13.293990911Z","closed_at":"2026-02-09T14:21:13.293973760Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-ruf.2","depends_on_id":"tr-ruf","type":"parent-child","created_at":"2026-02-09T13:24:56.684842506Z","created_by":"mark"},{"issue_id":"tr-ruf.2","depends_on_id":"tr-ruf.1","type":"blocks","created_at":"2026-02-09T13:24:56.684842506Z","created_by":"mark"}]}
{"id":"tr-ruf.3","title":"Wizard UX: install/update prompts and abort config write on failure","description":"OpenSpec refs:\n- openspec/changes/add-trudger-wizard-prompt-install/specs/trudger/spec.md\n  - Requirement: Prompt file presence (MODIFIED)\n    - Scenario: Wizard offers to install missing prompts\n    - Scenario: Wizard can skip prompt installation\n    - Scenario: Wizard offers to update differing prompts\n    - Scenario: Wizard does nothing when prompts match defaults\n  - Requirement: Wizard prompt state detection is strict (ADDED)\n    - Scenario: Prompt read/parse failure aborts wizard\n  - Requirement: Wizard prompt install/update failures are actionable (ADDED)\n\nWork:\n- Integrate prompt state detection + install/update into the interactive wizard flow.\n- Missing prompts:\n  - Prompt to install missing prompts (default Yes).\n  - Treat blank/y/yes as accept and n/no as decline (case-insensitive; whitespace trimmed).\n  - Reprompt on any other input.\n  - Write only missing prompts; never overwrite an existing prompt in this step.\n- Differing prompts:\n  - Prompt per differing prompt file (default No).\n  - Treat y/yes as overwrite and blank/n/no as keep existing (case-insensitive; whitespace trimmed).\n  - Reprompt on any other input.\n  - Create sibling timestamped backup before overwrite.\n- Ordering:\n  - If the user accepts an install/overwrite action, perform prompt writes BEFORE config write.\n  - If prompt state detection fails (read/UTF-8 error) or any accepted prompt install/update fails: exit non-zero and DO NOT write config.\n- Output:\n  - Print summary lines describing prompt status (installed/updated/unchanged/skipped).\n  - If prompts remain missing, print follow-up instructions that include both required prompt paths and at least one installation method (rerun wizard or ./install.sh from a checkout).\n\nValidation:\n- Add/adjust unit tests as needed; full scenario coverage in the dedicated test task.","acceptance_criteria":"Acceptance:\n- Implements OpenSpec Requirement: Prompt file presence (wizard install/skip/update/no-op scenarios).\n- Implements OpenSpec Requirement: Wizard prompt state detection is strict.\n- Implements OpenSpec Requirement: Wizard prompt install/update failures are actionable (abort without config write).\n- Wizard prompts:\n  - Install missing prompts prompt defaults to Yes; blank/y/yes accept; n/no decline; reprompt otherwise.\n  - Overwrite differing prompts is per-file, defaults to No; y/yes overwrites; blank/n/no keeps existing; reprompt otherwise.\n- Missing install step writes only missing prompt files and never overwrites an existing prompt without a separate overwrite confirmation.\n- Overwrite step creates sibling backup {filename}.bak-YYYYMMDDTHHMMSSZ before writing.\n- If prompt state detection fails OR any accepted prompt install/update action fails, wizard exits non-zero and the config file is not written.\n- Wizard prints a prompt install/update summary and actionable follow-up instructions when prompts remain missing.\n- cargo test passes.","notes":"Reviewer notes (2026-02-09):\\n- Current codebase has prompt install/update helpers (src/prompt_install.rs) and embedded defaults (src/prompt_defaults.rs), but wizard integration required by tr-ruf.3 is not present yet (no calls from src/wizard.rs).\\n- cargo test passes at HEAD; however it does not validate the new wizard prompt-install UX scenarios (those are largely in tr-ruf.4).\\n- Next implementation work should wire prompt detection + interactive prompts into wizard flow, enforce write ordering (prompts before config), and print summary + follow-up instructions when prompts remain missing.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-09T13:25:20.300553696Z","created_by":"mark","updated_at":"2026-02-09T14:33:13.672191199Z","closed_at":"2026-02-09T14:33:13.672163583Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-ruf.3","depends_on_id":"tr-ruf","type":"parent-child","created_at":"2026-02-09T13:25:20.300553696Z","created_by":"mark"},{"issue_id":"tr-ruf.3","depends_on_id":"tr-ruf.2","type":"blocks","created_at":"2026-02-09T13:25:20.300553696Z","created_by":"mark"}],"comments":[{"id":8,"issue_id":"tr-ruf.3","author":"Mark Wotton","text":"Review findings (2026-02-09): prompt install/update is implemented in src/prompt_install.rs, but wizard flow does not yet call it. I confirmed there are currently *no* references to prompt_install helpers from src/wizard.rs (rg for detect_prompt_state/write_prompt_if_missing/overwrite_prompt_with_backup returned 0 matches).\\n\\nAcceptance criteria still missing:\\n- Wizard prompt-state detection + install/skip prompts for missing prompt files (default Yes; reprompt on invalid).\\n- Per-file overwrite prompts for differing files (default No; backup {filename}.bak-YYYYMMDDTHHMMSSZ before overwrite).\\n- Ordering: accepted prompt writes must happen before config write; on detection/read/UTF-8 failure or any accepted install/update failure, exit non-zero and do not write config.\\n- Output: summary lines + actionable follow-up instructions if prompts remain missing.\\n\\nTests: cargo test passes on current HEAD (271 unit + 4 integration).","created_at":"2026-02-09T14:23:29Z"},{"id":9,"issue_id":"tr-ruf.3","author":"Mark Wotton","text":"Implemented wizard prompt install/update integration in src/wizard.rs (uses embedded defaults via src/prompt_defaults.rs + helpers in src/prompt_install.rs). Wizard now: detects strict prompt state, offers install missing (default Yes), offers per-file overwrite for differing (default No) with sibling timestamped backups, performs prompt writes before config write, aborts on detection/write errors before config write, and prints a summary + follow-up instructions when prompts remain missing.\\n\\nQuality gates: cargo fmt, cargo clippy, cargo test/nextest all pass (verified via pre-push).","created_at":"2026-02-09T14:31:58Z"}]}
{"id":"tr-ruf.4","title":"Tests: wizard prompt install/update flows","description":"OpenSpec refs:\n- openspec/changes/add-trudger-wizard-prompt-install/specs/trudger/spec.md\n  - Requirement: Prompt file presence (MODIFIED)\n    - Scenario: Wizard offers to install missing prompts\n    - Scenario: Wizard can skip prompt installation\n    - Scenario: Wizard offers to update differing prompts\n    - Scenario: Wizard does nothing when prompts match defaults\n  - Requirement: Wizard prompt defaults are embedded (ADDED)\n    - Scenario: Wizard installs prompts without repo checkout\n  - Requirement: Wizard prompt installation is safe (ADDED)\n    - Scenario: Wizard creates prompt directory\n    - Scenario: Wizard refuses to overwrite without confirmation\n    - Scenario: Wizard backs up prompt before overwrite\n  - Requirement: Wizard prompt state detection is strict (ADDED)\n    - Scenario: Prompt read/parse failure aborts wizard\n  - Requirement: Wizard prompt install/update failures are actionable (ADDED)\n    - Scenario: Prompt write failure exits non-zero with path and config is not written\n\nWork:\n- Add deterministic tests (TempDir + TestWizardIo) covering:\n  - Missing prompts: accept install => prompts written; decline => config written + follow-up instructions.\n  - Partial missing (one prompt missing, one present): install writes only missing; no overwrite.\n  - Differing prompts: overwrite prompt per file; default keep; y/yes overwrites.\n  - Reprompt behavior: invalid input causes reprompt for both install-missing and overwrite-differing prompts.\n  - Backup creation: sibling {filename}.bak-YYYYMMDDTHHMMSSZ (and collision suffix) before overwrite.\n  - Match defaults: no install/update prompts.\n  - Normalization: CRLF vs LF (and optional trailing newline) still counts as match vs defaults.\n  - Strict detection: unreadable or non-UTF8 prompt file => exit non-zero; error includes path; config not written.\n  - Failure path: accepted prompt write fails => exit non-zero; error includes failing path; config not written.\n  - Embedded-defaults path: does not require repo prompt files on disk.\n\nValidation:\n- cargo test passes.","acceptance_criteria":"Acceptance:\n- Adds tests that explicitly map to all OpenSpec scenarios listed in this task description.\n- Tests assert:\n  - install-missing default prompt accepts blank/y/yes and declines n/no (whitespace trimmed; case-insensitive).\n  - install-missing reprompts on invalid input.\n  - overwrite-differing requires y/yes; blank/n/no keeps existing; reprompts on invalid input.\n  - backups are sibling files named {filename}.bak-YYYYMMDDTHHMMSSZ (+ collision suffix if needed).\n  - normalized comparison: CRLF/LF and optional trailing newline match defaults.\n  - prompt state detection failures (read/UTF-8 decode) exit non-zero, mention failing path, and do not write config.\n  - accepted prompt install/update failure exits non-zero, mentions failing path, and does not write config.\n  - error messages are asserted using key substrings (operation + path), not full-string equality.\n  - embedded defaults are used (no repo checkout required).\n- cargo test passes.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-09T13:25:48.219420604Z","created_by":"mark","updated_at":"2026-02-09T14:45:09.574136922Z","closed_at":"2026-02-09T14:45:09.574118802Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-ruf.4","depends_on_id":"tr-ruf","type":"parent-child","created_at":"2026-02-09T13:25:48.219420604Z","created_by":"mark"},{"issue_id":"tr-ruf.4","depends_on_id":"tr-ruf.3","type":"blocks","created_at":"2026-02-09T13:25:48.219420604Z","created_by":"mark"}]}
{"id":"tr-ruf.5","title":"Docs: wizard-managed prompt installation","description":"OpenSpec refs:\n- openspec/changes/add-trudger-wizard-prompt-install/proposal.md (docs impact)\n- openspec/changes/add-trudger-wizard-prompt-install/design.md (UX + messaging)\n\nWork:\n- Update README + CLI help text to document:\n  - Wizard will offer to install missing prompts to ~/.codex/prompts/.\n  - Wizard may offer to update differing prompts (safe default keep).\n  - ./install.sh remains an alternative for repo checkouts.\n  - If prompts are skipped, task-processing mode will still require them.\n\nExpected outputs:\n- README sections for bootstrap/prompts updated.\n- Any relevant --help strings updated to match behavior.\n\nValidation:\n- cargo test passes.","acceptance_criteria":"Acceptance:\n- README documents wizard prompt install/update behavior and keeps ./install.sh as an alternative.\n- Documentation matches OpenSpec UX decisions (default Yes for install-missing; default No for overwrite-differing; backups on overwrite; abort without config write on prompt install failure).\n- Any touched help output is consistent with actual behavior.\n- cargo test passes.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-09T13:26:04.264842972Z","created_by":"mark","updated_at":"2026-02-09T14:50:14.894323428Z","closed_at":"2026-02-09T14:50:14.894305081Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-ruf.5","depends_on_id":"tr-ruf","type":"parent-child","created_at":"2026-02-09T13:26:04.264842972Z","created_by":"mark"},{"issue_id":"tr-ruf.5","depends_on_id":"tr-ruf.3","type":"blocks","created_at":"2026-02-09T13:26:04.264842972Z","created_by":"mark"}]}
{"id":"tr-ruf.6","title":"Validation: quality gates + OpenSpec validate","description":"OpenSpec refs:\n- openspec/changes/add-trudger-wizard-prompt-install/tasks.md (Section 5. Validation)\n\nWork:\n- Run and record the repo quality gates:\n  - cargo fmt\n  - cargo clippy\n  - cargo nextest run (preferred) or cargo test\n- Run: openspec validate add-trudger-wizard-prompt-install --strict --no-interactive\n\nExpected outputs:\n- Green CI/local gates; no outstanding formatting/lint/test failures.\n\nSuccess criteria:\n- All commands above succeed.","acceptance_criteria":"Acceptance:\n- cargo fmt (or cargo fmt --check) succeeds.\n- cargo clippy succeeds.\n- cargo nextest run (preferred) or cargo test succeeds.\n- openspec validate add-trudger-wizard-prompt-install --strict --no-interactive succeeds.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-09T13:26:19.249942395Z","created_by":"mark","updated_at":"2026-02-09T14:54:09.304601549Z","closed_at":"2026-02-09T14:54:09.304584633Z","close_reason":"Completed (fmt/clippy/nextest/openspec validate)","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-ruf.6","depends_on_id":"tr-ruf","type":"parent-child","created_at":"2026-02-09T13:26:19.249942395Z","created_by":"mark"},{"issue_id":"tr-ruf.6","depends_on_id":"tr-ruf.4","type":"blocks","created_at":"2026-02-09T13:26:19.249942395Z","created_by":"mark"},{"issue_id":"tr-ruf.6","depends_on_id":"tr-ruf.5","type":"blocks","created_at":"2026-02-09T13:26:19.249942395Z","created_by":"mark"}]}
{"id":"tr-syd","title":"Implement bd â†’ br migration","status":"closed","priority":2,"issue_type":"task","owner":"mwotton@gmail.com","created_at":"2026-01-28T09:31:47.493832783Z","created_by":"Mark Wotton","updated_at":"2026-01-28T09:45:55.959195754Z","closed_at":"2026-01-28T09:45:55.958945425Z","close_reason":"Completed","source_repo":".","compaction_level":0}
{"id":"tr-u0t","title":"Extend tests for config, hook, and helper behavior","description":"OpenSpec refs:\n- Configuration loading, validation, parsing, and unknown keys scenarios\n- Hook execution semantics scenarios\n- Task selection scenarios\n- Review hook invocation and status verification scenarios\n\nExpected outputs:\n- BATS coverage for missing config, missing/empty fields, null fields, unknown key warnings, and missing `yq`.\n- BATS coverage for hook `$1` substitution vs argument-prepend behavior.\n- BATS coverage for task selection, review hook invocation, and missing-status error behavior.\n- Tests updated to use shared config and fixture helpers where applicable.\n\nValidation/tests:\n- Run BATS suite locally (or CI) and ensure it passes.\n\nSuccess criteria:\n- Each OpenSpec scenario above has at least one test, and the full test suite passes.","acceptance_criteria":"Acceptance criteria: (1) Every referenced scenario has at least one BATS test. (2) Test suite passes with updated config/fixture helpers.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T05:27:03.099886189Z","created_by":"mark","updated_at":"2026-01-29T09:26:43.365577130Z","closed_at":"2026-01-29T09:26:43.365515652Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-u0t","depends_on_id":"tr-1ta","type":"waits-for","created_at":"2026-01-29T05:27:03.133086027Z","created_by":"mark"},{"issue_id":"tr-u0t","depends_on_id":"tr-2ef","type":"waits-for","created_at":"2026-01-29T05:27:03.131685925Z","created_by":"mark"},{"issue_id":"tr-u0t","depends_on_id":"tr-2mc","type":"parent-child","created_at":"2026-01-29T05:27:03.124885065Z","created_by":"mark"},{"issue_id":"tr-u0t","depends_on_id":"tr-2xy","type":"waits-for","created_at":"2026-01-29T05:27:03.134599917Z","created_by":"mark"},{"issue_id":"tr-u0t","depends_on_id":"tr-31i","type":"waits-for","created_at":"2026-01-29T05:27:03.136049596Z","created_by":"mark"},{"issue_id":"tr-u0t","depends_on_id":"tr-365","type":"waits-for","created_at":"2026-01-29T05:27:03.130134138Z","created_by":"mark"}]}
{"id":"tr-vgj","title":"Use agent_command + agent_review_command with env-var prompts","description":"OpenSpec refs:\n- openspec/changes/refactor-trudger-command-contract/specs/trudger/spec.md Requirement: Agent prompt execution\n  - Scenario: Agent solve + review\n  - Scenario: Prompt context via env vars\n\nWork:\n- Invoke agent_command for solve and agent_review_command for review.\n- Load prompt files; error if missing before any agent command runs.\n- Pass prompt content via TRUDGER_PROMPT/TRUDGER_REVIEW_PROMPT for both agent commands.\n- Remove $ARGUMENTS/$TASK_SHOW substitution.\n\nExpected outputs:\n- Agent commands receive prompt content and task context via env vars.\n\nValidation/tests:\n- Tests assert correct env vars are set and review uses agent_review_command.","acceptance_criteria":"1. agent_command runs for solve and agent_review_command runs for review. (OpenSpec: Agent prompt execution scenario.)\n2. Only the relevant prompt env var is set: TRUDGER_PROMPT for solve, TRUDGER_REVIEW_PROMPT for review; the other is unset. (OpenSpec: Prompt context via env vars scenario.)\n3. Missing prompt files cause a clear error before any agent command runs. (OpenSpec: Prompt file presence scenario.)\n4. Tests confirm env vars and correct command selection.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T06:07:22.635361266Z","created_by":"mark","updated_at":"2026-02-04T10:31:26.804363437Z","closed_at":"2026-02-04T10:31:26.804347215Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"tr-vgj","depends_on_id":"tr-1cs","type":"parent-child","created_at":"2026-02-04T06:07:22.639491083Z","created_by":"mark"},{"issue_id":"tr-vgj","depends_on_id":"tr-2c7","type":"blocks","created_at":"2026-02-04T06:07:22.641348129Z","created_by":"mark"}]}

id: br-next-task
label: br next task
description: Select the next ready `br` task labeled `trudgeable`.
commands:
  next_task: 'task_id=$(br ready --json --label trudgeable --sort priority --limit 1 | jq -r "if type == \"array\" and length > 0 then .[0].id // \"\" else \"\" end"); if [[ -z "$task_id" ]]; then exit 1; fi; printf "%s" "$task_id"'
  task_show: 'br show "$TRUDGER_TASK_ID"'
  task_status: 'br show "$TRUDGER_TASK_ID" --json | jq -r "if type == \"array\" then .[0].status // \"\" else .status // \"\" end"'
  task_update_in_progress: 'br update "$TRUDGER_TASK_ID" "$@"'
  reset_task: 'br update "$TRUDGER_TASK_ID" --status open'
hooks:
  on_completed: 'br label remove "$TRUDGER_TASK_ID" "trudgeable"'
  on_requires_human: 'br label remove "$TRUDGER_TASK_ID" "trudgeable"; br label add "$TRUDGER_TASK_ID" "human-required"'
  on_doctor_setup: 'rm -rf "$TRUDGER_DOCTOR_SCRATCH_DIR/.beads"; cp -R ".beads" "$TRUDGER_DOCTOR_SCRATCH_DIR/"'
